{
  "info": {
    "author": "Florimond Manca",
    "author_email": "florimond.manca@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Intended Audience :: Developers",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8"
    ],
    "description": "# msgpack-asgi\n\n[![Build Status](https://dev.azure.com/florimondmanca/public/_apis/build/status/florimondmanca.msgpack-asgi?branchName=master)](https://dev.azure.com/florimondmanca/public/_build/latest?definitionId=5&branchName=master)\n[![Coverage](https://codecov.io/gh/florimondmanca/msgpack-asgi/branch/master/graph/badge.svg)](https://codecov.io/gh/florimondmanca/msgpack-asgi)\n[![Package version](https://badge.fury.io/py/msgpack-asgi.svg)](https://pypi.org/project/msgpack-asgi)\n\n`msgpack-asgi` allows you to add automatic [MessagePack](https://msgpack.org/) content negotiation to ASGI applications (Starlette, FastAPI, Quart, etc.), with a single line of code:\n\n```python\napp.add_middleware(MessagePackMiddleware)\n```\n\n_(You may want to adapt this snippet to your framework-specific middleware API.)_\n\nThis gives you the bandwitdth usage reduction benefits of MessagePack without having to change existing code.\n\n**Note**: this comes at a CPU usage cost, since `MessagePackMiddleware` will perform MsgPack decoding while your application continues to decode and encode JSON data (see also [How it works](#how-it-works)). If your use case is CPU-sensitive, rather than strictly focused on reducing network bandwidth, this package may not be for you.\n\n## Installation\n\nInstall with pip:\n\n```bash\npip install \"msgpack-asgi==1.*\"\n```\n\n## Quickstart\n\nFirst, you'll need an ASGI application. Let's use this sample application, which exposes an endpoint that returns JSON data:\n\n```python\n# For convenience, we use some ASGI components from Starlette.\n# Install with: `$ pip install starlette`.\nfrom starlette.requests import Request\nfrom starlette.responses import JSONResponse\n\n\nasync def get_response(request):\n    if request.method == \"POST\":\n        data = await request.json()\n        return JSONResponse({\"data\": data}, status_code=201)\n    else:\n        return JSONResponse({\"message\": \"Hello, msgpack!\"})\n\n\nasync def app(scope, receive, send):\n    assert scope[\"type\"] == \"http\"\n    request = Request(scope=scope, receive=receive)\n    response = await get_response(request)\n    await response(scope, receive, send)\n```\n\nThen, wrap your application around `MessagePackMiddleware`:\n\n```python\nfrom msgpack_asgi import MessagePackMiddleware\n\napp = MessagePackMiddleware(app)\n```\n\nServe your application using an ASGI server, for example with [Uvicorn](https://www.uvicorn.org):\n\n```bash\nuvicorn app:app\n```\n\nNow, let's make a request that accepts MessagePack data in response:\n\n```bash\ncurl -i http://localhost:8000 -H \"Accept: application/x-msgpack\"\n```\n\nYou should get the following output:\n\n```http\nHTTP/1.1 200 OK\ndate: Fri, 01 Nov 2019 17:40:14 GMT\nserver: uvicorn\ncontent-length: 25\ncontent-type: application/x-msgpack\n\n��message�Hello, msgpack!\n```\n\nWhat happened? Since we told the application that we accepted MessagePack-encoded responses, `msgpack-asgi` automatically converted the JSON data returned by the Starlette application to MessagePack.\n\nWe can make sure the response contains valid MessagePack data by making the request again in Python, and decoding the response content:\n\n```python\n>>> import requests\n>>> import msgpack\n>>> url = \"http://localhost:8000\"\n>>> headers = {\"accept\": \"application/x-msgpack\"}\n>>> r = requests.get(url, headers=headers)\n>>> r.content\nb'\\x81\\xa7message\\xafHello, msgpack!'\n>>> msgpack.unpackb(r.content, raw=False)\n{'message': 'Hello, msgpack!'}\n```\n\n`msgpack-asgi` also works in reverse: it will automatically decode MessagePack-encoded data sent by the client to JSON. We can try this out by making a `POST` request to our sample application with a MessagePack-encoded body:\n\n```python\n>>> import requests\n>>> import msgpack\n>>> url = \"http://localhost:8000\"\n>>> data = msgpack.packb({\"message\": \"Hi, there!\"})\n>>> headers = {\"content-type\": \"application/x-msgpack\"}\n>>> r = requests.post(url, data=data, headers=headers)\n>>> r.json()\n{'data': {'message': 'Hi, there!'}}\n```\n\nThat's all there is to it! You can now go reduce the size of your payloads.\n\n## Advanced usage\n\n### Custom implementations\n\n`msgpack-asgi` supports customizing the default encoding/decoding implementation. This is useful for fine-tuning application performance via an alternative msgpack implementation for encoding, decoding, or both.\n\nTo do so, use the following arguments:\n\n* `packb` - _(Optional, type: `(obj: Any) -> bytes`, default: `msgpack.packb`)_ - Used to encode outgoing data.\n* `unpackb` - _(Optional, type: `(data: bytes) -> Any`, default: `msgpack.unpackb`)_ - Used to decode incoming data.\n\nFor example, to use the [`ormsgpack`](https://pypi.org/project/ormsgpack/) library for encoding:\n\n```python\nimport ormsgpack  # Installed separately.\nfrom msgpack_asgi import MessagePackMiddleware\n\ndef packb(obj):\n    option = ...  # See `ormsgpack` options.\n    return ormsgpack.packb(obj, option=option)\n\napp = MessagePackMiddleware(..., packb=packb)\n```\n\n## Limitations\n\n`msgpack-asgi` does not support request or response streaming. This is because the full request and response body content has to be loaded in memory before it can be re-encoded.\n\n## How it works\n\n![](https://github.com/florimondmanca/msgpack-asgi/blob/master/img/msgpack-asgi.png)\n\nAn ASGI application wrapped around `MessagePackMiddleware` will perform automatic content negotiation based on the client's capabilities. More precisely:\n\n- If the client sends MessagePack-encoded data with the `application/x-msgpack` content type, `msgpack-asgi` will automatically re-encode the body to JSON and re-write the request `Content-Type` to `application/json` for your application to consume. (Note: this means applications will not be able to distinguish between MessagePack and JSON client requests.)\n- If the client sent the `Accept: application/x-msgpack` header, `msgpack-asgi` will automatically re-encode any JSON response data to MessagePack for the client to consume.\n\n(In other cases, `msgpack-asgi` won't intervene at all.)\n\n## License\n\nMIT\n\n\n# Changelog\n\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n\n## 1.1.0 - 2021-10-26\n\n### Added\n\n- Support custom encoding/decoding implementation via the `packb=...` and `unpackb=...` optional parameters, allowing the use of alternative msgpack libraries. (Pull #20)\n\n### Fixed\n\n- Properly re-write request `Content-Type` to `application/json`. (Pull #24)\n\n## 1.0.0 - 2020-03-26\n\n_First production/stable release._\n\n### Changed\n\n- Switch to private module naming. Components should now be imported from the root package, e.g. `from msgpack_asgi import MessagePackMiddleware`. (Pull #5)\n\n### Fixed\n\n- Add missing `MANIFEST.in`. (Pull #4)\n\n## 0.1.0 - 2019-11-04\n\nInitial release.\n\n### Added\n\n- Add the `MessagePackMiddleware` ASGI middleware.\n- Add the `MessagePackResponse` ASGI response class.\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "http://github.com/florimondmanca/msgpack-asgi",
    "keywords": "",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "msgpack-asgi",
    "package_url": "https://pypi.org/project/msgpack-asgi/",
    "platform": "",
    "project_url": "https://pypi.org/project/msgpack-asgi/",
    "project_urls": {
      "Homepage": "http://github.com/florimondmanca/msgpack-asgi"
    },
    "release_url": "https://pypi.org/project/msgpack-asgi/1.1.0/",
    "requires_dist": [
      "msgpack",
      "starlette (==0.*)"
    ],
    "requires_python": ">=3.6",
    "summary": "Drop-in MessagePack support for ASGI applications and frameworks",
    "version": "1.1.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 11833760,
  "releases": {
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4b9226e855a672ede0f08073686edf2b297a4fc5a62662e4b7be3d3087be16bf",
          "md5": "f41c546295ee45e5f759af4897cc91d3",
          "sha256": "afcc337d6459862e27cd5db3644f1d92582d557f15cee0786842979c1aed7e5e"
        },
        "downloads": -1,
        "filename": "msgpack_asgi-0.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "f41c546295ee45e5f759af4897cc91d3",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6",
        "size": 5854,
        "upload_time": "2019-11-04T11:13:25",
        "upload_time_iso_8601": "2019-11-04T11:13:25.444934Z",
        "url": "https://files.pythonhosted.org/packages/4b/92/26e855a672ede0f08073686edf2b297a4fc5a62662e4b7be3d3087be16bf/msgpack_asgi-0.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "80afeea18f01d714685c60bb8875723d6eaadbdf23711e50d1201502217b024e",
          "md5": "c718e0821f3fd9bec074a18f6da28bdd",
          "sha256": "10b77dffa75691ed30624ea4e5c9d2a2885c40fe6787853bd5a8387c82806cac"
        },
        "downloads": -1,
        "filename": "msgpack-asgi-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "c718e0821f3fd9bec074a18f6da28bdd",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6",
        "size": 6049,
        "upload_time": "2019-11-04T11:13:27",
        "upload_time_iso_8601": "2019-11-04T11:13:27.903094Z",
        "url": "https://files.pythonhosted.org/packages/80/af/eea18f01d714685c60bb8875723d6eaadbdf23711e50d1201502217b024e/msgpack-asgi-0.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "1.0.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "004283830a240814c2d93a8c250ff801bcf909aeede5a9485ef272949fa0e11a",
          "md5": "40f685022a9084aa9d41604fc205a3a5",
          "sha256": "77dfbf422c170cab56520423e104c4103e766aa6313492a3cd992ff24072fa35"
        },
        "downloads": -1,
        "filename": "msgpack_asgi-1.0.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "40f685022a9084aa9d41604fc205a3a5",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6",
        "size": 6547,
        "upload_time": "2020-03-26T20:22:35",
        "upload_time_iso_8601": "2020-03-26T20:22:35.241976Z",
        "url": "https://files.pythonhosted.org/packages/00/42/83830a240814c2d93a8c250ff801bcf909aeede5a9485ef272949fa0e11a/msgpack_asgi-1.0.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "bdead52c8a8be1a19ccdedf6ef5c3287110478dcd71b8183015d9a1cd85111b3",
          "md5": "5ee61ef3badfc0984873a348b266957c",
          "sha256": "dab20e5ed5cdba96704ffd86d40f3d3b6da19e9093255b88b01c3ae045749a05"
        },
        "downloads": -1,
        "filename": "msgpack-asgi-1.0.0.tar.gz",
        "has_sig": false,
        "md5_digest": "5ee61ef3badfc0984873a348b266957c",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6",
        "size": 7446,
        "upload_time": "2020-03-26T20:22:36",
        "upload_time_iso_8601": "2020-03-26T20:22:36.770164Z",
        "url": "https://files.pythonhosted.org/packages/bd/ea/d52c8a8be1a19ccdedf6ef5c3287110478dcd71b8183015d9a1cd85111b3/msgpack-asgi-1.0.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "1.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "44ff132685705f94f17afbeb471f3930ca1b67234aefa8e10c44adac8d9fb733",
          "md5": "f723aaa3b5a70f0c9e32dfef7b3a74f7",
          "sha256": "47fe50fb58b310c1f73721406638a790bdf565ae555e09587c3ddfbe7eb9da8d"
        },
        "downloads": -1,
        "filename": "msgpack_asgi-1.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "f723aaa3b5a70f0c9e32dfef7b3a74f7",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6",
        "size": 7097,
        "upload_time": "2021-10-26T10:10:57",
        "upload_time_iso_8601": "2021-10-26T10:10:57.900690Z",
        "url": "https://files.pythonhosted.org/packages/44/ff/132685705f94f17afbeb471f3930ca1b67234aefa8e10c44adac8d9fb733/msgpack_asgi-1.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4840c1f3ede818355d95f87666fb245a8538203081c6a0c9e39c3ca9ebd01da8",
          "md5": "a5126b7f6d41f0d4feb6642300047918",
          "sha256": "5ed5a2f4050f28dd9388d38555f059ce05498f176642053ba9f08bb7a1e02221"
        },
        "downloads": -1,
        "filename": "msgpack-asgi-1.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "a5126b7f6d41f0d4feb6642300047918",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6",
        "size": 8375,
        "upload_time": "2021-10-26T10:10:59",
        "upload_time_iso_8601": "2021-10-26T10:10:59.388884Z",
        "url": "https://files.pythonhosted.org/packages/48/40/c1f3ede818355d95f87666fb245a8538203081c6a0c9e39c3ca9ebd01da8/msgpack-asgi-1.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "44ff132685705f94f17afbeb471f3930ca1b67234aefa8e10c44adac8d9fb733",
        "md5": "f723aaa3b5a70f0c9e32dfef7b3a74f7",
        "sha256": "47fe50fb58b310c1f73721406638a790bdf565ae555e09587c3ddfbe7eb9da8d"
      },
      "downloads": -1,
      "filename": "msgpack_asgi-1.1.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "f723aaa3b5a70f0c9e32dfef7b3a74f7",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.6",
      "size": 7097,
      "upload_time": "2021-10-26T10:10:57",
      "upload_time_iso_8601": "2021-10-26T10:10:57.900690Z",
      "url": "https://files.pythonhosted.org/packages/44/ff/132685705f94f17afbeb471f3930ca1b67234aefa8e10c44adac8d9fb733/msgpack_asgi-1.1.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "4840c1f3ede818355d95f87666fb245a8538203081c6a0c9e39c3ca9ebd01da8",
        "md5": "a5126b7f6d41f0d4feb6642300047918",
        "sha256": "5ed5a2f4050f28dd9388d38555f059ce05498f176642053ba9f08bb7a1e02221"
      },
      "downloads": -1,
      "filename": "msgpack-asgi-1.1.0.tar.gz",
      "has_sig": false,
      "md5_digest": "a5126b7f6d41f0d4feb6642300047918",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.6",
      "size": 8375,
      "upload_time": "2021-10-26T10:10:59",
      "upload_time_iso_8601": "2021-10-26T10:10:59.388884Z",
      "url": "https://files.pythonhosted.org/packages/48/40/c1f3ede818355d95f87666fb245a8538203081c6a0c9e39c3ca9ebd01da8/msgpack-asgi-1.1.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}