{
  "info": {
    "author": "Simon Willison",
    "author_email": "",
    "bugtrack_url": null,
    "classifiers": [
      "Framework :: Datasette",
      "License :: OSI Approved :: Apache Software License"
    ],
    "description": "# datasette-low-disk-space-hook\n\n[![PyPI](https://img.shields.io/pypi/v/datasette-low-disk-space-hook.svg)](https://pypi.org/project/datasette-low-disk-space-hook/)\n[![Changelog](https://img.shields.io/github/v/release/simonw/datasette-low-disk-space-hook?include_prereleases&label=changelog)](https://github.com/simonw/datasette-low-disk-space-hook/releases)\n[![Tests](https://github.com/simonw/datasette-low-disk-space-hook/workflows/Test/badge.svg)](https://github.com/simonw/datasette-low-disk-space-hook/actions?query=workflow%3ATest)\n[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](https://github.com/simonw/datasette-low-disk-space-hook/blob/main/LICENSE)\n\nDatasette plugin providing the low_disk_space hook for other plugins to check for low disk space\n\n## Installation\n\nInstall this plugin in the same environment as Datasette.\n\n    datasette install datasette-low-disk-space-hook\n\nYou are unlikely to need to install this plugin directly though: it will usually be automatically be installed as a dependency of another plugin.\n\n## Usage\n\nThis plugin adds a new plugin hook to Datasette called `low_disk_space(datasette=datasette)`.\n\nIt also adds a new `space_is_running_low(datasette)` utility function which can be called to check if the Datasette instance is running out of space:\n\n```python\nfrom datasette_low_disk_space_hook import space_is_running_low\n\nif await space_is_running_low(datasette):\n    print(\"Disk space is running low\")\n```\nThe idea is for plugins such as `datasette-upload-csvs` and `datasette-socrata` to call this hook before writing any new data into Datasette, to check if they should continue.\n\nOther plugins can then implement the hook to warn when Datasette is running out of space.\n\nWorking together, this will help plugins avoid filling the disk entirely with data which could cause Datasette instances to crash.\n\n## Implementing the hook\n\nAn implementation of this hook (in yet another plugin) looks like this:\n\n```python\nfrom datasette import hookimpl\nimport shutil\n\n@hookimpl\ndef low_disk_space(self, datasette):\n    usage = shutil.disk_usage(\"/mnt\")\n    # Fail at 95% or more used\n    if (usage.used / usage.total) > 0.95:\n        return True\n```\nThe plugin can also return an `async` function if it needs to use `await` as part of its execution:\n```python\nfrom datasette import hookimpl\nfrom somewhere import check_disk_usage_percentage_async\n\n@hookimpl\ndef low_disk_space(self, datasette):\n    async def inner():\n        usage = await check_disk_usage_percentage_async(\"/mnt\")\n        if usage > 0.95:\n            return True\n    return inner\n```\n\n## Development\n\nTo set up this plugin locally, first checkout the code. Then create a new virtual environment:\n\n    cd datasette-low-disk-space-hook\n    python3 -m venv venv\n    source venv/bin/activate\n\nNow install the dependencies and test dependencies:\n\n    pip install -e '.[test]'\n\nTo run the tests:\n\n    pytest\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/simonw/datasette-low-disk-space-hook",
    "keywords": "",
    "license": "Apache License, Version 2.0",
    "maintainer": "",
    "maintainer_email": "",
    "name": "datasette-low-disk-space-hook",
    "package_url": "https://pypi.org/project/datasette-low-disk-space-hook/",
    "platform": null,
    "project_url": "https://pypi.org/project/datasette-low-disk-space-hook/",
    "project_urls": {
      "CI": "https://github.com/simonw/datasette-low-disk-space-hook/actions",
      "Changelog": "https://github.com/simonw/datasette-low-disk-space-hook/releases",
      "Homepage": "https://github.com/simonw/datasette-low-disk-space-hook",
      "Issues": "https://github.com/simonw/datasette-low-disk-space-hook/issues"
    },
    "release_url": "https://pypi.org/project/datasette-low-disk-space-hook/0.1/",
    "requires_dist": [
      "datasette",
      "pytest ; extra == 'test'",
      "pytest-asyncio ; extra == 'test'"
    ],
    "requires_python": ">=3.7",
    "summary": "Datasette plugin providing the low_disk_space hook for other plugins to check for low disk space",
    "version": "0.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 14166766,
  "releases": {
    "0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "efc37d26439ef28179214af22d19d6562d2c2185a79b0ecf2aaba1d461ea5d61",
          "md5": "bd416ac9e224afcd174fc3a057b7b985",
          "sha256": "b820561fef7fc7c6ab8275e615cc8d1ace393ea774dc15aa4cfde6f3b5a42738"
        },
        "downloads": -1,
        "filename": "datasette_low_disk_space_hook-0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "bd416ac9e224afcd174fc3a057b7b985",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 7689,
        "upload_time": "2022-06-17T20:10:58",
        "upload_time_iso_8601": "2022-06-17T20:10:58.939110Z",
        "url": "https://files.pythonhosted.org/packages/ef/c3/7d26439ef28179214af22d19d6562d2c2185a79b0ecf2aaba1d461ea5d61/datasette_low_disk_space_hook-0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "1bbdab3ca9e788665fdb0c4a0841c36bd6c3d6d5e279832b57f5a68bae9bd41e",
          "md5": "f637db254cab891a89653fc7272b6d26",
          "sha256": "58604c0b94c62f4616538d0866d2d6b0880ee3d2e2d673cbdd5d4e494bab0c5d"
        },
        "downloads": -1,
        "filename": "datasette-low-disk-space-hook-0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "f637db254cab891a89653fc7272b6d26",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.7",
        "size": 6845,
        "upload_time": "2022-06-17T20:11:00",
        "upload_time_iso_8601": "2022-06-17T20:11:00.411766Z",
        "url": "https://files.pythonhosted.org/packages/1b/bd/ab3ca9e788665fdb0c4a0841c36bd6c3d6d5e279832b57f5a68bae9bd41e/datasette-low-disk-space-hook-0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1a0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "dd28ca3bd13181989925172f71255ba6f75d472a884d909dc9aeb8c1d490b709",
          "md5": "c9ecfe9fb9dc7f9f56da570569cbbdb3",
          "sha256": "ea95bc198f1a2852d0dc3b6d2d83449f66596fa1eb23504e129d9f753c0bc67e"
        },
        "downloads": -1,
        "filename": "datasette_low_disk_space_hook-0.1a0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "c9ecfe9fb9dc7f9f56da570569cbbdb3",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 7776,
        "upload_time": "2022-06-11T21:20:39",
        "upload_time_iso_8601": "2022-06-11T21:20:39.297971Z",
        "url": "https://files.pythonhosted.org/packages/dd/28/ca3bd13181989925172f71255ba6f75d472a884d909dc9aeb8c1d490b709/datasette_low_disk_space_hook-0.1a0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "292b10532a39ab25d21d06faf962ea7546679e2d4c8755133beb80ec60f57bcb",
          "md5": "ce6d792b9e0fdf56d0673430c3fee3bd",
          "sha256": "44b5b6b29c7e977b546ff407542c1a996955a4dd97733bb546e3247bac414575"
        },
        "downloads": -1,
        "filename": "datasette-low-disk-space-hook-0.1a0.tar.gz",
        "has_sig": false,
        "md5_digest": "ce6d792b9e0fdf56d0673430c3fee3bd",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.7",
        "size": 6882,
        "upload_time": "2022-06-11T21:20:45",
        "upload_time_iso_8601": "2022-06-11T21:20:45.955028Z",
        "url": "https://files.pythonhosted.org/packages/29/2b/10532a39ab25d21d06faf962ea7546679e2d4c8755133beb80ec60f57bcb/datasette-low-disk-space-hook-0.1a0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "efc37d26439ef28179214af22d19d6562d2c2185a79b0ecf2aaba1d461ea5d61",
        "md5": "bd416ac9e224afcd174fc3a057b7b985",
        "sha256": "b820561fef7fc7c6ab8275e615cc8d1ace393ea774dc15aa4cfde6f3b5a42738"
      },
      "downloads": -1,
      "filename": "datasette_low_disk_space_hook-0.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "bd416ac9e224afcd174fc3a057b7b985",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.7",
      "size": 7689,
      "upload_time": "2022-06-17T20:10:58",
      "upload_time_iso_8601": "2022-06-17T20:10:58.939110Z",
      "url": "https://files.pythonhosted.org/packages/ef/c3/7d26439ef28179214af22d19d6562d2c2185a79b0ecf2aaba1d461ea5d61/datasette_low_disk_space_hook-0.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "1bbdab3ca9e788665fdb0c4a0841c36bd6c3d6d5e279832b57f5a68bae9bd41e",
        "md5": "f637db254cab891a89653fc7272b6d26",
        "sha256": "58604c0b94c62f4616538d0866d2d6b0880ee3d2e2d673cbdd5d4e494bab0c5d"
      },
      "downloads": -1,
      "filename": "datasette-low-disk-space-hook-0.1.tar.gz",
      "has_sig": false,
      "md5_digest": "f637db254cab891a89653fc7272b6d26",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.7",
      "size": 6845,
      "upload_time": "2022-06-17T20:11:00",
      "upload_time_iso_8601": "2022-06-17T20:11:00.411766Z",
      "url": "https://files.pythonhosted.org/packages/1b/bd/ab3ca9e788665fdb0c4a0841c36bd6c3d6d5e279832b57f5a68bae9bd41e/datasette-low-disk-space-hook-0.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}