{
  "info": {
    "author": "Denis MACHARD",
    "author_email": "d.machard@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "License :: OSI Approved :: MIT License",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3",
      "Topic :: Software Development :: Libraries"
    ],
    "description": "# PowerDNS protobuf receiver\n\n![](https://github.com/dmachard/pdns-protobuf-receiver/workflows/Publish/badge.svg)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n![PyPI - Python Version](https://img.shields.io/pypi/pyversions/pdns-protobuf-receiver)\n\nThe `pdns_protobuf_receiver` is a daemon in Python 3 that acts a protobuf server for PowerDNS's products. You can use it to collect DNS queries and responses and to log to syslog or a json remote tcp collector.\n\n## Table of contents\n* [Installation](#installation)\n* [Execute receiver](#execute-receiver)\n* [Startup options](#startup-options)\n* [Output JSON format](#output-json-format)\n* [PowerDNS configuration](#powerdns-configuration)\n* [About](#about)\n\n## Installation\n\n### PyPI\n\nFrom pypi, deploy the `pdns_protobuf_receiver` with the pip command.\nOnly Python3 is supported.\n\n```python\npip install pdns-protobuf-receiver\n```\n\nAfter installation, you will have `pdns_protobuf_receiver` binary available\n\n### Docker Hub\n\nPull the pdns-protobuf-receiver image from Docker Hub.\n\n```bash\ndocker pull dmachard/pdns-protobuf-receiver:latest\n```\n\nDeploy the container\n\n```bash\ndocker run -d -p 50001:50001 --name=pdns-pb01 dmachard/pdns-protobuf-receiver\n```\n\nFollow containers logs \n\n```bash\ndocker logs pdns-pb01 -f\n```\n\n## Execute receiver\n\nThe receiver is listening by default on the 0.0.0.0 interface and 50001 tcp port \n\nIf you want to print DNS queries and responses to stdout in JSON format, then execute the `pdns_protobuf` receiver as below: \n\n```\n# pdns_protobuf_receiver -v\n2020-05-29 18:39:08,579 Start pdns protobuf receiver...\n2020-05-29 18:39:08,580 Using selector: EpollSelector\n```\n\nIf you want to resend protobuf message to your remote tcp collector\nStart the pdns_protobuf receiver as below:\n\n```\n# pdns_protobuf_receiver -j 10.0.0.235:6000 -v\n2020-05-29 18:39:08,579 Start pdns protobuf receiver...\n2020-05-29 18:39:08,580 Using selector: EpollSelector\n2020-05-29 18:39:08,580 Connecting to 10.0.0.235 6000\n2020-05-29 18:39:08,585 Connected to 10.0.0.235 6000\n```\n\n## Startup options\n\nCommand line options are:\n\n```\nusage: -c [-h] [-l L] [-j J] [-v]\n\noptional arguments:\n  -h, --help  show this help message and exit\n  -l L        listen protobuf dns message on tcp/ip address <ip:port>\n  -j J        write JSON payload to tcp/ip address <ip:port>\n  -v          verbose mode\n```\n\n## JSON log format\n\nEach events generated by the `pdns_protbuf` receiver will have the following format:\n\n```json\n{\n    \"dns_message\": \"AUTH_QUERY\",\n    \"socket_family\": \"IPv6\",\n    \"socket protocol\": \"UDP\",\n    \"from_address\": \"0.0.0.0\",\n    \"to_address\": \"184.26.161.130\",\n    \"query_time\": \"2020-05-29 13:46:23.322\",\n    \"response_time\": \"1970-01-01 01:00:00.000\",\n    \"latency\": 0,\n    \"query_type\": \"A\",\n    \"query_name\": \"a13-130.akagtm.org.\",\n    \"return_code\": \"NOERROR\",\n    \"bytes\": 4\n}\n```\n\nKeys description:\n - dns_message: PDNS message type (CLIENT_QUERY, CLIENT_RESPONSE, ...)\n - socket_family: IP protocol used (IPv4 or IPv6)\n - socket_protocol: transport protocol used (UDP or TCP)\n - from_address: the querier IP address\n - to_address: the destination IP address\n - query_time: time of query reception\n - response_time: time of response reception\n - latency: difference between query and response time\n - query_type: the query type (A, AAAA, NS, ...)\n - query_name: the query name\n - return_code: the response code sent back to the client (NXDOMAIN, NOERROR, ...)\n - bytes: size in bytes of the query or response\n\n## PowerDNS configuration\n\nYou need to configure dnsdist or pdns-recursor to active remote logging.\n\n### dnsdist\n\nConfigure the dnsdist `/etc/dnsdist/dnsdist.conf` and add the following lines\nSet the newRemoteLogger function with the address of your pdns_protobuf_receiver\ninstance.\n\n```\nrl = newRemoteLogger(\"10.0.0.97:50001\")\naddAction(AllRule(),RemoteLogAction(rl))\naddResponseAction(AllRule(),RemoteLogResponseAction(rl))\n```\n\nRestart dnsdist.\n\n### pdns-recursor\n\nConfigure the powerdns recursor `/etc/pdns-recursor/recursor.conf` and add the following line\n\n```\nlua-config-file=/etc/pdns-recursor/recursor.lua\n```\n\nCreate the LUA file `/etc/pdns-recursor/recursor.lua`\nSet the protobufServer or outgoingProtobufServer functions with the address of your pdns_protobuf receiver instance.\n\n```\nprotobufServer(\"10.0.0.97:50001\", {logQueries=true,\n                                   logResponses=true,\n                                   exportTypes={'A', 'AAAA',\n                                                'CNAME', 'MX', \n                                                'PTR', 'NS',\n                                                'SPF', 'SRV',\n                                                'TXT'}} )\noutgoingProtobufServer(\"10.0.0.97:50001\",  {logQueries=true,\n                                            logResponses=true,\n                                            exportTypes={'A', 'AAAA',\n                                                         'CNAME', 'MX',\n                                                         'PTR', 'NS',\n                                                         'SPF', 'SRV',\n                                                         'TXT'}})\n```\n\nRestart the recursor.\n\n## About\n\n| | |\n| ------------- | ------------- |\n| Author |  Denis Machard <d.machard@gmail.com> |\n| PyPI |  https://pypi.org/project/pdns-protobuf-receiver/ |\n| Github | https://github.com/dmachard/pdns-protobuf-receiver |\n| DockerHub | https://hub.docker.com/r/dmachard/pdns-protobuf-receiver  |\n| | |\n\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/dmachard/pdns-protobuf-receiver",
    "keywords": "protobuf pdns receiver json",
    "license": "",
    "maintainer": "",
    "maintainer_email": "",
    "name": "pdns-protobuf-receiver",
    "package_url": "https://pypi.org/project/pdns-protobuf-receiver/",
    "platform": "any",
    "project_url": "https://pypi.org/project/pdns-protobuf-receiver/",
    "project_urls": {
      "Homepage": "https://github.com/dmachard/pdns-protobuf-receiver"
    },
    "release_url": "https://pypi.org/project/pdns-protobuf-receiver/1.0.1/",
    "requires_dist": [
      "dnspython",
      "protobuf"
    ],
    "requires_python": "",
    "summary": "Python PDNS protobuf receiver to JSON stream",
    "version": "1.0.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 8500173,
  "releases": {
    "1.0.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "1476408f11e910c8d50ea344467ae37a57927632e71c731aced3dabe71b413bd",
          "md5": "69ce1cd89bacc2b6fde459bd39f35e80",
          "sha256": "820b0bcb2fb481807a9f6776ed2dbe3622815b3480d75cbf3991ec0339e9a0e6"
        },
        "downloads": -1,
        "filename": "pdns_protobuf_receiver-1.0.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "69ce1cd89bacc2b6fde459bd39f35e80",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": null,
        "size": 10883,
        "upload_time": "2020-10-22T15:51:59",
        "upload_time_iso_8601": "2020-10-22T15:51:59.694828Z",
        "url": "https://files.pythonhosted.org/packages/14/76/408f11e910c8d50ea344467ae37a57927632e71c731aced3dabe71b413bd/pdns_protobuf_receiver-1.0.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4a7e64af6e7c1680b6b05fba24d25b4044333d231522d296a14a94c0781d2341",
          "md5": "edaed90975c9f4b0fab5f9a9819dc124",
          "sha256": "f697289bf773e1483ffccfbc1f006ff55c6de56d9d3caaca2fcf51a3af0a0010"
        },
        "downloads": -1,
        "filename": "pdns_protobuf_receiver-1.0.0.tar.gz",
        "has_sig": false,
        "md5_digest": "edaed90975c9f4b0fab5f9a9819dc124",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 11251,
        "upload_time": "2020-10-22T15:52:02",
        "upload_time_iso_8601": "2020-10-22T15:52:02.177569Z",
        "url": "https://files.pythonhosted.org/packages/4a/7e/64af6e7c1680b6b05fba24d25b4044333d231522d296a14a94c0781d2341/pdns_protobuf_receiver-1.0.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "1.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "d71e218798132bdd091000f6e17b924866194b6cac5a632571d5d45394811ae8",
          "md5": "fef7ce2077c4b0feb42d6320af93a1de",
          "sha256": "e6bf11e256bdc1821b3b701a033bda097bb4c6abcf1b756f65328c68ce8f7352"
        },
        "downloads": -1,
        "filename": "pdns_protobuf_receiver-1.0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "fef7ce2077c4b0feb42d6320af93a1de",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": null,
        "size": 10892,
        "upload_time": "2020-10-26T08:43:11",
        "upload_time_iso_8601": "2020-10-26T08:43:11.538786Z",
        "url": "https://files.pythonhosted.org/packages/d7/1e/218798132bdd091000f6e17b924866194b6cac5a632571d5d45394811ae8/pdns_protobuf_receiver-1.0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4afc8b60a2192741114cdf980ad77a72b94129c3e24bd318d8afdcdc2b3eee76",
          "md5": "d16dc5c1a0cc71cd060a3d36e6e7174c",
          "sha256": "52378e0a3b9661e5d6b9e4a35e1a482c901ede266e933523fbe0021fb182431c"
        },
        "downloads": -1,
        "filename": "pdns_protobuf_receiver-1.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "d16dc5c1a0cc71cd060a3d36e6e7174c",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 11281,
        "upload_time": "2020-10-26T08:43:12",
        "upload_time_iso_8601": "2020-10-26T08:43:12.783152Z",
        "url": "https://files.pythonhosted.org/packages/4a/fc/8b60a2192741114cdf980ad77a72b94129c3e24bd318d8afdcdc2b3eee76/pdns_protobuf_receiver-1.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "d71e218798132bdd091000f6e17b924866194b6cac5a632571d5d45394811ae8",
        "md5": "fef7ce2077c4b0feb42d6320af93a1de",
        "sha256": "e6bf11e256bdc1821b3b701a033bda097bb4c6abcf1b756f65328c68ce8f7352"
      },
      "downloads": -1,
      "filename": "pdns_protobuf_receiver-1.0.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "fef7ce2077c4b0feb42d6320af93a1de",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": null,
      "size": 10892,
      "upload_time": "2020-10-26T08:43:11",
      "upload_time_iso_8601": "2020-10-26T08:43:11.538786Z",
      "url": "https://files.pythonhosted.org/packages/d7/1e/218798132bdd091000f6e17b924866194b6cac5a632571d5d45394811ae8/pdns_protobuf_receiver-1.0.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "4afc8b60a2192741114cdf980ad77a72b94129c3e24bd318d8afdcdc2b3eee76",
        "md5": "d16dc5c1a0cc71cd060a3d36e6e7174c",
        "sha256": "52378e0a3b9661e5d6b9e4a35e1a482c901ede266e933523fbe0021fb182431c"
      },
      "downloads": -1,
      "filename": "pdns_protobuf_receiver-1.0.1.tar.gz",
      "has_sig": false,
      "md5_digest": "d16dc5c1a0cc71cd060a3d36e6e7174c",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": null,
      "size": 11281,
      "upload_time": "2020-10-26T08:43:12",
      "upload_time_iso_8601": "2020-10-26T08:43:12.783152Z",
      "url": "https://files.pythonhosted.org/packages/4a/fc/8b60a2192741114cdf980ad77a72b94129c3e24bd318d8afdcdc2b3eee76/pdns_protobuf_receiver-1.0.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}