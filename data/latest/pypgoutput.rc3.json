{
  "info": {
    "author": "Daniel Geals",
    "author_email": "danielgeals@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "License :: OSI Approved :: MIT License",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.10",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9"
    ],
    "description": "# pypgoutput\n\nPython package to read, parse and convert PostgreSQL logical decoding messages to change data capture messages. Built using psycopg2's logical replication support objects, PostgreSQL's pgoutput plugin and Pydantic.\n\nUses python >= 3.8\n\nDeveloped on PostgreSQL 12 for now.\n\n## Installation\n\n```console\n$ pip install pypgoutput\n```\n\n## How it works\n\n* Replication messages are consumed via psycopg2's replication connection. <https://www.psycopg.org/docs/extras.html#replication-support-objects>\n* The binary messages from pgoutput logical decoding are parsed in the `decoders.py` module.\n* Parsed messages are converted to change events and yieled from the `LogicalReplicationReader`\n* Change events are nested Pydantic models where the tuple data (before/after) schema is dynamically generated depending on the table being processed.\n\n## Example\n\nFirst, setup a publication and a logical replication slot in the source database.\n\n```sql\nCREATE PUBLICATION test_pub FOR ALL TABLES;\nSELECT * FROM pg_create_logical_replication_slot('test_slot', 'pgoutput');\n```\n\nSecond, run the script to collect the changes:\n\n```py\nimport os\nimport pypgoutput\n\nHOST = os.environ.get(\"PGHOST\")\nPORT = os.environ.get(\"PGPORT\")\nDATABASE_NAME = os.environ.get(\"PGDATABASE\")\nUSER = os.environ.get(\"PGUSER\")\nPASSWORD = os.environ.get(\"PGPASSWORD\")\n\n\ncdc_reader = pypgoutput.LogicalReplicationReader(\n                publication_name=\"test_pub\",\n                slot_name=\"test_slot\",\n                host=HOST,\n                database=DATABASE_NAME,\n                port=PORT,\n                user=USER,\n                password=PASSWORD,\n            )\nfor message in cdc_reader:\n    print(message.json(indent=2))\n\ncdc_reader.stop()\n```\n\nGenerate some change messages\n\n```sql\nCREATE TABLE public.readme (id integer primary key, created_at timestamptz default now());\n\nINSERT INTO public.readme (id) SELECT data FROM generate_series(1, 3) AS data;\n```\n\nOutput:\n\n```json\n{\n  \"op\": \"I\",\n  \"message_id\": \"4606b12b-ab41-41e6-9717-7ce92f8a9857\",\n  \"lsn\": 23530912,\n  \"transaction\": {\n    \"tx_id\": 499,\n    \"begin_lsn\": 23531416,\n    \"commit_ts\": \"2022-01-14T17:22:10.298334+00:00\"\n  },\n  \"table_schema\": {\n    \"column_definitions\": [\n      {\n        \"name\": \"id\",\n        \"part_of_pkey\": true,\n        \"type_id\": 23,\n        \"type_name\": \"integer\",\n        \"optional\": false\n      },\n      {\n        \"name\": \"created_at\",\n        \"part_of_pkey\": false,\n        \"type_id\": 1184,\n        \"type_name\": \"timestamp with time zone\",\n        \"optional\": true\n      }\n    ],\n    \"db\": \"test_db\",\n    \"schema_name\": \"public\",\n    \"table\": \"readme\",\n    \"relation_id\": 16403\n  },\n  \"before\": null,\n  \"after\": {\n    \"id\": 1,\n    \"created_at\": \"2022-01-14T17:22:10.296740+00:00\"\n  }\n}\n{\n  \"op\": \"I\",\n  \"message_id\": \"1ede0643-42b6-4bb1-8a98-8e4ca10c7915\",\n  \"lsn\": 23531144,\n  \"transaction\": {\n    \"tx_id\": 499,\n    \"begin_lsn\": 23531416,\n    \"commit_ts\": \"2022-01-14T17:22:10.298334+00:00\"\n  },\n  \"table_schema\": {\n    \"column_definitions\": [\n      {\n        \"name\": \"id\",\n        \"part_of_pkey\": true,\n        \"type_id\": 23,\n        \"type_name\": \"integer\",\n        \"optional\": false\n      },\n      {\n        \"name\": \"created_at\",\n        \"part_of_pkey\": false,\n        \"type_id\": 1184,\n        \"type_name\": \"timestamp with time zone\",\n        \"optional\": true\n      }\n    ],\n    \"db\": \"test_db\",\n    \"schema_name\": \"public\",\n    \"table\": \"readme\",\n    \"relation_id\": 16403\n  },\n  \"before\": null,\n  \"after\": {\n    \"id\": 2,\n    \"created_at\": \"2022-01-14T17:22:10.296740+00:00\"\n  }\n}\n{\n  \"op\": \"I\",\n  \"message_id\": \"fb477de5-8281-4102-96ee-649a838d38f2\",\n  \"lsn\": 23531280,\n  \"transaction\": {\n    \"tx_id\": 499,\n    \"begin_lsn\": 23531416,\n    \"commit_ts\": \"2022-01-14T17:22:10.298334+00:00\"\n  },\n  \"table_schema\": {\n    \"column_definitions\": [\n      {\n        \"name\": \"id\",\n        \"part_of_pkey\": true,\n        \"type_id\": 23,\n        \"type_name\": \"integer\",\n        \"optional\": false\n      },\n      {\n        \"name\": \"created_at\",\n        \"part_of_pkey\": false,\n        \"type_id\": 1184,\n        \"type_name\": \"timestamp with time zone\",\n        \"optional\": true\n      }\n    ],\n    \"db\": \"test_db\",\n    \"schema_name\": \"public\",\n    \"table\": \"readme\",\n    \"relation_id\": 16403\n  },\n  \"before\": null,\n  \"after\": {\n    \"id\": 3,\n    \"created_at\": \"2022-01-14T17:22:10.296740+00:00\"\n  }\n}\n```\n\n## Why use this package?\n\n* Preference to use the built in pgoutput plugin. Some plugins are not available in managed database services such as RDS or cannot be updated to a new version.\n* The pgoutput plugin includes useful metadata such as relid.\n\n## Useful links\n\n* logical decoding: <https://www.postgresql.org/docs/12/logicaldecoding.html>\n* message specification: <https://www.postgresql.org/docs/12/protocol-logicalrep-message-formats.html>\n* postgres publication: <https://www.postgresql.org/docs/12/sql-createpublication.html>\n* psycopg2 replication support: <https://www.psycopg.org/docs/extras.html#replication-support-objects>\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/dgea005/pypgoutput",
    "keywords": "",
    "license": "",
    "maintainer": "",
    "maintainer_email": "",
    "name": "pypgoutput",
    "package_url": "https://pypi.org/project/pypgoutput/",
    "platform": "",
    "project_url": "https://pypi.org/project/pypgoutput/",
    "project_urls": {
      "Homepage": "https://github.com/dgea005/pypgoutput"
    },
    "release_url": "https://pypi.org/project/pypgoutput/0.0.3/",
    "requires_dist": [
      "psycopg2",
      "pydantic"
    ],
    "requires_python": ">=3.8",
    "summary": "PostgreSQL CDC library using pgoutput and python",
    "version": "0.0.3",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 12945865,
  "releases": {
    "0.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "b525ca1643860409360738c9fca1f6e7879b2e7bed030cded31dec232c84666b",
          "md5": "337615fa6e68ff634320eef08aab5a8c",
          "sha256": "861628b387904c68f78930c25597270783f37ddeaab865b3bdee1525cbf372eb"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "337615fa6e68ff634320eef08aab5a8c",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 12674,
        "upload_time": "2022-01-18T22:51:13",
        "upload_time_iso_8601": "2022-01-18T22:51:13.129712Z",
        "url": "https://files.pythonhosted.org/packages/b5/25/ca1643860409360738c9fca1f6e7879b2e7bed030cded31dec232c84666b/pypgoutput-0.0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "042a3e5a1ba4643602c8ef68653b423b11d0c4a6690937d168a5ca4ad7493e4e",
          "md5": "1681f389c98e3dd29538f986df7fdb5a",
          "sha256": "1f06258c7d36144ecfe639874c7e340b5db1f698b83d77bc1339509c299410d9"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "1681f389c98e3dd29538f986df7fdb5a",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 13472,
        "upload_time": "2022-01-18T22:51:15",
        "upload_time_iso_8601": "2022-01-18T22:51:15.240805Z",
        "url": "https://files.pythonhosted.org/packages/04/2a/3e5a1ba4643602c8ef68653b423b11d0c4a6690937d168a5ca4ad7493e4e/pypgoutput-0.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.0.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4e76e4d80b56a22322edf583a5fd3e1fae33c5304787669f33e60d3510efd9fa",
          "md5": "e4acdac5582abc2484832613e6a083a5",
          "sha256": "ed85bab092b3e458ed4e79b036fb21db3df170f4b17781f43ab1f01da3b6b165"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.2-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "e4acdac5582abc2484832613e6a083a5",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 13001,
        "upload_time": "2022-01-25T23:09:59",
        "upload_time_iso_8601": "2022-01-25T23:09:59.374458Z",
        "url": "https://files.pythonhosted.org/packages/4e/76/e4d80b56a22322edf583a5fd3e1fae33c5304787669f33e60d3510efd9fa/pypgoutput-0.0.2-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "7fcf06fbe131c775c888f0191cc0f66a267d83be1fcef0730deeebf703283c17",
          "md5": "00add2f9c978e074561d0edb22bde9f1",
          "sha256": "fc67faf97e1b3008fca4e46c7a1f58aa046caf6144023fd53e40e082d8f60bb6"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.2.tar.gz",
        "has_sig": false,
        "md5_digest": "00add2f9c978e074561d0edb22bde9f1",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 13954,
        "upload_time": "2022-01-25T23:10:01",
        "upload_time_iso_8601": "2022-01-25T23:10:01.941522Z",
        "url": "https://files.pythonhosted.org/packages/7f/cf/06fbe131c775c888f0191cc0f66a267d83be1fcef0730deeebf703283c17/pypgoutput-0.0.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.0.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "7ae8755a5b68b4b9bd36d962735a5291bddfb3d417e48b3e73dc950c6946e924",
          "md5": "28a246dd3fff4526564a22301c6c2afe",
          "sha256": "8790f83cc15f4e52e9df9fea6a42cfb86d9839ac5c93b16587bd0950873904e0"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.3-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "28a246dd3fff4526564a22301c6c2afe",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 13459,
        "upload_time": "2022-02-19T18:19:28",
        "upload_time_iso_8601": "2022-02-19T18:19:28.556513Z",
        "url": "https://files.pythonhosted.org/packages/7a/e8/755a5b68b4b9bd36d962735a5291bddfb3d417e48b3e73dc950c6946e924/pypgoutput-0.0.3-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "10d931efb332fa254a703a9eaf50054af70897834a75a0fd3f40d7e74373215a",
          "md5": "099061b5dcea6320338df49f92ae454e",
          "sha256": "0866a11ee4938a234bdac58624646760109348614b436612978b3496aae4fddb"
        },
        "downloads": -1,
        "filename": "pypgoutput-0.0.3.tar.gz",
        "has_sig": false,
        "md5_digest": "099061b5dcea6320338df49f92ae454e",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 14258,
        "upload_time": "2022-02-19T18:19:30",
        "upload_time_iso_8601": "2022-02-19T18:19:30.404058Z",
        "url": "https://files.pythonhosted.org/packages/10/d9/31efb332fa254a703a9eaf50054af70897834a75a0fd3f40d7e74373215a/pypgoutput-0.0.3.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "7ae8755a5b68b4b9bd36d962735a5291bddfb3d417e48b3e73dc950c6946e924",
        "md5": "28a246dd3fff4526564a22301c6c2afe",
        "sha256": "8790f83cc15f4e52e9df9fea6a42cfb86d9839ac5c93b16587bd0950873904e0"
      },
      "downloads": -1,
      "filename": "pypgoutput-0.0.3-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "28a246dd3fff4526564a22301c6c2afe",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.8",
      "size": 13459,
      "upload_time": "2022-02-19T18:19:28",
      "upload_time_iso_8601": "2022-02-19T18:19:28.556513Z",
      "url": "https://files.pythonhosted.org/packages/7a/e8/755a5b68b4b9bd36d962735a5291bddfb3d417e48b3e73dc950c6946e924/pypgoutput-0.0.3-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "10d931efb332fa254a703a9eaf50054af70897834a75a0fd3f40d7e74373215a",
        "md5": "099061b5dcea6320338df49f92ae454e",
        "sha256": "0866a11ee4938a234bdac58624646760109348614b436612978b3496aae4fddb"
      },
      "downloads": -1,
      "filename": "pypgoutput-0.0.3.tar.gz",
      "has_sig": false,
      "md5_digest": "099061b5dcea6320338df49f92ae454e",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.8",
      "size": 14258,
      "upload_time": "2022-02-19T18:19:30",
      "upload_time_iso_8601": "2022-02-19T18:19:30.404058Z",
      "url": "https://files.pythonhosted.org/packages/10/d9/31efb332fa254a703a9eaf50054af70897834a75a0fd3f40d7e74373215a/pypgoutput-0.0.3.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}