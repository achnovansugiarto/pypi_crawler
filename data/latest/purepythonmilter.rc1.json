{
  "info": {
    "author": "",
    "author_email": "Gert van Dijk <github@gertvandijk.nl>",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 3 - Alpha",
      "License :: OSI Approved :: Apache Software License",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.10",
      "Topic :: Communications :: Email",
      "Topic :: Communications :: Email :: Filters",
      "Topic :: Communications :: Email :: Mail Transport Agents",
      "Topic :: Software Development :: Libraries",
      "Typing :: Typed"
    ],
    "description": "<!--\nSPDX-FileCopyrightText: 2023 Gert van Dijk <github@gertvandijk.nl>\n\nSPDX-License-Identifier: Apache-2.0\n-->\n\n# A modern pure-Python Milter framework\n\n[![Python 3.10+](https://img.shields.io/badge/Python-3.10%2B-blue)](https://python.org/)\n[![Checked with mypy](https://img.shields.io/badge/mypy-strict-blue)](https://mypy.readthedocs.io/en/stable/)\n[![Code style: black](https://img.shields.io/badge/code%20style-black-000000)](https://github.com/psf/black)\n[![Ruff](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/charliermarsh/ruff/main/assets/badge/v1.json)](https://github.com/charliermarsh/ruff)\n[![Imports: isort](https://img.shields.io/badge/imports-isort-%231674b1?labelColor=ef8336)](https://pycqa.github.io/isort/)\n[![Hadolint](https://img.shields.io/badge/hadolint-passing-brightgreen)](https://github.com/hadolint/hadolint)\n[![ShellCheck](https://img.shields.io/badge/ShellCheck-passing-brightgreen)](https://www.shellcheck.net/)\n[![License: Apache 2.0](https://img.shields.io/badge/License-Apache_2.0-brightgreen)](https://www.apache.org/licenses/LICENSE-2.0)\n[![REUSE compliant](https://img.shields.io/badge/reuse-compliant-brightgreen)](https://reuse.software/)\n\nMail servers ([MTA][wikipedia-mta]s) like [Postfix][postfix-home] and\n[Sendmail][sendmail-org-home] can connect to an external filter process, called a\n'Milter', for actions to take during an incoming SMTP transaction.\nYou may consider it like a plugin on the mail server software using callbacks over a TCP\nor UNIX socket.\n\nA Milter can have any custom condition to reject/tempfail/discard a message, manipulate\nheaders and/or body and more.\nThis can be useful if you require custom validations or manupulative actions before mail\nis accepted and that is unavailable in ~~your MTA's~~ Postfix's built-in features.\nThe use of a Milter would typically be the right choice when it comes to complex\ndecision making on accepting mail 'before queue' with conditions on headers or the\nmessage body.\n\n*Purepythonmilter* aims to be a modern, Postfix-first, high-quality, strictly typed\nframework and library.\nAnd then all of that with an easy to use API and a high-performance asynchronous\nembedded server.\n\n## Getting started ðŸš€\n\nInstall Purepythonmilter, e.g. using `pip`:\n\n```console\n$ pip install purepythonmilter\n```\n\nSelf-descriptive example Milter app:\n\n```python\nimport purepythonmilter as ppm\n\n\nasync def on_mail_from(cmd: ppm.MailFrom) -> ppm.VerdictOrContinue:\n    if cmd.address.lower().endswith(\"@example.com\"):\n        return ppm.RejectWithCode(primary_code=(5, 7, 1), text=\"not allowed here!\")\n    return ppm.Continue()\n\n\nmymilter = ppm.PurePythonMilter(name=\"mymilter\", hook_on_mail_from=on_mail_from)\nmymilter.run_server(host=\"127.0.0.1\", port=9000)\n```\n\n### Configuration with Postfix\n\n1. Start your Milter application or run one of the examples directly â€” see\n   [`examples/`][examples-readme].\n2. Start a Postfix instance with a configuration like\n   `smtpd_milters = inet:127.0.0.1:9000` (replace IP address and port number\n   accordingly).\n\n### Run an example Milter app with Postfix in Docker\n\nDescribed here ðŸ‘‰ [`examples/README.md`][examples-readme].\n\n## *Example* use cases for a Milter app ðŸ’¡\n\n- From-header and envelope sender (Return-Path) alignment validation, for compliance\n  with DMARC ([RFC7489 section 3.1][dmarc-rfc7489-sec31]) or reasons of preventing abuse\n  (impersonation).\n  Pevent sending such messages out by rejecting non-compliant messages on submission\n  time already and incude a descriptive error message to the user.\n- Encrypt sensitive connection/account information and attach that in a custom header\n  value for outbound mail.\n  In case of abuse, the information can be decrypted by an operator from the raw mails\n  concerned and eliminates the need to store this data centrally for all mail.\n- Cryptographically sign outgoing email or verify signatures of incoming email with some\n  custom scheme.\n  *In case you don't like the existing commonly used [OpenDKIM Milter][opendkim-readme]\n  and want to implement your own DKIM signer/verifier.*\n\n## What about PyMilter?\n\nPurepythonmilter was written as an alternative to, and, out of frustration with it.\n[PyMilter] is not type annotated (mypy), has signal handling issues (for me), the\ndependency on a [hand-crafted Python-C-extension][pymilter-miltermodule-c] linking to\nSendmail's libmilter and no offering of a binary package ([wheel][pep-427]) to ease\ninstallation. ðŸ˜¥\n\n*By the way, did you know that Sendmail is â€” yes even in 2023 â€” written in K&R C\n(predating ANSI-C)?[^sendmail-relnotes-kr-c-deprecation]* ðŸ™ˆ\n\nSo, yeah, that's the short version of why I started this project. ðŸ¤“\n\n## Documentation ðŸ“–\n\n- [`docs/design.md`](./docs/design.md) â€” design and intents of this project. ðŸ§ \n- [`docs/api.md`](./docs/api.md) â€” API documentation\n- [`docs/milter-protocol.md`](./docs/milter-protocol.md) â€” raw protocol notes. âœï¸\n- [`CONTRIBUTING.md`](./CONTRIBUTING.md) â€” for development setup and contribution\n  guidelines\n\n## Limitations\n\n- Any functionality requiring intermediary responses (such as 'progress') is not yet\n  implemented in the API.\n- Any functionality that requires carrying state over phases is not yet supported in the\n  API. (e.g. combining input from two different hooks)\n- Mail headers are not 'folded'/'unfolded', but given or written as-is.\n- UNIX domain sockets are not supported for the Milter server to listen on (TCP is).\n\n## Feedback ðŸ’¬\n\nThis project is very new and feedback is very much welcome!\nPlease don't hesitate to [file an issue][github-new-issue], drop an idea or ask a\nquestion in the [discussions][github-new-discussion].\n\n[Ideas & Feature Requests][github-ideas-feature-requests] are in there too. ðŸ’¡\n\nAlternatively, just drop me a message at `github@gertvandijk.nl`. ðŸ“¬\n\n## When *not* to use a Milter\n\nIf you want to accomplish something that could be done using a custom dynamic\nlookup in Postfix, such as message routing or policy lookups.\nPostfix offers quite some built-in dynamic lookup types and a Milter is probably *not*\nwhat you're looking for.\nThe Milter protocol is relatively complex and its use may not be required for your use\ncase.\n\nBe sure to also have a look at implementing your own custom dynamic lookup table in\nPostfix using the [socketmap protocol][postfix-socketmap-table] or policy delegation\nwith the much simpler [policy delegation protocol][postfix-smtpd-policy-protocol].\nMost of the email's and connection's *metadata* is available there too.\nFor example, the [postfix-mta-sts-resolver] uses the former and the SPF policy daemon\n[pypolicyd-spf] uses the latter.\nSometimes the use of a Milter may still be considered; for example, the SPF verification\nfilter [spf-milter] is implemented using the Milter protocol.\n\nFor content inspection, there's Postfix's [Content filter][postfix-filter-readme], but\nbeware that it's running 'after queue'.\nIt takes quite some orchestration to avoid bounces and correctly feed the mail back into\nPostfix.\n\nAnother aspect to consider is MTA support.\nWhile the alternatives for Postfix listed above are still Postfix-specific, other more\ngeneric lookup methods also exist.\nFor example, a dynamic DNS lookup could be much better adopted when migrating to another\nMTA than any of the above.\n\nExample use cases which are *possible* to implement using a Milter, but what could also\nbe accomplished using alternative â€” likely simpler â€” ways:\n\n- Inject custom headers to add information on which `smtpd` instance the email was\n  received for routing/classifications later.\n  This would typically be done using Postfix's policy delegation returning\n  `PREPEND headername: headertext` as action.\n- Validate sender restrictions for a data backend type not supported by the Postfix,\n  such as interacting with an HTTP REST API / webhooks.\n  Again, policy delegation may be much simpler, but if conditions involve mail contents,\n  then you may need a Milter still.\n- Custom centralized rate limiting and billing in an email hosting platform with several\n  account tiers.\n  And similarly for this one, policy delegation is probably much simpler.\n- A read-only Milter that logs in a structured way and perhaps with certain conditions.\n  This would eliminate parsing Postfix's text log files, well, for incoming connections\n  at least.\n  [Freeaqingme/ClueGetter] is such an application using the Milter protocol for a part\n  of the functionality.\n\n## Alternatives to Purepythonmilter\n\nPython alternatives appear to be unmaintained and no longer actively supported for\nyears.\n\n- [python-libmilter]: marked as ['no longer supporting'][python-libmilter-readme-note],\n  as of late 2022.\n- [PpyMilter]: Python 2-only (last commit 2015).\n\nAlternatives in other programming languages without a dependency on Sendmail's libmilter\nare:\n\n- [indymilter]: an asynchronous Milter library written in **Rust**.\n- [Sendmail::PMilter][sendmail-pmilter]: a pure-**Perl** implementation (last release\n  2011).\n- [emersion/go-milter]: a Milter library written in **Go** (in active development).\n- [phalaaxx/milter]: another Milter library written in **Go** (last commit 2020).\n- [andybalholm/milter]: a simple framework for writing milters written in **Go** (last\n  commit 2016).\n- [nightcode/jmilter]: a Milter library written in **Java**.\n- [sendmail-jilter]: another Milter library written in **Java** (last release 2011).\n- [milterjs][Atlantis-Software/milterjs]: a Milter library written in **Javascript**\n  (last release 2018).\n\nOther relevant projects (not really reusable libraries):\n[phalaaxx/ratemilter], [phalaaxx/pf-milters], [mschneider82/milterclient],\n[andybalholm/grayland], [Freeaqingme/ClueGetter].\n\n## License\n\nThe major part of the project is [Apache 2.0][apache-license-2] licensed.\n\nFiles deemed insignificant in terms of copyright such as configuration files are\nlicensed under the public domain \"no rights reserved\" [CC0] license.\n\nThe repositoy is [REUSE][reuse-home] compliant.\n\n\n[PyMilter]: https://pythonhosted.org/pymilter/\n[PpyMilter]: https://github.com/jmehnle/ppymilter\n[python-libmilter]: https://github.com/crustymonkey/python-libmilter\n[postfix-socketmap-table]: https://www.postfix.org/socketmap_table.5.html\n[postfix-smtpd-policy-protocol]: https://www.postfix.org/SMTPD_POLICY_README.html#protocol\n[pypolicyd-spf]: https://launchpad.net/pypolicyd-spf\n[dmarc-rfc7489-sec31]: https://datatracker.ietf.org/doc/html/rfc7489#section-3.1\n[opendkim-readme]: http://www.opendkim.org/opendkim-README\n[sendmail-pmilter]: https://metacpan.org/pod/Sendmail::PMilter\n[postfix-mta-sts-resolver]: https://github.com/Snawoot/postfix-mta-sts-resolver\n[wikipedia-mta]: https://en.wikipedia.org/wiki/Message_transfer_agent\n[postfix-home]: https://www.postfix.org/\n[sendmail-org-home]: https://www.sendmail.org/\n[sendmail-relnotes-kr-c-deprecation]: https://salsa.debian.org/debian/sendmail/-/blob/0ad6934dd77ca9ef1e2a64a9862ceb9b56a7d3f8/RELEASE_NOTES#L48-53\n[examples-readme]: ./src/purepythonmilter/examples/README.md\n[postfix-filter-readme]: https://www.postfix.org/FILTER_README.html\n[indymilter]: https://gitlab.com/glts/indymilter\n[andybalholm/milter]: https://github.com/andybalholm/milter\n[andybalholm/grayland]: https://github.com/andybalholm/grayland\n[emersion/go-milter]: https://github.com/emersion/go-milter\n[phalaaxx/milter]: https://github.com/phalaaxx/milter\n[phalaaxx/ratemilter]: https://github.com/phalaaxx/ratemilter\n[phalaaxx/pf-milters]: https://github.com/phalaaxx/pf-milters\n[mschneider82/milterclient]: https://github.com/mschneider82/milterclient\n[Freeaqingme/ClueGetter]: https://github.com/Freeaqingme/ClueGetter\n[nightcode/jmilter]: https://github.com/nightcode/jmilter\n[sendmail-jilter]: http://sendmail-jilter.sourceforge.net/\n[Atlantis-Software/milterjs]: https://github.com/Atlantis-Software/milterjs\n[github-new-issue]: https://github.com/gertvdijk/purepythonmilter/issues/new/choose\n[github-new-discussion]: https://github.com/gertvdijk/purepythonmilter/discussions/new\n[github-ideas-feature-requests]: https://github.com/gertvdijk/purepythonmilter/discussions/categories/ideas-feature-requests\n[spf-milter]: https://gitlab.com/glts/spf-milter\n[python-libmilter-readme-note]: https://github.com/crustymonkey/python-libmilter/blob/9793148913232b726da692c7fd0ae2c3edec497c/README.md#no-longer-supporting\n[CC0]: https://creativecommons.org/share-your-work/public-domain/cc0/\n[apache-license-2]: https://www.apache.org/licenses/LICENSE-2.0\n[reuse-home]: https://reuse.software/\n[pep-427]: https://peps.python.org/pep-0427/\n[pymilter-miltermodule-c]: https://github.com/sdgathman/pymilter/blob/master/miltermodule.c\n\n[^sendmail-relnotes-kr-c-deprecation]: [Sendmail 8.71.1 Release notes][sendmail-relnotes-kr-c-deprecation]:\n\n    > 2021/08/17\n    >\n    > Deprecation notice: due to compatibility problems with some third party code, we\n    > plan to finally switch from K&R to ANSI C. If you are using sendmail on a system\n    > which does not have a compiler for ANSI C contact us with details as soon as\n    > possible so we can determine how to proceed.\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "",
    "keywords": "",
    "license": "Apache License 2.0",
    "maintainer": "",
    "maintainer_email": "",
    "name": "purepythonmilter",
    "package_url": "https://pypi.org/project/purepythonmilter/",
    "platform": null,
    "project_url": "https://pypi.org/project/purepythonmilter/",
    "project_urls": {
      "homepage": "https://github.com/gertvdijk/purepythonmilter",
      "repository": "https://github.com/gertvdijk/purepythonmilter.git"
    },
    "release_url": "https://pypi.org/project/purepythonmilter/0.0.1/",
    "requires_dist": [
      "attrs",
      "black ; extra == 'development'",
      "build ; extra == 'development'",
      "flake8 ; extra == 'development'",
      "isort ; extra == 'development'",
      "mypy ; extra == 'development'",
      "pytest-asyncio ; extra == 'development'",
      "pytest-cov ; extra == 'development'",
      "pytest ; extra == 'development'",
      "pyupgrade ; extra == 'development'",
      "reuse ; extra == 'development'",
      "ruff ; extra == 'development'",
      "setuptools-scm[toml] (>=6.2) ; extra == 'development'",
      "twine ; extra == 'development'",
      "validate-pyproject[all] ; extra == 'development'",
      "click ; extra == 'examples'"
    ],
    "requires_python": ">=3.10",
    "summary": "A Milter library and app framework in pure-Python with asyncio",
    "version": "0.0.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 16701384,
  "releases": {
    "0.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "a259c5b8d01a0e1350be27c57e7793d07ab4f9c61235f471da48c09a91d5f524",
          "md5": "94571ecff1f17106e2b1b1326b42a9ae",
          "sha256": "57272f9589f6de95ba4cf643ba86f17a309d19a3a720d30fb95b128915d6517e"
        },
        "downloads": -1,
        "filename": "purepythonmilter-0.0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "94571ecff1f17106e2b1b1326b42a9ae",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.10",
        "size": 49162,
        "upload_time": "2023-02-05T15:10:33",
        "upload_time_iso_8601": "2023-02-05T15:10:33.708413Z",
        "url": "https://files.pythonhosted.org/packages/a2/59/c5b8d01a0e1350be27c57e7793d07ab4f9c61235f471da48c09a91d5f524/purepythonmilter-0.0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "ad9ed5b481a8466ad7359197d44016063de5a00153822d7c0d523f6516cb1dee",
          "md5": "b248f9c8ab86f364209233ef8b608821",
          "sha256": "1e08698ed556c3044f89ab09bbbd67e30a5402342e55ef8232e4396f5bac1790"
        },
        "downloads": -1,
        "filename": "purepythonmilter-0.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "b248f9c8ab86f364209233ef8b608821",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.10",
        "size": 82921,
        "upload_time": "2023-02-05T15:10:36",
        "upload_time_iso_8601": "2023-02-05T15:10:36.081496Z",
        "url": "https://files.pythonhosted.org/packages/ad/9e/d5b481a8466ad7359197d44016063de5a00153822d7c0d523f6516cb1dee/purepythonmilter-0.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "a259c5b8d01a0e1350be27c57e7793d07ab4f9c61235f471da48c09a91d5f524",
        "md5": "94571ecff1f17106e2b1b1326b42a9ae",
        "sha256": "57272f9589f6de95ba4cf643ba86f17a309d19a3a720d30fb95b128915d6517e"
      },
      "downloads": -1,
      "filename": "purepythonmilter-0.0.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "94571ecff1f17106e2b1b1326b42a9ae",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.10",
      "size": 49162,
      "upload_time": "2023-02-05T15:10:33",
      "upload_time_iso_8601": "2023-02-05T15:10:33.708413Z",
      "url": "https://files.pythonhosted.org/packages/a2/59/c5b8d01a0e1350be27c57e7793d07ab4f9c61235f471da48c09a91d5f524/purepythonmilter-0.0.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "ad9ed5b481a8466ad7359197d44016063de5a00153822d7c0d523f6516cb1dee",
        "md5": "b248f9c8ab86f364209233ef8b608821",
        "sha256": "1e08698ed556c3044f89ab09bbbd67e30a5402342e55ef8232e4396f5bac1790"
      },
      "downloads": -1,
      "filename": "purepythonmilter-0.0.1.tar.gz",
      "has_sig": false,
      "md5_digest": "b248f9c8ab86f364209233ef8b608821",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.10",
      "size": 82921,
      "upload_time": "2023-02-05T15:10:36",
      "upload_time_iso_8601": "2023-02-05T15:10:36.081496Z",
      "url": "https://files.pythonhosted.org/packages/ad/9e/d5b481a8466ad7359197d44016063de5a00153822d7c0d523f6516cb1dee/purepythonmilter-0.0.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}