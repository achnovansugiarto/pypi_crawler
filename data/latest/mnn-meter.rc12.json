{
  "info": {
    "author": "Haolin Yan",
    "author_email": "haolinyan_xdu@163.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 4 - Beta",
      "Intended Audience :: Developers",
      "Programming Language :: Python :: 3",
      "Topic :: Software Development :: Libraries"
    ],
    "description": "![img.png](img.png)\n---\nTools for quickly building operator \nlatency tables and for accurately predicting \nmodel latency (based on Pytorch and MNN)\n\n[中文版](README_zh.md)\n## 1.Installation\nMMT is used in both server-side and inference-side situations: \n* on the server side, the operator list is generated according to the specified operator space; \nthe delay of a given model is predicted according to the operator delay table. \n* On the inference side, test the operator delay according to the operator list to obtain the operator latency table. \n\nThe server side must install `Pytorch` and `MNN(C++)` at the same time, \nand the inference side must install `MNN(C++)` \n\n**Note: Be sure to add the `build` folder generated by compiling `MNN` to the environment variable!**\n\nAfter configuring the above dependencies, install MMT\n```\npip install mmn-meter\n```\n\n## 2.Start\n### 2.1 Modify your models\nFor your custom model(layer), please override __repr__() with unique representation of the parameters, for example:\n```python\n    def __init__(self, ...)\n     self.name = \"ResNetBasicBlock-%d-%d-%d-%d-\" % (in_channels, out_channels, stride, kernel)\n    ...\n    def __repr__(self):\n        return self.name\n```\n**If the results returned by `__repr__()` cannot be differentiated for the same type of operator input with different parameters, \nit is very easy to cause running errors or measurement errors!**\n\n[See how to modify your model](docs/configuration.md)\n\n### 2.2 Export the operators\nAfter the `mmt=2.x` version, both \n`description file generation` and `function generation` are supported.\n### 2.2.1 Method 1: Write an operator description file\nThe parameters that determine the specific delay of \nan operator include (operator type, operator \ninstantiation parameters, input shape). \nThe specific operator space \nneeds to be expressed in the following way:\n```yaml\nresnet18:\n    ResNetBasicBlock:\n        in_channels: [64, 128, 256, 512]\n        out_channels: [64, 128, 256, 512]\n        stride: [1]\n        kernel: [3, 5, 7]\n        input_shape: [[1, 64, 112, 112], [1, 128, 56, 56], [1, 256, 28, 28], [1, 512, 14, 14]]\n\ntorch.nn:\n    Conv2d:\n        in_channels: [3]\n        out_channels: [64]\n        kernel_size: [7]\n        stride: [2]\n        padding: [3]\n        input_shape: [[1, 3, 224, 224]]\n\n    BatchNorm2d:\n        num_features: [64]\n        input_shape: [[1, 64, 112, 112]]\n\n    ReLU:\n        no_params: true\n        input_shape: [[1, 64, 112, 112]]\n```\n[Refer to how to describe your operator](docs/configuration.md)\n\nThen use the following command to create a list of operators and export the operators to mnn format.\n```python\nfrom mmt.converter import generate_ops_list\n\ngenerate_ops_list(\"ops.yaml\", \"/path/ops_folder\")\n```\n`ops.yaml` is the operator description file, \n`pathops_folder` is the directory where \nthe operator is saved, and the corresponding \n`meta.pkl` will be generated in this directory \nto save the metadata information of the operator.\n\n### 2.2.1 Method 2: Functional Generation\nHighly similar to Mode 1, it is directly registered and generated by using the `mmt.register` function, and supports multiple registration of operators of the same type to reduce redundant operators caused by unnecessary combinations (the disadvantage of Mode 1),\nfor [example](demo/MobileNetV3/convert.py)\n```python\nfrom mmt.converter import register\nimport torch.nn as nn\nfp = \"./mbv3_ops\"\nreg = lambda ops, **kwargs: register(ops, fp, **kwargs)\nreg(nn.Linear,\n    in_features=[576, 1024],\n    out_features=[1024, 1000],\n    bias=[True],\n    input_shape=[[1, 576], [1, 1024]],\n    )\n```\nMethod 1:\n```yaml\ntorch.nn:\n    Linear:\n        in_features: [576, 1024]\n        out_features: [1024, 1000]\n        bias: [True]\n        input_shape: [[1, 576], [1, 1024]]\n```\nThe corresponding operator can be generated by directly running the written file. For more details,\nplease refer to [Example](demo/MobileNetV3/tutorial.md)\n\n`mmt` supports training a machine learning model with a \nsmall number of model real and predicted delays as training \nsamples for more accurate predictors.\n\nHere we use the function `export_models` to save model and convert it to the \n`mnn' format. You could create models with different configs, and save these models\nin one folder.\n```python\nfrom mmt.converter import export_models\nfor i in range(16):\n    cfg_ = generate_cfg(cfgs)  # generate config\n    net = MobileNetV3(cfg_, id=i, mode=\"small\")  # create a model\n    export_models(net, [1, 3, 224, 224], \"mbv3\")\n    # save this model at \"./mbv3\" and convert it to .mnn\n```\n### 2.3 Record operator delays on the deployment side, and build an operator latency table\n\n```python\nfrom mmt.meter import meter_ops\n\nmeter_ops(\"./ops\", times=100)\n```\n`ops` is the folder where the operator and `meta.pkl` are saved, \n`times` represents the number of repeated tests, \nrun the modified program, the delay of the operator \nwill be calculated, and the operator latency table will be \nsaved as `.ops/meta_latency.pkl` . This file \nspecifically records the metadata and corresponding \nlatency of all operators.\n\nSimilarly, you can directly test the model in the folder and record the delay.\n```python\nfrom mmt.meter import meter_models\nmeter_models(\"mbv3\")\n```\n\n\n### 2.4 Predicting model latency on the server side\n\n```python\nfrom mmt.parser import predict_latency\n\n...\nmodel = ResNet18()\npred_latency = predict_latency(model, path, [1, 3, 224, 224], verbose=False)\n```\n`path` is the path corresponding to `meta_latency.pkl`. \nNote that the shape of the input tensor must be \nthe same as the `input_shape` set in the operator \ndescription.\n\nBuild more accurate predictors with machine learning models：\n```python\nfrom mmt.converter import validation\nfrom mmt.predictor import latency_predictor\nvalidation(\"mbv3\", \"mbv3_ops/meta_latency.pkl\", save_path=\"train_error.csv\")\nlp = latency_predictor(\"mbv3_ops\", \"train_error.csv\")\npred_latency = lp(model, path, [1, 3, 224, 224])\n```\n## 3 Test the prediction error of MMT\nSpecific reference [MobileNetV3 test](demo/MobileNetV3/tutorial.md)\n\n|Model|Num|err(%)|device|\n|----|----|----|----|\n|MobileNet|334|4.1%*(39%)| 40  Intel(R) Xeon(R) Silver 4210R CPU @ 2.40GHz|\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "",
    "keywords": "",
    "license": "",
    "maintainer": "",
    "maintainer_email": "",
    "name": "mnn-meter",
    "package_url": "https://pypi.org/project/mnn-meter/",
    "platform": null,
    "project_url": "https://pypi.org/project/mnn-meter/",
    "project_urls": {
      "Source": "https://github.com/makerlin1/MMT"
    },
    "release_url": "https://pypi.org/project/mnn-meter/2.2.0/",
    "requires_dist": null,
    "requires_python": ">=3.5",
    "summary": "Tools for quickly building operator latency tables and for accurately predicting model latency (based on Pytorch and MNN)",
    "version": "2.2.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 13743862,
  "releases": {
    "1.0.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3756efd1d3bd3a8d2b472ff08ffc71628c2d70cee27382ac17136f550e25d62e",
          "md5": "f895fa9101aa171010aba207106ebfb2",
          "sha256": "d10ec9af9859ec700bdd81ee1a41931f63d5b2a08da70a5bb04cc04d361d7f41"
        },
        "downloads": -1,
        "filename": "mnn_meter-1.0.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "f895fa9101aa171010aba207106ebfb2",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.5",
        "size": 8252,
        "upload_time": "2022-05-03T17:28:19",
        "upload_time_iso_8601": "2022-05-03T17:28:19.983247Z",
        "url": "https://files.pythonhosted.org/packages/37/56/efd1d3bd3a8d2b472ff08ffc71628c2d70cee27382ac17136f550e25d62e/mnn_meter-1.0.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "0fdff208dec4dd257fabe292287ce0f2ba16b700b2922e8805831d78e3321476",
          "md5": "335885b1e33b1741fd6db081c30b7ccb",
          "sha256": "d955d7c5640414c6ea576e1cd57efb0cf107f6aaaed06f2ee610c0355efe6e86"
        },
        "downloads": -1,
        "filename": "mnn-meter-1.0.0.tar.gz",
        "has_sig": false,
        "md5_digest": "335885b1e33b1741fd6db081c30b7ccb",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 6266,
        "upload_time": "2022-05-03T17:28:22",
        "upload_time_iso_8601": "2022-05-03T17:28:22.286666Z",
        "url": "https://files.pythonhosted.org/packages/0f/df/f208dec4dd257fabe292287ce0f2ba16b700b2922e8805831d78e3321476/mnn-meter-1.0.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "1.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "fc152113c0d02222b2fd06df7c7d06cec2f89ca4a29a06e0fee5ff85ec80ba7b",
          "md5": "7e3a71c8ad49938b823c32b8cbf32e2f",
          "sha256": "d6670af6d51835bf3b40c30525312388102220fc44065a452cd620bc6351b66c"
        },
        "downloads": -1,
        "filename": "mnn-meter-1.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "7e3a71c8ad49938b823c32b8cbf32e2f",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 407782,
        "upload_time": "2022-05-04T08:11:36",
        "upload_time_iso_8601": "2022-05-04T08:11:36.754818Z",
        "url": "https://files.pythonhosted.org/packages/fc/15/2113c0d02222b2fd06df7c7d06cec2f89ca4a29a06e0fee5ff85ec80ba7b/mnn-meter-1.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "1.0.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "9f2ed8eed6f76c532883c2f910c4e99c1f1cc9f721772809a86b36f69de5f249",
          "md5": "2048de91014a236363ef738364302ca4",
          "sha256": "f1e02563df94d638e9eda217f6752cd98dc07ba9bff11e716814a9371ffc807a"
        },
        "downloads": -1,
        "filename": "mnn-meter-1.0.2.tar.gz",
        "has_sig": false,
        "md5_digest": "2048de91014a236363ef738364302ca4",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 410760,
        "upload_time": "2022-05-04T09:03:29",
        "upload_time_iso_8601": "2022-05-04T09:03:29.801009Z",
        "url": "https://files.pythonhosted.org/packages/9f/2e/d8eed6f76c532883c2f910c4e99c1f1cc9f721772809a86b36f69de5f249/mnn-meter-1.0.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.0.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "c87c3e1c794d5bb523e9883a52d76ba518be1415cb28ce94d95a9f0d49c29542",
          "md5": "c06b583f1cf14429a19e2baa1afcb848",
          "sha256": "dbbb5049e71c06204e7047ea74b1ebcad3748f1ed4a3192c8f4837bf5168acc0"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.0.0.tar.gz",
        "has_sig": false,
        "md5_digest": "c06b583f1cf14429a19e2baa1afcb848",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 413562,
        "upload_time": "2022-05-05T07:10:58",
        "upload_time_iso_8601": "2022-05-05T07:10:58.231233Z",
        "url": "https://files.pythonhosted.org/packages/c8/7c/3e1c794d5bb523e9883a52d76ba518be1415cb28ce94d95a9f0d49c29542/mnn-meter-2.0.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3c67d4818b181494b20f91c5571de4bc1cbf0fe398a11ef20e7f0bed4954be1c",
          "md5": "fa20e313bb9bc12663ff5b0dd760166c",
          "sha256": "7745b2c2a6749c2ea684d90edc98339e3d84d1c7f3ac8d52d8fe870ab9fac9d6"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "fa20e313bb9bc12663ff5b0dd760166c",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 413659,
        "upload_time": "2022-05-05T08:22:47",
        "upload_time_iso_8601": "2022-05-05T08:22:47.151094Z",
        "url": "https://files.pythonhosted.org/packages/3c/67/d4818b181494b20f91c5571de4bc1cbf0fe398a11ef20e7f0bed4954be1c/mnn-meter-2.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.0.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "1d83c1d79a0a7127d59c6a37137d6d20b7da7c9703a6ae58cae6ab2f81fb87e2",
          "md5": "7e19d96daf94807512e43e4bc831212b",
          "sha256": "333b7fd3c262007fd949fcecb071c64766ca65c18a26f66c8c28b3ae4953ca2f"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.0.2.tar.gz",
        "has_sig": false,
        "md5_digest": "7e19d96daf94807512e43e4bc831212b",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 413661,
        "upload_time": "2022-05-05T08:27:50",
        "upload_time_iso_8601": "2022-05-05T08:27:50.756379Z",
        "url": "https://files.pythonhosted.org/packages/1d/83/c1d79a0a7127d59c6a37137d6d20b7da7c9703a6ae58cae6ab2f81fb87e2/mnn-meter-2.0.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.0.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "2b27562e2567cc059df96de8b644cc51dd0e20246eba5097176754547d7bc0ef",
          "md5": "2785f67800d4d8f28179eef33bf84f88",
          "sha256": "d43d8ac4b02eeb8e498bbcf89e698f4014aa6dda12b12138e7a438864f5240cf"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.0.3.tar.gz",
        "has_sig": false,
        "md5_digest": "2785f67800d4d8f28179eef33bf84f88",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 413696,
        "upload_time": "2022-05-05T08:39:25",
        "upload_time_iso_8601": "2022-05-05T08:39:25.774510Z",
        "url": "https://files.pythonhosted.org/packages/2b/27/562e2567cc059df96de8b644cc51dd0e20246eba5097176754547d7bc0ef/mnn-meter-2.0.3.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.0.4": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "9956438d5cb0260836857ffb0fd4a0d44262de418cbfaca099219d5a3f1e6df1",
          "md5": "3507b6bde7d30fb2955ab9ab5f2f9258",
          "sha256": "0d0820cd42de56977d82769e7289dca68cef14e84e21554771685afdb7ccb59f"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.0.4.tar.gz",
        "has_sig": false,
        "md5_digest": "3507b6bde7d30fb2955ab9ab5f2f9258",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 8490,
        "upload_time": "2022-05-05T08:46:48",
        "upload_time_iso_8601": "2022-05-05T08:46:48.439674Z",
        "url": "https://files.pythonhosted.org/packages/99/56/438d5cb0260836857ffb0fd4a0d44262de418cbfaca099219d5a3f1e6df1/mnn-meter-2.0.4.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.1.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "eada22f1b383597bdf60722b4d268de8facb9939d972ff1fd906f51e4093f47e",
          "md5": "83d852ca64b57d5cfc417904a74111f3",
          "sha256": "fce588a64f3324bc16c6717273daf2fc9b3a39b47049d500a53af02c4aed4161"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.1.1.tar.gz",
        "has_sig": false,
        "md5_digest": "83d852ca64b57d5cfc417904a74111f3",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 9430,
        "upload_time": "2022-05-06T01:08:04",
        "upload_time_iso_8601": "2022-05-06T01:08:04.482094Z",
        "url": "https://files.pythonhosted.org/packages/ea/da/22f1b383597bdf60722b4d268de8facb9939d972ff1fd906f51e4093f47e/mnn-meter-2.1.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.1.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "720f0d8ff529e82af23d2c39516a5e6cad47c6a80cb9d9beb9cd409c72accd51",
          "md5": "b05061f232d14df0cafdafde7e4a26af",
          "sha256": "19976ad43893f299df8c05e1329137e8d0804dc954312f5948b262531d345fff"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.1.2.tar.gz",
        "has_sig": false,
        "md5_digest": "b05061f232d14df0cafdafde7e4a26af",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 9444,
        "upload_time": "2022-05-06T02:02:46",
        "upload_time_iso_8601": "2022-05-06T02:02:46.338582Z",
        "url": "https://files.pythonhosted.org/packages/72/0f/0d8ff529e82af23d2c39516a5e6cad47c6a80cb9d9beb9cd409c72accd51/mnn-meter-2.1.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.1.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "b5f119678bf5e5b503a0693f8632f93f3be15f82b33a9dc82205c14db4a3cd03",
          "md5": "637fb057c9bfa9bd489ca686a312e1d1",
          "sha256": "485db96cb4dfacb86e896c13dba4f55f48d5c47527d3183fd86ad14dc5990516"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.1.3.tar.gz",
        "has_sig": false,
        "md5_digest": "637fb057c9bfa9bd489ca686a312e1d1",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 9441,
        "upload_time": "2022-05-06T02:54:22",
        "upload_time_iso_8601": "2022-05-06T02:54:22.548343Z",
        "url": "https://files.pythonhosted.org/packages/b5/f1/19678bf5e5b503a0693f8632f93f3be15f82b33a9dc82205c14db4a3cd03/mnn-meter-2.1.3.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "2.2.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "fd484a27716cd5410a422a8633b766569d81decf9e09ada3990bd1f36363cd16",
          "md5": "a44f56d03f28d567a99ad9f31e940a99",
          "sha256": "8c0410056404c46737d162529b8f8fef141ac1d32bd2dd520f97d6abc7510e17"
        },
        "downloads": -1,
        "filename": "mnn-meter-2.2.0.tar.gz",
        "has_sig": false,
        "md5_digest": "a44f56d03f28d567a99ad9f31e940a99",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.5",
        "size": 11716,
        "upload_time": "2022-05-07T15:19:51",
        "upload_time_iso_8601": "2022-05-07T15:19:51.240977Z",
        "url": "https://files.pythonhosted.org/packages/fd/48/4a27716cd5410a422a8633b766569d81decf9e09ada3990bd1f36363cd16/mnn-meter-2.2.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "fd484a27716cd5410a422a8633b766569d81decf9e09ada3990bd1f36363cd16",
        "md5": "a44f56d03f28d567a99ad9f31e940a99",
        "sha256": "8c0410056404c46737d162529b8f8fef141ac1d32bd2dd520f97d6abc7510e17"
      },
      "downloads": -1,
      "filename": "mnn-meter-2.2.0.tar.gz",
      "has_sig": false,
      "md5_digest": "a44f56d03f28d567a99ad9f31e940a99",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.5",
      "size": 11716,
      "upload_time": "2022-05-07T15:19:51",
      "upload_time_iso_8601": "2022-05-07T15:19:51.240977Z",
      "url": "https://files.pythonhosted.org/packages/fd/48/4a27716cd5410a422a8633b766569d81decf9e09ada3990bd1f36363cd16/mnn-meter-2.2.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}