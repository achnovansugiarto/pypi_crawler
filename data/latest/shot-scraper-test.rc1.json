{
  "info": {
    "author": "Simon Willison",
    "author_email": "",
    "bugtrack_url": null,
    "classifiers": [],
    "description": "# shot-scraper\n\n[![PyPI](https://img.shields.io/pypi/v/shot-scraper.svg)](https://pypi.org/project/shot-scraper/)\n[![Changelog](https://img.shields.io/github/v/release/simonw/shot-scraper?include_prereleases&label=changelog)](https://github.com/simonw/shot-scraper/releases)\n[![Tests](https://github.com/simonw/shot-scraper/workflows/Test/badge.svg)](https://github.com/simonw/shot-scraper/actions?query=workflow%3ATest)\n[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](https://github.com/simonw/shot-scraper/blob/master/LICENSE)\n\nTools for taking automated screenshots of websites\n\nFor background on this project see [shot-scraper: automated screenshots for documentation, built on Playwright](https://simonwillison.net/2022/Mar/10/shot-scraper/).\n\n## Quickstart\n\nTo get started without installing any software, use the [shot-scraper-template](https://github.com/simonw/shot-scraper-template) template to create your own GitHub repository which takes screenshots of a page using `shot-scraper`. See [Instantly create a GitHub repository to take screenshots of a web page](https://simonwillison.net/2022/Mar/14/shot-scraper-template/) for details.\n\n## Demos\n\n- The [shot-scraper-demo](https://github.com/simonw/shot-scraper-demo) repository uses this tool to capture recently spotted owls in El Granada, CA according to [this page](https://www.owlsnearme.com/?place=127871), and to  generate an annotated screenshot illustrating a Datasette feature as described [in my blog](https://simonwillison.net/2022/Mar/10/shot-scraper/#a-complex-example).\n- Ben Welsh built [@newshomepages](https://twitter.com/newshomepages), a Twitter bot that uses `shot-scraper` and GitHub Actions to take screenshots of news website homepages and publish them to Twitter. The code for that lives in [palewire/news-homepages](https://github.com/palewire/news-homepages).\n- [scrape-hacker-news-by-domain](https://github.com/simonw/scrape-hacker-news-by-domain) uses `shot-scraper javascript` to scrape a web page. See [Scraping web pages from the command-line with shot-scraper](https://simonwillison.net/2022/Mar/14/scraping-web-pages-shot-scraper/) for details of how this works.\n\n## Installation\n\nInstall this tool using `pip`:\n\n    pip install shot-scraper\n\nThis tool depends on Playwright, which first needs to install its own dedicated browser.\n\nRun `shot-scraper install` once to install that:\n```\n% shot-scraper install\nDownloading Playwright build of chromium v965416 - 117.2 Mb [====================] 100% 0.0s \nPlaywright build of chromium v965416 downloaded to /Users/simon/Library/Caches/ms-playwright/chromium-965416\nDownloading Playwright build of ffmpeg v1007 - 1.1 Mb [====================] 100% 0.0s \nPlaywright build of ffmpeg v1007 downloaded to /Users/simon/Library/Caches/ms-playwright/ffmpeg-1007\n```\n## Taking a screenshot\n\nTo take a screenshot of a web page and write it to `datasette-io.png` run this:\n\n    shot-scraper https://datasette.io/\n\nIf a file called `datasette-io.png` already exists the filename `datasette-io.1.png` will be used instead.\n\nYou can use the `-o` option to specify a filename:\n\n    shot-scraper https://datasette.io/ -o datasette.png\n\nUse `-o -` to write the PNG image to standard output:\n\n    shot-scraper https://datasette.io/ -o - > datasette.png\n\nIf you omit the protocol `http://` will be added automatically, and any redirects will be followed:\n\n    shot-scraper datasette.io -o datasette.png\n\n### Adjusting the browser width and height\n\nThe browser window used to take the screenshots defaults to 1280px wide and 780px tall.\n\nYou can adjust these with the `--width` and `--height` options:\n\n    shot-scraper https://datasette.io/ -o small.png --width 400 --height 800\n\nIf you provide both options, the resulting screenshot will be of that size. If you omit `--height` a full page length screenshot will be produced (the default).\n\n### Screenshotting a specific area with CSS selectors\n\nTo take a screenshot of a specific element on the page, use `--selector` or `-s` with its CSS selector:\n\n    shot-scraper https://simonwillison.net/ -s '#bighead'\n\nWhen using `--selector` the height and width, if provided, will set the size of the browser window when the page is loaded but the resulting screenshot will still be the same dimensions as the element on the page.\n\nYou can pass `--selector` multiple times. The resulting screenshot will cover the smallest area of the page that contains all of the elements you specified, for example:\n\n    shot-scraper https://simonwillison.net/ \\\n      -s '#bighead' -s .overband \\\n      -o bighead-multi-selector.png\n\nYou can add `--padding 20` to add 20px of padding around the elements when the shot is taken.\n\n### Adding a delay\n\nSometimes a page will not have completely loaded before a screenshot is taken. You can use `--wait X` to wait the specified number of milliseconds after the page load event has fired before taking the screenshot:\n\n    shot-scraper https://simonwillison.net/ --wait 2000\n\n### Executing custom JavaScript\n\nYou can use custom JavaScript to modify the page after it has loaded (after the 'onload' event has fired) but before the screenshot is taken using the `--javascript` option:\n\n    shot-scraper https://simonwillison.net/ \\\n      -o simonwillison-pink.png \\\n      --javascript \"document.body.style.backgroundColor = 'pink';\"\n\n### Using JPEGs instead of PNGs\n\nScreenshots default to PNG. You can save as a JPEG by specifying a `-o` filename that ends with `.jpg`.\n\nYou can also use `--quality X` to save as a JPEG with the specified quality, in order to reduce the filesize. 80 is a good value to use here:\n\n    shot-scraper https://simonwillison.net/ \\\n      -h 800 -o simonwillison.jpg --quality 80\n    % ls -lah simonwillison.jpg\n    -rw-r--r--@ 1 simon  staff   168K Mar  9 13:53 simonwillison.jpg\n\n### Retina images\n\nThe `--retina` option sets a device scale factor of 2. This means that an image will have its resolution effectively doubled, emulating the display of images on [retina](https://en.wikipedia.org/wiki/Retina_display) or higher pixel density screens.\n\n    shot-scraper https://simonwillison.net/ -o simon.png \\\n      --width 400 --height 600 --retina\n\nThis example will produce an image that is 800px wide and 1200px high.\n\n### Interacting with the page\n\nSometimes it's useful to be able to manually interact with a page before the screenshot is captured.\n\nAdd the `--interactive` option to open a browser window that you can interact with. Then hit `<enter>` in the terminal when you are ready to take the shot and close the window.\n\n    shot-scraper https://simonwillison.net/ -o after-interaction.png \\\n      --height 800 --interactive\n\nThis will output:\n\n    Hit <enter> to take the shot and close the browser window:\n      # And after you hit <enter>...\n    Screenshot of 'https://simonwillison.net/' written to 'after-interaction.png'\n\n### Taking screenshots of local HTML files\n\nYou can pass the path to an HTML file on disk to take a screenshot of that rendered file:\n\n    shot-scraper index.html -o index.png\n\nCSS and images referenced from that file using relative paths will also be included.\n\n### shot-scraper shot --help\n\nFull `--help` for this command:\n\n<!-- [[[cog\nimport cog\nfrom shot_scraper import cli\nfrom click.testing import CliRunner\nrunner = CliRunner()\nresult = runner.invoke(cli.cli, [\"shot\", \"--help\"])\nhelp = result.output.replace(\"Usage: cli\", \"Usage: shot-scraper\")\ncog.out(\n    \"```\\n{}\\n```\\n\".format(help.strip())\n)\n]]] -->\n```\nUsage: shot-scraper shot [OPTIONS] URL\n\n  Take a single screenshot of a page or portion of a page.\n\n  Usage:\n\n      shot-scraper www.example.com\n\n  This will write the screenshot to www-example-com.png\n\n  Use \"-o\" to write to a specific file:\n\n      shot-scraper https://www.example.com/ -o example.png\n\n  You can also pass a path to a local file on disk:\n\n      shot-scraper index.html -o index.png\n\n  Using \"-o -\" will output to standard out:\n\n      shot-scraper https://www.example.com/ -o - > example.png\n\n  Use -s to take a screenshot of one area of the page, identified using one or\n  more CSS selectors:\n\n      shot-scraper https://simonwillison.net -s '#bighead'\n\nOptions:\n  -a, --auth FILENAME    Path to JSON authentication context file\n  -w, --width INTEGER    Width of browser window, defaults to 1280\n  -h, --height INTEGER   Height of browser window and shot - defaults to the\n                         full height of the page\n  -o, --output FILE\n  -s, --selector TEXT    Take shot of first element matching this CSS selector\n  -p, --padding INTEGER  When using selectors, add this much padding in pixels\n  -j, --javascript TEXT  Execute this JS prior to taking the shot\n  --retina               Use device scale factor of 2\n  --quality INTEGER      Save as JPEG with this quality, e.g. 80\n  --wait INTEGER         Wait this many milliseconds before taking the\n                         screenshot\n  -i, --interactive      Interact with the page in a browser before taking the\n                         shot\n  --devtools             Interact mode with developer tools\n  --help                 Show this message and exit.\n```\n<!-- [[[end]]] -->\n\n## Websites that need authentication\n\nIf you want to take screnshots of a site that has some form of authentication, you will first need to authenticate with that website manually.\n\nYou can do that using the `shot-scraper auth` command:\n\n    shot-scraper auth https://datasette-auth-passwords-demo.datasette.io/-/login auth.json\n\n(For this demo, use username = `root` and password = `password!`)\n\nThis will open a browser window on your computer showing the page you specified.\n\nYou can then sign in using that browser window - including 2FA or CAPTCHAs or other more complex form of authentication.\n\nWhen you are finished, hit `<enter>` at the `shot-scraper` command-line prompt. The browser will close and the authentication credentials (usually cookies) for that browser session will be written out to the `auth.json` file.\n\nTo take authenticated screenshots you can then use the `-a` or `--auth` options to point to the JSON file that you created:\n\n    shot-scraper https://datasette-auth-passwords-demo.datasette.io/ \\\n      -a auth.json -o authed.png\n\n## Taking multiple screenshots\n\nYou can configure multiple screenshots using a YAML file. Create a file called `shots.yml` that looks like this:\n\n```yaml\n  url: http://www.example.com/\n- output: w3c.org.png\n  url: https://www.w3.org/\n```\nThen run the tool like so:\n\n    shot-scraper multi shots.yml\n\nThis will create two image files, `www-example-com.png` and `w3c.org.png`, containing screenshots of those two URLs.\n\nYou can set `url:` to a path to a file on disk as well:\n\n```yaml\n- output: index.png\n  url: index.html\n```\n\nUse `--retina` to take all screenshots at retina resolution instead, doubling the dimensions of the files:\n\n    shot-scraper multi shots.yml --retina\n\nTo take a screenshot of just the area of a page defined by a CSS selector, add `selector` to the YAML block:\n\n```yaml\n- output: bighead.png\n  url: https://simonwillison.net/\n  selector: \"#bighead\"\n```\n\nYou can pass more than one selector using a `selectors:` list. You can also use `padding:` to specify additional padding:\n```yaml\n- output: bighead-multi-selector.png\n  url: https://simonwillison.net/\n  selectors:\n  - \"#bighead\"\n  - .overband\n  padding: 20\n```\nTo execute JavaScript after the page has loaded but before the screenshot is taken, add a `javascript` key:\n```yaml\n- output: bighead-pink.png\n  url: https://simonwillison.net/\n  selector: \"#bighead\"\n  javascript: |\n    document.body.style.backgroundColor = 'pink'\n```\n\nYou can include desired `height`, `width`, `quality` and `wait` options on each item as well:\n\n```yaml\n- output: simon-narrow.jpg\n  url: https://simonwillison.net/\n  width: 400\n  height: 800\n  quality: 80\n  wait: 500\n```\n\nFull `--help` for this command:\n\n<!-- [[[cog\nresult = runner.invoke(cli.cli, [\"multi\", \"--help\"])\nhelp = result.output.replace(\"Usage: cli\", \"Usage: shot-scraper\")\ncog.out(\n    \"```\\n{}\\n```\\n\".format(help.strip())\n)\n]]] -->\n```\nUsage: shot-scraper multi [OPTIONS] CONFIG\n\n  Take multiple screenshots, defined by a YAML file\n\n  Usage:\n\n      shot-scraper multi config.yml\n\n  Where config.yml contains configuration like this:\n\n      - output: example.png\n        url: http://www.example.com/\n\nOptions:\n  -a, --auth FILENAME  Path to JSON authentication context file\n  --retina             Use device scale factor of 2\n  -h, --help           Show this message and exit.\n```\n<!-- [[[end]]] -->\n\n## Saving a web page to PDF\n\nThe `shot-scraper pdf` command saves a PDF version of a web page - the equivalent of using `Print -> Save to PDF` in Chromium.\n\n    shot-scraper pdf https://datasette.io/\n\nThis will save to `datasette-io.pdf`. You can use `-o` to specify a filename:\n\n    shot-scraper pdf https://datasette.io/tutorials/learn-sql \\\n      -o learn-sql.pdf\n\nFull `--help` for this command:\n\n<!-- [[[cog\nresult = runner.invoke(cli.cli, [\"pdf\", \"--help\"])\nhelp = result.output.replace(\"Usage: cli\", \"Usage: shot-scraper\")\ncog.out(\n    \"```\\n{}\\n```\\n\".format(help.strip())\n)\n]]] -->\n```\nUsage: shot-scraper pdf [OPTIONS] URL\n\n  Create a PDF of the specified page\n\n  Usage:\n\n      shot-scraper pdf https://datasette.io/\n\n  Use -o to specify a filename:\n\n      shot-scarper pdf https://datasette.io/ -o datasette.pdf\n\nOptions:\n  -a, --auth FILENAME    Path to JSON authentication context file\n  -o, --output FILE\n  -j, --javascript TEXT  Execute this JS prior to creating the PDF\n  --wait INTEGER         Wait this many milliseconds before taking the\n                         screenshot\n  --media-screen         Use screen rather than print styles\n  --landscape            Use landscape orientation\n  -h, --help             Show this message and exit.\n```\n<!-- [[[end]]] -->\n\n## Scraping pages using JavaScript\n\nThe `shot-scraper javascript` command can be used to execute JavaScript directly against a page and return the result as JSON.\n\nThis command doesn't produce a screenshot, but has interesting applications for scraping.\n\nTo retrieve a string title of a document:\n\n    shot-scraper javascript https://datasette.io/ \"document.title\"\n\nThis returns a JSON string:\n```json\n\"Datasette: An open source multi-tool for exploring and publishing data\"\n```\nTo return a JSON object, wrap an object literal in parenthesis:\n\n    shot-scraper javascript https://datasette.io/ \"({\n      title: document.title,\n      tagline: document.querySelector('.tagline').innerText\n    })\"\n\nThis returns:\n```json\n{\n  \"title\": \"Datasette: An open source multi-tool for exploring and publishing data\",\n  \"tagline\": \"An open source multi-tool for exploring and publishing data\"\n}\n```\nTo use functions such as `setInterval()`, for example if you need to delay the shot for a second to allow an animation to finish running, return a promise:\n\n    shot-scraper javascript datasette.io \"\n    new Promise(done => setInterval(\n      () => {\n        done({\n          title: document.title,\n          tagline: document.querySelector('.tagline').innerText\n        });\n      }, 1000\n    ));\"\n\nYou can also save JavaScript to a file and execute it like this:\n\n    shot-scraper javascript datasette.io -i script.js\n\nOr read it from standard input like this:\n\n    echo \"document.title\" | shot-scraper javascript datasette.io\n\n### Handling JavaScript errors\n\nIf a JavaScript error occurs, a stack trace will be written to standard error and the tool will terminate with an exit code of 1.\n\nThis can be used to run JavaScript tests in continuous integration environments, by taking advantage of the `throw \"error message\"` JavaScript statement.\n\nThis example [uses GitHub Actions](https://docs.github.com/en/actions/quickstart):\n\n```yaml\n- name: Test page title\n  run: |-\n    shot-scraper javascript datasette.io \"\n      if (document.title != 'Datasette') {\n        throw 'Wrong title detected';\n      }\"\n```\n\nFull `--help` for this command:\n\n<!-- [[[cog\nresult = runner.invoke(cli.cli, [\"javascript\", \"--help\"])\nhelp = result.output.replace(\"Usage: cli\", \"Usage: shot-scraper\")\ncog.out(\n    \"```\\n{}\\n```\\n\".format(help.strip())\n)\n]]] -->\n```\nUsage: shot-scraper javascript [OPTIONS] URL [JAVASCRIPT]\n\n  Execute JavaScript against the page and return the result as JSON\n\n  Usage:\n\n      shot-scraper javascript https://datasette.io/ \"document.title\"\n\n  To return a JSON object, use this:\n\n      \"({title: document.title, location: document.location})\"\n\n  To use setInterval() or similar, pass a promise:\n\n      \"new Promise(done => setInterval(\n        () => {\n          done({\n            title: document.title,\n            h2: document.querySelector('h2').innerHTML\n          });\n        }, 1000\n      ));\"\n\n  If a JavaScript error occurs an exit code of 1 will be returned.\n\nOptions:\n  -i, --input FILENAME   Read input JavaScript from this file\n  -a, --auth FILENAME    Path to JSON authentication context file\n  -o, --output FILENAME  Save output JSON to this file\n  -h, --help             Show this message and exit.\n```\n<!-- [[[end]]] -->\n\n\n## Dumping out an accessibility tree\n\nThe `shot-scraper accessibility` command dumps out the Chromium accessibility tree for the provided URL, as JSON:\n\n    shot-scraper accessibility https://datasette.io/\n\nUse `-o filename.json` to write the output to a file instead of displaying it.\n\nAdd `--javascript SCRIPT` to execute custom JavaScript before taking the snapshot.\n\nFull `--help` for this command:\n\n<!-- [[[cog\nresult = runner.invoke(cli.cli, [\"accessibility\", \"--help\"])\nhelp = result.output.replace(\"Usage: cli\", \"Usage: shot-scraper\")\ncog.out(\n    \"```\\n{}\\n```\\n\".format(help.strip())\n)\n]]] -->\n```\nUsage: shot-scraper accessibility [OPTIONS] URL\n\n  Dump the Chromium accessibility tree for the specifed page\n\n  Usage:\n\n      shot-scraper accessibility https://datasette.io/\n\nOptions:\n  -a, --auth FILENAME    Path to JSON authentication context file\n  -o, --output FILENAME\n  -j, --javascript TEXT  Execute this JS prior to taking the snapshot\n  -h, --help             Show this message and exit.\n```\n<!-- [[[end]]] -->\n\n## Tips for executing JavaScript\n\nIf you are using the `--javascript` option to execute code, that code will be executed after the page load event has fired but before the screenshot is taken.\n\nYou can use that code to do things like hide or remove specific page elements, click on links to open menus, or even add annotations to the page such as this [pink arrow example](https://simonwillison.net/2022/Mar/10/shot-scraper/#a-complex-example).\n\nThis code hides any element with a `[data-ad-rendered]` attribute and the element with `id=\"ensNotifyBanner\"`:\n\n    document.querySelectorAll(\n        '[data-ad-rendered],#ensNotifyBanner'\n    ).forEach(el => el.style.display = 'none')\n\nYou can execute that like so:\n\n```\nshot-scraper https://www.latimes.com/ -o latimes.png --javascript \"\ndocument.querySelectorAll(\n    '[data-ad-rendered],#ensNotifyBanner'\n).forEach(el => el.style.display = 'none')\n\"\n```\n\nIn some cases you may need to add a pause that executes during your custom JavaScript before the screenshot is taken - for example if you click on a button that triggers a short fading animation.\n\nYou can do that using the following pattern:\n```javascript\nnew Promise(takeShot => {\n  // Your code goes here\n  // ...\n  setTimeout(() => {\n    // Resolving the promise takes the shot\n    takeShot();\n  }, 1000);\n});\n```\nIf your custom code defines a `Promise`, `shot-scraper` will wait for that promise to complete before taking the screenshot. Here the screenshot does not occur until the `takeShot()` function is called.\n\n## Development\n\nTo contribute to this tool, first checkout the code. Then create a new virtual environment:\n\n    cd shot-scraper\n    python -m venv venv\n    source venv/bin/activate\n\nOr if you are using `pipenv`:\n\n    pipenv shell\n\nNow install the dependencies and test dependencies:\n\n    pip install -e '.[test]'\n\nTo run the tests:\n\n    pytest\n\nSome of the tests exercise the CLI utility directly. Run those like so:\n\n    tests/run_examples.sh",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/simonw/shot-scraper",
    "keywords": "",
    "license": "Apache License, Version 2.0",
    "maintainer": "",
    "maintainer_email": "",
    "name": "shot-scraper-test",
    "package_url": "https://pypi.org/project/shot-scraper-test/",
    "platform": null,
    "project_url": "https://pypi.org/project/shot-scraper-test/",
    "project_urls": {
      "CI": "https://github.com/simonw/shot-scraper/actions",
      "Changelog": "https://github.com/simonw/shot-scraper/releases",
      "Homepage": "https://github.com/simonw/shot-scraper",
      "Issues": "https://github.com/simonw/shot-scraper/issues"
    },
    "release_url": "https://pypi.org/project/shot-scraper-test/0.9/",
    "requires_dist": null,
    "requires_python": ">=3.7",
    "summary": "Tools for taking automated screenshots of websites",
    "version": "0.9",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 13212926,
  "releases": {
    "0.9": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "b42e82f9bde6a40c13c0f02383e492430cf720a51baa16dd0d97900806008538",
          "md5": "bcfb22f9d51af6b3c34669e7eb1bb7b6",
          "sha256": "9b833c1e8aa31479d805d6fc9e5c433b414c709da52f0450860e5a23fa32b4af"
        },
        "downloads": -1,
        "filename": "shot-scraper-test-0.9.tar.gz",
        "has_sig": false,
        "md5_digest": "bcfb22f9d51af6b3c34669e7eb1bb7b6",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.7",
        "size": 18549,
        "upload_time": "2022-03-18T04:44:36",
        "upload_time_iso_8601": "2022-03-18T04:44:36.062628Z",
        "url": "https://files.pythonhosted.org/packages/b4/2e/82f9bde6a40c13c0f02383e492430cf720a51baa16dd0d97900806008538/shot-scraper-test-0.9.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "b42e82f9bde6a40c13c0f02383e492430cf720a51baa16dd0d97900806008538",
        "md5": "bcfb22f9d51af6b3c34669e7eb1bb7b6",
        "sha256": "9b833c1e8aa31479d805d6fc9e5c433b414c709da52f0450860e5a23fa32b4af"
      },
      "downloads": -1,
      "filename": "shot-scraper-test-0.9.tar.gz",
      "has_sig": false,
      "md5_digest": "bcfb22f9d51af6b3c34669e7eb1bb7b6",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.7",
      "size": 18549,
      "upload_time": "2022-03-18T04:44:36",
      "upload_time_iso_8601": "2022-03-18T04:44:36.062628Z",
      "url": "https://files.pythonhosted.org/packages/b4/2e/82f9bde6a40c13c0f02383e492430cf720a51baa16dd0d97900806008538/shot-scraper-test-0.9.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}