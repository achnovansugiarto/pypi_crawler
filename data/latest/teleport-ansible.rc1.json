{
  "info": {
    "author": "Kevin Carter",
    "author_email": "kevin@cloudnull.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Intended Audience :: Developers",
      "Intended Audience :: Information Technology",
      "Intended Audience :: System Administrators",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3.8",
      "Topic :: Software Development :: Libraries :: Python Modules",
      "Topic :: Utilities"
    ],
    "description": "# Teleport Inventory Documentation\n\nThis is a very simple package which will use Teleport as a dynamic inventory\nsource for Ansible. The script assumes you've logged in and have access to the\nteleport service. Examples of all the base requirements are provided within this\nreadme.\n\n> Checkout https://cloudnull.io/2022/09/ansible-inventory-via-teleport for a more\n  indepth review of integrating Teleport with Ansible.\n\n\n## Using the teleport-ansible inventory script\n\nThe script will read machines and return JSON information from teleport. Once the\nreturn information is sourced, it will format the inventory using the node name\nas the target host and the labels as hostvars and groups.\n\nUsing teleport-ansible requires a little setup, mostly client side for Teleport itself.\n\n\n## Installing teleport-ansible and using it\n\nInstalling the `teleport-ansible` inventory script can be accomplished with `pip`.\n\n``` shell\npip install teleport-ansible\n```\n\nThe teleport-inventory script can also be installed using the git repository directly.\n\n``` shell\npip install git+https://github.com/cloudnull/teleport-ansible\n```\n\nIf you don't want to install the script, you can also simply download the script using\nthe hard link and run it from wherever you want.\n\n``` shell\ncurl https://raw.githubusercontent.com/cloudnull/teleport-ansible/master/teleport-inventory.py -o teleport-inventory.py\n```\n\n\n### Example SSH configuration connect through Teleport\n\nCreate a compatible SSH configuration for Teleport.\n\n``` shell\nexport TELEPORT_DOMAIN=teleport.example.com\nexport TELEPORT_USER=cloudnull\ncat > ~/.ssh/teleport.cfg <<EOF\nHost * !${TELEPORT_DOMAIN}\n    UserKnownHostsFile \"${HOME}/.tsh/known_hosts\"\n    IdentityFile \"${HOME}/.tsh/keys/${TELEPORT_DOMAIN}/${TELEPORT_USER}\"\n    CertificateFile \"${HOME}/.tsh/keys/${TELEPORT_DOMAIN}/${TELEPORT_USER}-ssh/${TELEPORT_DOMAIN}-cert.pub\"\n    PubkeyAcceptedKeyTypes +ssh-rsa-cert-v01@openssh.com\n    Port 3022\n    CheckHostIP no\n    ProxyCommand \"$(which tsh)\" proxy ssh --cluster=${TELEPORT_DOMAIN} --proxy=${TELEPORT_DOMAIN} %r@%h:%p\nEOF\n```\n\n> The above ssh configuration needs to have all variables replaced to work.\n\n\n### Example Ansible Setup\n\nWhen running this inventory, Ansible requires some basic instructions which can\nbe set via environment variables or through an Ansible config file.\n\n``` shell\nexport ANSIBLE_SCP_IF_SSH=False\nexport ANSIBLE_SSH_ARGS=\"-F ${HOME}/.ssh/teleport.cfg\"\nexport ANSIBLE_INVENTORY_ENABLED=script\nexport ANSIBLE_HOST_KEY_CHECKING=False\nexport ANSIBLE_INVENTORY=\"$(command -v teleport-ansible)\"\n```\n\n> The ${HOME}/.ssh/teleport.cfg file is generated by using the\n  `tsh config` command then customized based on individual needs.\n\n\n### Example login process\n\n``` shell\ntsh login --proxy=teleport.example.com --user=teleport-admin\n\nIf browser window does not open automatically, open it by clicking on the link:\n http://127.0.0.1:42337/83facfc0-e899-44dc-aa6c-32179e3d5b0b\n> Profile URL:        https://teleport.example.com:443\n  Logged in as:       teleport-admin\n  Cluster:            teleport.example.com\n  Roles:              access\n  Logins:             root, ubuntu, debian, fedora, centos, -teleport-internal-join\n  Kubernetes:         enabled\n  Valid until:        2022-09-16 08:03:05 -0500 CDT [valid for 12h0m0s]\n  Extensions:         permit-agent-forwarding, permit-port-forwarding, permit-pty\n```\n\n> The above tsh login will provide access to the teleport cluster, which\n  will allow you to run inventory script which will return an Ansible\n  inventory JSON.\n\n\n### Example inventory return\n\nRunning the teleport inventory command `teleport-inventory` will return something\nlike this.\n\n``` python\n>>> {\n...     \"_meta\": {\n...         \"hostvars\": {\n...             \"alluvial-0\": {\n...                 \"ansible_user\": \"ubuntu\",\n...                 \"teleport_id\": 1663292578982084621,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"jammy\",\n...                 \"environment\": \"dev\"\n...             },\n...             \"compute-0\": {\n...                 \"ansible_user\": \"carter\",\n...                 \"teleport_id\": 1663292546493240726,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"jammy\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"curator-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292584620339609,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"plexmediaserver-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292540612813467,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"rtmprelay-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292583673456110,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"teleport-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292588270337453,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"thelounge-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292533524229273,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"unbound-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292535344206453,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"unifi-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292528952201832,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             },\n...             \"wireguard-0\": {\n...                 \"ansible_user\": \"debian\",\n...                 \"teleport_id\": 1663292535570354336,\n...                 \"arch\": \"x86_64\",\n...                 \"codename\": \"bullseye\",\n...                 \"environment\": \"prod\"\n...             }\n...         }\n...     },\n...     \"all\": {\n...         \"hosts\": [\n...             \"alluvial-0\",\n...             \"compute-0\",\n...             \"curator-0\",\n...             \"plexmediaserver-0\",\n...             \"rtmprelay-0\",\n...             \"teleport-0\",\n...             \"thelounge-0\",\n...             \"unbound-0\",\n...             \"unifi-0\",\n...             \"wireguard-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"x86_64\": {\n...         \"hosts\": [\n...             \"alluvial-0\",\n...             \"compute-0\",\n...             \"curator-0\",\n...             \"plexmediaserver-0\",\n...             \"rtmprelay-0\",\n...             \"teleport-0\",\n...             \"thelounge-0\",\n...             \"unbound-0\",\n...             \"unifi-0\",\n...             \"wireguard-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"jammy\": {\n...         \"hosts\": [\n...             \"alluvial-0\",\n...             \"compute-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"dev\": {\n...         \"hosts\": [\n...             \"alluvial-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"teleport_cloudnull_dev\": {\n...         \"hosts\": [\n...             \"wireguard-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"prod\": {\n...         \"hosts\": [\n...             \"compute-0\",\n...             \"curator-0\",\n...             \"plexmediaserver-0\",\n...             \"rtmprelay-0\",\n...             \"teleport-0\",\n...             \"thelounge-0\",\n...             \"unbound-0\",\n...             \"unifi-0\",\n...             \"wireguard-0\"\n...         ],\n...         \"children\": []\n...     },\n...     \"bullseye\": {\n...         \"hosts\": [\n...             \"curator-0\",\n...             \"plexmediaserver-0\",\n...             \"rtmprelay-0\",\n...             \"teleport-0\",\n...             \"thelounge-0\",\n...             \"unbound-0\",\n...             \"unifi-0\",\n...             \"wireguard-0\"\n...         ],\n...         \"children\": []\n...     }\n... }\n```\n\n> Once the ssh config is in place, the Ansible configuration is set, and\n  teleport is logged in, Ansible can be run natively.\n\n\n### Example Ansible Ad-Hoc command\n\nYou'll notice that the command is SUPER basic. There's nothing special here.\n\n``` shell\nansible -m ping all\n```\n\n### Example Ansible Playbook command\n\nJust like the ad-hoc command, there's nothing special when running playbooks either.\n\n``` shell\nansible-playbook example-playbook.yaml\n```\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/cloudnull/teleport-ansible",
    "keywords": "",
    "license": "",
    "maintainer": "",
    "maintainer_email": "",
    "name": "teleport-ansible",
    "package_url": "https://pypi.org/project/teleport-ansible/",
    "platform": null,
    "project_url": "https://pypi.org/project/teleport-ansible/",
    "project_urls": {
      "Bug Tracker": "https://github.com/cloudnull/teleport-ansible/issues",
      "Homepage": "https://github.com/cloudnull/teleport-ansible"
    },
    "release_url": "https://pypi.org/project/teleport-ansible/0.0.1/",
    "requires_dist": null,
    "requires_python": ">=3.6",
    "summary": "Teleport driven ansible inventory script.",
    "version": "0.0.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 15263352,
  "releases": {
    "0.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "c53cc0ad2524e2a6e20998fd67f0d43ff6cd69300089e6212816d6bcf8bcb65d",
          "md5": "1bdf145f28ae6e46046c72628430a4fa",
          "sha256": "44ab731bef2bb0d10e9b2ca5d274a888ca2b793da850ac17b2053723c180eb71"
        },
        "downloads": -1,
        "filename": "teleport_ansible-0.0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "1bdf145f28ae6e46046c72628430a4fa",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6",
        "size": 9755,
        "upload_time": "2022-09-30T02:59:44",
        "upload_time_iso_8601": "2022-09-30T02:59:44.326930Z",
        "url": "https://files.pythonhosted.org/packages/c5/3c/c0ad2524e2a6e20998fd67f0d43ff6cd69300089e6212816d6bcf8bcb65d/teleport_ansible-0.0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3be51cf9648ab7536388cbba91db7e000047366521b69c50006c5a0496b56c78",
          "md5": "33f4991957592f345c473661046c38c2",
          "sha256": "d2a4fcc8b1b08016b70bef2d84c8bb256a823730c937f2851cde18740cc1854e"
        },
        "downloads": -1,
        "filename": "teleport-ansible-0.0.1.tar.gz",
        "has_sig": false,
        "md5_digest": "33f4991957592f345c473661046c38c2",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6",
        "size": 8961,
        "upload_time": "2022-09-30T02:59:46",
        "upload_time_iso_8601": "2022-09-30T02:59:46.680981Z",
        "url": "https://files.pythonhosted.org/packages/3b/e5/1cf9648ab7536388cbba91db7e000047366521b69c50006c5a0496b56c78/teleport-ansible-0.0.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "c53cc0ad2524e2a6e20998fd67f0d43ff6cd69300089e6212816d6bcf8bcb65d",
        "md5": "1bdf145f28ae6e46046c72628430a4fa",
        "sha256": "44ab731bef2bb0d10e9b2ca5d274a888ca2b793da850ac17b2053723c180eb71"
      },
      "downloads": -1,
      "filename": "teleport_ansible-0.0.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "1bdf145f28ae6e46046c72628430a4fa",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.6",
      "size": 9755,
      "upload_time": "2022-09-30T02:59:44",
      "upload_time_iso_8601": "2022-09-30T02:59:44.326930Z",
      "url": "https://files.pythonhosted.org/packages/c5/3c/c0ad2524e2a6e20998fd67f0d43ff6cd69300089e6212816d6bcf8bcb65d/teleport_ansible-0.0.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "3be51cf9648ab7536388cbba91db7e000047366521b69c50006c5a0496b56c78",
        "md5": "33f4991957592f345c473661046c38c2",
        "sha256": "d2a4fcc8b1b08016b70bef2d84c8bb256a823730c937f2851cde18740cc1854e"
      },
      "downloads": -1,
      "filename": "teleport-ansible-0.0.1.tar.gz",
      "has_sig": false,
      "md5_digest": "33f4991957592f345c473661046c38c2",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.6",
      "size": 8961,
      "upload_time": "2022-09-30T02:59:46",
      "upload_time_iso_8601": "2022-09-30T02:59:46.680981Z",
      "url": "https://files.pythonhosted.org/packages/3b/e5/1cf9648ab7536388cbba91db7e000047366521b69c50006c5a0496b56c78/teleport-ansible-0.0.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}