{
  "info": {
    "author": "Tasuku SUENAGA a.k.a. gunyarakun",
    "author_email": "tasuku-s-github@titech.ac",
    "bugtrack_url": null,
    "classifiers": [],
    "description": "# Cached http fetcher\n\n[![Test](https://github.com/gunyarakun/cached-http-fetcher/actions/workflows/test.yaml/badge.svg)](https://github.com/gunyarakun/cached-http-fetcher/actions/workflows/test.yaml)\n[![PyPI version](https://badge.fury.io/py/cached-http-fetcher.svg)](https://badge.fury.io/py/cached-http-fetcher)\n\nThis library fetches data via HTTP(S), stores into some storages which is accessible from the internet.\n\n## Install\n\n```shell\npip install cached-http-fetcher\n```\n\n## Usage\n\nThe standard way to use this library is store metadata in Redis and store images itself in S3. The images in S3 can be accessed by the internet.\n\nYou have to implement your own meta storage extends `MetaStorageBase` with Redis and content storage extends `ContentStorageBase` with S3.\n\nThe whole sample code is following, or see and execute [fetch\\_with\\_memory.py](examples/fetch_with_memory.py).\n\n```python\nimport boto3\nfrom redis import Redis\nimport cached_http_fetcher\nfrom urllib.parse import urlsplit, quote\nfrom typing import Optional, Iterable\nfrom botocore.exceptions import ClientError\n\nimport logging\n\n\nclass RedisMetaStorage(cached_http_fetcher.MetaStorageBase):\n    def __init__(self, settings):\n        self.redis = Redis.from_url(\"redis://redis:6379/0\")\n\n    def get(self, source_url: str) -> Optional[bytes]:\n        return self.redis.get(source_url)\n\n    def delete(self, source_url: str) -> None:\n        self.redis.delete(source_url)\n\n    def put(self, source_url: str, value: bytes) -> None:\n        self.redis.set(source_url, value)\n\n\nclass S3ContentStorage(cached_http_fetcher.ContentStorageBase):\n    def __init__(self, settings):\n        self.s3 = boto3.client(\"s3\")\n        self.bucket = \"some-bucket\"\n\n    @staticmethod\n    def s3_key(source_url: str):\n        r = urlsplit(source_url)\n        s3_key = \"path-prefix/\"\n        url = ''\n        if r.scheme == \"http\":\n            pass\n        elif r.scheme == \"https\":\n            s3_key += 's/'\n        else:\n            raise ValueError\n        s3_key += r.netloc + r.path\n        if r.query:\n            s3_key += \"?\" + r.query\n        return quote(s3_key)\n\n    def get(self, source_url: str) -> bytes:\n        try:\n            obj = self.s3.get_object(Bucket=self.buclet, Key=S3ContentStorage.s3_key(source_url))\n            return obj[\"Body\"]\n        except ClientError as ex:\n            if ex.response[\"Error\"][\"Code\"] == \"NoSuchKey\":\n                return None\n            else:\n                raise\n\n    def delete(self, source_url: str) -> None:\n        self.client.delete_object(Bucket=self.bucket, Key=S3ContentStorage.s3_key(source_url))\n\n    def put_content(self, source_url: str, value: bytes, cache_control: str, content_type: Optional[str] = None) -> None:\n        config = dict(ACL=\"bucket-owner-full-control\", Bucket=self.bucket, Key=key, CacheControl=cache_control, Body=value)\n        if content_type:\n            config[\"ContentType\"] = content_type\n        self.s3.put_object(**config)\n\n    def cached_url(self, source_url: str) -> str:\n        return f\"https://{self.bucket}.s3.us-west-2.amazonaws.com/{S3ContentStorage.s3_key(source_url)}\"\n\n\nurl_list = [\"http://www.example.com/image1.jpg\", \"http://www.example.com/image2.jpg\"]\nmeta_storage = RedisMetaStorage(settings)\ncontent_storage = S3ContentStorage(settings)\nlogger = logging.getLogger(__name__)\n\ncached_http_fetcher.fetch_urls(url_list, meta_storage, content_storage, logger=logger)\n\nfor url in url_list:\n    meta = cached_http_fetcher.get_meta(url, meta_storage, logger=logger)\n    print(meta.cached_url)\n```\n\n## Develop\n\n```shell\nmake test # test\nmake dist # release to PyPI\n```\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/gunyarakun/cached-http-fetcher",
    "keywords": "",
    "license": "MIT License",
    "maintainer": "",
    "maintainer_email": "",
    "name": "cached-http-fetcher",
    "package_url": "https://pypi.org/project/cached-http-fetcher/",
    "platform": "",
    "project_url": "https://pypi.org/project/cached-http-fetcher/",
    "project_urls": {
      "Homepage": "https://github.com/gunyarakun/cached-http-fetcher"
    },
    "release_url": "https://pypi.org/project/cached-http-fetcher/0.1.6/",
    "requires_dist": [
      "requests",
      "pytest (~=6.2.2) ; extra == 'test'",
      "pytest-cov (~=2.11.1) ; extra == 'test'",
      "pytest-mock (~=3.5.1) ; extra == 'test'",
      "responses (~=0.13.1) ; extra == 'test'",
      "pysen (~=0.9.1) ; extra == 'test'"
    ],
    "requires_python": ">=3.7",
    "summary": "A cached http fetcher",
    "version": "0.1.6",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 10854008,
  "releases": {
    "0.0.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "b93a9aceb3dfcfa20c4895db665dc035049d8200a9a5ca314c464d218a0332db",
          "md5": "da729b177ec419cf3730dabca3268635",
          "sha256": "71933c20e172c4e551585b95d7e2db73e3e079a1030dd85bd3a8534dbeb7443d"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.0.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "da729b177ec419cf3730dabca3268635",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 9853,
        "upload_time": "2021-04-02T15:17:01",
        "upload_time_iso_8601": "2021-04-02T15:17:01.273053Z",
        "url": "https://files.pythonhosted.org/packages/b9/3a/9aceb3dfcfa20c4895db665dc035049d8200a9a5ca314c464d218a0332db/cached_http_fetcher-0.0.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.0.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "9d31222a041bfb67d31ae0706182d9735dada26aa4b74ec5b356c80097fee3bb",
          "md5": "767759b388614e708da2d32ff78e6e7a",
          "sha256": "4d5369d820168eeb89ece08d349f89de629fa34b28b8b5702496c2c1a3865c5b"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.0.2-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "767759b388614e708da2d32ff78e6e7a",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 10889,
        "upload_time": "2021-04-03T05:02:20",
        "upload_time_iso_8601": "2021-04-03T05:02:20.920185Z",
        "url": "https://files.pythonhosted.org/packages/9d/31/222a041bfb67d31ae0706182d9735dada26aa4b74ec5b356c80097fee3bb/cached_http_fetcher-0.0.2-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.0.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "54f2ad4bd467538ed8dcded485d77b30bad8e3090f453b13d5021c51077f4a4a",
          "md5": "0aeff2221689406f30716cf798ee4428",
          "sha256": "c904520fdd552d4b3a0dd5f3cb21e3ad6f056b3d91a637e75cbcd461209f1ea5"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.0.3-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "0aeff2221689406f30716cf798ee4428",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 10985,
        "upload_time": "2021-04-05T05:55:01",
        "upload_time_iso_8601": "2021-04-05T05:55:01.582635Z",
        "url": "https://files.pythonhosted.org/packages/54/f2/ad4bd467538ed8dcded485d77b30bad8e3090f453b13d5021c51077f4a4a/cached_http_fetcher-0.0.3-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.0.4": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3e2211726ef50036fe6488a95f5c08dd4e2ecb4c9a89339de931cb0ee3f163ec",
          "md5": "f41456f1d4132f11807bff39a679a5a5",
          "sha256": "84915f536b5c137095bfb8a2d1827bb950b44f3d8cddf0bee13567559de9f083"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.0.4-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "f41456f1d4132f11807bff39a679a5a5",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11050,
        "upload_time": "2021-04-05T07:23:21",
        "upload_time_iso_8601": "2021-04-05T07:23:21.187797Z",
        "url": "https://files.pythonhosted.org/packages/3e/22/11726ef50036fe6488a95f5c08dd4e2ecb4c9a89339de931cb0ee3f163ec/cached_http_fetcher-0.0.4-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "7c39194a065dd6a4e7d036126cf0f183e550190da8db9088efa8cec9ab0c886e",
          "md5": "42983d3092dfc8cdb6107be6bf7c9560",
          "sha256": "7a0bfdea1f87beaeb5040851e12e148791025836cdd0cfaed051407658e1423f"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "42983d3092dfc8cdb6107be6bf7c9560",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11310,
        "upload_time": "2021-04-07T05:09:03",
        "upload_time_iso_8601": "2021-04-07T05:09:03.298364Z",
        "url": "https://files.pythonhosted.org/packages/7c/39/194a065dd6a4e7d036126cf0f183e550190da8db9088efa8cec9ab0c886e/cached_http_fetcher-0.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4f1a6b956afbd49226dbb8fbfe3900bfa9730be9634e278a24e9dfbdfd488b9d",
          "md5": "72924cece7f36f32d52a6700d3d510ea",
          "sha256": "40fecf8ac8590a7727048d89fc9a2321407a4d925a12f6695146f176461374c6"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "72924cece7f36f32d52a6700d3d510ea",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11309,
        "upload_time": "2021-04-13T05:06:06",
        "upload_time_iso_8601": "2021-04-13T05:06:06.141549Z",
        "url": "https://files.pythonhosted.org/packages/4f/1a/6b956afbd49226dbb8fbfe3900bfa9730be9634e278a24e9dfbdfd488b9d/cached_http_fetcher-0.1.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "546d5bc8d026f5e301f3adb1003c4f00b9fc38500fdf8eb7ab839df1431788e0",
          "md5": "baf13eefcec79f4b226c09cb2eedfcdd",
          "sha256": "d47e1d655c095fee40f7d04b83ad3ded8d2b8c38f6bc091d50f5d8a25b20b496"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.2-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "baf13eefcec79f4b226c09cb2eedfcdd",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11512,
        "upload_time": "2021-04-17T08:18:06",
        "upload_time_iso_8601": "2021-04-17T08:18:06.236062Z",
        "url": "https://files.pythonhosted.org/packages/54/6d/5bc8d026f5e301f3adb1003c4f00b9fc38500fdf8eb7ab839df1431788e0/cached_http_fetcher-0.1.2-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4ac6407184e1c473957eed41f724a2196ababdbf33811211103838b9cc6db6ee",
          "md5": "05084b2576ec25898facd0b1063d2cfd",
          "sha256": "96e6d6b59a1fdeb4d6ae705204c9600de5d8ecd5f6f3e143f2a4212d1048a7a0"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.3-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "05084b2576ec25898facd0b1063d2cfd",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11462,
        "upload_time": "2021-04-22T14:45:51",
        "upload_time_iso_8601": "2021-04-22T14:45:51.832998Z",
        "url": "https://files.pythonhosted.org/packages/4a/c6/407184e1c473957eed41f724a2196ababdbf33811211103838b9cc6db6ee/cached_http_fetcher-0.1.3-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.4": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "fe098e03855024fd12b3c47f081d483053fac6673df34aa95782c83fa0320c13",
          "md5": "ba13f710ff51cb82965541b953c2abac",
          "sha256": "0370624192917b00e51346267fca264b2413adcb4b2e4210cf2fc89aea66acf1"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.4-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "ba13f710ff51cb82965541b953c2abac",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11475,
        "upload_time": "2021-04-22T15:00:55",
        "upload_time_iso_8601": "2021-04-22T15:00:55.917755Z",
        "url": "https://files.pythonhosted.org/packages/fe/09/8e03855024fd12b3c47f081d483053fac6673df34aa95782c83fa0320c13/cached_http_fetcher-0.1.4-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.5": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4fc8f1afc6f9e0901d34143334bfb43676bcca6e93e7b5e5b15d5f016dc1952a",
          "md5": "4447d2a62fc3ece01e3e71f579af142f",
          "sha256": "36ccd935922ebbadc7b6a6b484654d424271464d37185fa3fda795de09953c6c"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.5-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "4447d2a62fc3ece01e3e71f579af142f",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11720,
        "upload_time": "2021-07-06T02:48:26",
        "upload_time_iso_8601": "2021-07-06T02:48:26.652484Z",
        "url": "https://files.pythonhosted.org/packages/4f/c8/f1afc6f9e0901d34143334bfb43676bcca6e93e7b5e5b15d5f016dc1952a/cached_http_fetcher-0.1.5-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.6": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "48af8d3a02ed9bf5daa1628ed94b8ed659b383e10f6b13a1e389d03e1922270b",
          "md5": "4116d3ba094d3228ac00e4f761f1b47a",
          "sha256": "857f324420351fbd00201549ad0b5a8f3d3eb5174c13c4f54310529d519614e4"
        },
        "downloads": -1,
        "filename": "cached_http_fetcher-0.1.6-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "4116d3ba094d3228ac00e4f761f1b47a",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 11771,
        "upload_time": "2021-07-08T09:51:28",
        "upload_time_iso_8601": "2021-07-08T09:51:28.770933Z",
        "url": "https://files.pythonhosted.org/packages/48/af/8d3a02ed9bf5daa1628ed94b8ed659b383e10f6b13a1e389d03e1922270b/cached_http_fetcher-0.1.6-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "48af8d3a02ed9bf5daa1628ed94b8ed659b383e10f6b13a1e389d03e1922270b",
        "md5": "4116d3ba094d3228ac00e4f761f1b47a",
        "sha256": "857f324420351fbd00201549ad0b5a8f3d3eb5174c13c4f54310529d519614e4"
      },
      "downloads": -1,
      "filename": "cached_http_fetcher-0.1.6-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "4116d3ba094d3228ac00e4f761f1b47a",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.7",
      "size": 11771,
      "upload_time": "2021-07-08T09:51:28",
      "upload_time_iso_8601": "2021-07-08T09:51:28.770933Z",
      "url": "https://files.pythonhosted.org/packages/48/af/8d3a02ed9bf5daa1628ed94b8ed659b383e10f6b13a1e389d03e1922270b/cached_http_fetcher-0.1.6-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}