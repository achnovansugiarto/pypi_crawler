{
  "info": {
    "author": "xusenlin",
    "author_email": "1659821119@qq.com",
    "bugtrack_url": null,
    "classifiers": [],
    "description": "<div align=\"center\">\n\n**åŸºäº [`pytorch-lightning`](https://github.com/Lightning-AI/lightning) å’Œ [`transformers`](https://github.com/huggingface/transformers) æ¡†æ¶å®ç°å„ç±» `NLP` ä»»åŠ¡**\n\n</div>\n\n## ğŸ”¨ å®‰è£…\n\n1. æ­å»ºå¥½ `pytorch GPU` æ·±åº¦å­¦ä¹ ç¯å¢ƒ\n\n```bash\nconda create -n pytorch python=3.8\nconda activate pytorch\nconda install pytorch cudatoolkit -c pytorch\n```\n\n2. å®‰è£… `lightningnlp`\n\n```bash\npip install lightningnlp\n```\n\n3. åœ¨ `https://pytorch-geometric.com/whl/` ä¸­æ‰¾åˆ°ä¸ `torch` ç‰ˆæœ¬å¯¹åº”çš„ `torch_scatter`ï¼Œä¸‹è½½åä½¿ç”¨ `pip` å®‰è£…åˆ°ç¯å¢ƒä¸­ \n\n```python\nimport torch\nprint(torch.__version__)  # 1.12.0\nprint(torch.version.cuda)  # 11.3\n```\n\n```bash\n# ä»¥python=3.8, torch=1.12.0, cuda=11.3ä¸ºä¾‹\nwget https://data.pyg.org/whl/torch-1.12.0%2Bcu113/torch_scatter-2.1.0%2Bpt112cu113-cp38-cp38-linux_x86_64.whl\npip install torch_scatter-2.1.0+pt112cu113-cp38-cp38-linux_x86_64.whl\n```\n\næœ¬é¡¹ç›®ä¹Ÿæä¾›äº†[dockerå®‰è£…æ–¹å¼](./docker)\n\n## ğŸ§¾ æ–‡æœ¬åˆ†ç±»\n\n### 1. æ•°æ®æ ¼å¼\n\n<details>\n<summary>è®­ç»ƒæ•°æ®ç¤ºä¾‹</summary>\n\n```json\n{\n  \"text\": \"ä»¥è‰²åˆ—å¤§è§„æ¨¡ç©ºè¢­å¼€å§‹ï¼ä¼Šæœ—å¤šä¸ªå†›äº‹ç›®æ ‡é­é‡æ‰“å‡»ï¼Œèª“è¨€å¯¹ç­‰åå‡»\",\n  \"label\": \"news_military\"\n}\n```\n\n</details>\n\n### 2. æ¨¡å‹\n\n| æ¨¡å‹                                                        | è®ºæ–‡                                                                                                           | å¤‡æ³¨                              |\n|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|---------------------------------|\n| [fc](lightningnlp/task/text_classification/fc/model.py)   |                                                                                                              | å…¨è¿æ¥å±‚åˆ†ç±»                          |\n| [mdp](lightningnlp/task/text_classification/mdp/model.py) | [Multi-Sample Dropout for Accelerated Training and Better Generalization.](https://arxiv.org/abs/1905.09788) | ä½¿ç”¨ `MultiSampleDropout`ï¼Œç±»ä¼¼äºæ¨¡å‹èåˆ |\n\n<details>\n<summary>è®­ç»ƒä»£ç ç¤ºä¾‹</summary>\n\n```python\nimport os\nos.environ['TRANSFORMERS_NO_ADVISORY_WARNINGS'] = 'true'\n\nimport pytorch_lightning as pl\nfrom pytorch_lightning.loggers import WandbLogger  # éœ€è¦å®‰è£…wandb\nfrom transformers import BertTokenizerFast\n\nfrom lightningnlp.callbacks import LoggingCallback\nfrom lightningnlp.task.text_classification import (\n    TextClassificationDataModule,\n    TextClassificationTransformer,\n)\n\npl.seed_everything(seed=42)\npretrained_model_name_or_path = \"hfl/chinese-roberta-wwm-ext\"  # é¢„è®­ç»ƒæ¨¡å‹\ntokenizer = BertTokenizerFast.from_pretrained(pretrained_model_name_or_path)\n\ndm = TextClassificationDataModule(\n    tokenizer=tokenizer,\n    train_batch_size=16,  # è®­ç»ƒé›†batch_size\n    validation_batch_size=16,  # éªŒè¯é›†batch_size\n    num_workers=16,  # å¤šè¿›ç¨‹åŠ è½½æ•°æ®\n    dataset_name=\"datasets/tnews\",  # è®­ç»ƒæ•°æ®æ‰€åœ¨ç›®å½•\n    train_file=\"train.json\",  # è®­ç»ƒé›†æ–‡ä»¶å\n    validation_file=\"dev.json\",  # éªŒè¯é›†æ–‡ä»¶å\n    train_max_length=256,\n    cache_dir=\"datasets/tnews\",  # æ•°æ®ç¼“å­˜è·¯å¾„\n)\n\nmodel = TextClassificationTransformer(\n    downstream_model_name=\"fc\",  # æ¨¡å‹åç§°\n    downstream_model_type=\"bert\",  # é¢„è®­ç»ƒæ¨¡å‹ç±»å‹\n    pretrained_model_name_or_path=pretrained_model_name_or_path,\n    tokenizer=tokenizer,\n    label_map=dm.id2label,\n    learning_rate=2e-5,\n    output_dir=\"outputs/tnews/fc\",  # æ¨¡å‹ä¿å­˜è·¯å¾„\n)\n\nmodel_ckpt = pl.callbacks.ModelCheckpoint(\n    dirpath=\"outputs/tnews/fc\",\n    filename=\"best_model\",\n    monitor=\"val_accuracy\",\n    save_top_k=1,\n    mode=\"max\",\n)\n\nwandb_logger = WandbLogger(project=\"Text Classification\", name=\"fc\")\n\ntrainer = pl.Trainer(\n    logger=wandb_logger,\n    accelerator=\"gpu\",\n    devices=1,\n    max_epochs=12,\n    val_check_interval=0.5,\n    gradient_clip_val=1.0,\n    callbacks=[model_ckpt, LoggingCallback()]\n)\n\ntrainer.fit(model, dm)\n```\n\n</details>\n\n### 3. é¢„æµ‹\n\n```python\nfrom lightningnlp.task.text_classification import TextClassificationPipeline\n\npipeline = TextClassificationPipeline(model_name_or_path=\"outputs/tnews/fc\", model_name=\"fc\", model_type=\"bert\")\ntext = \"ä»¥è‰²åˆ—å¤§è§„æ¨¡ç©ºè¢­å¼€å§‹ï¼ä¼Šæœ—å¤šä¸ªå†›äº‹ç›®æ ‡é­é‡æ‰“å‡»ï¼Œèª“è¨€å¯¹ç­‰åå‡»\"\nprint(pipeline(text))\n```\n\n### 4. APPåº”ç”¨\n![tc](images/tc.png)\n\n\n## ğŸ“„ å‘½åå®ä½“è¯†åˆ«\n\n### 1. æ•°æ®æ ¼å¼\n\n<details>\n<summary>è®­ç»ƒæ•°æ®ç¤ºä¾‹</summary>\n\n```json\n{\n  \"text\": \"ç»“æœä¸Šå‘¨å…­ä»–ä»¬ä¸»åœº0ï¼š3æƒ¨è´¥ç»™äº†ä¸­æ¸¸çƒé˜Ÿç“¦æ‹‰å¤šåˆ©å¾·ï¼Œè¿‘7ä¸ªå¤šæœˆä»¥æ¥è¥¿ç”²é¦–æ¬¡è¾“çƒã€‚\", \n  \"entities\": [\n    {\n      \"id\": 0, \n      \"entity\": \"ç“¦æ‹‰å¤šåˆ©å¾·\", \n      \"start_offset\": 20, \n      \"end_offset\": 25, \n      \"label\": \"organization\"\n    }, \n    {\n      \"id\": 1, \n      \"entity\": \"è¥¿ç”²\", \n      \"start_offset\": 33, \n      \"end_offset\": 35, \n      \"label\": \"organization\"\n    }\n  ]\n}\n```\n</details>\n\n\n### 2. æ¨¡å‹\n\n\n| æ¨¡å‹                                                                                   | è®ºæ–‡                                                                                                                                                                            | å¤‡æ³¨                                                                                                                                            |\n|--------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|\n| [softmax](lightningnlp/task/named_entity_recognition/crf/model.py)                   |                                                                                                                                                                               | å…¨è¿æ¥å±‚åºåˆ—æ ‡æ³¨å¹¶ä½¿ç”¨ `BIO` è§£ç                                                                                                                           |\n| [crf](lightningnlp/task/named_entity_recognition/crf/model.py)                       | [Conditional Random Fields: Probabilistic Models for Segmenting and Labeling Sequence Data](https://repository.upenn.edu/cgi/viewcontent.cgi?article=1162&context=cis_papers) | å…¨è¿æ¥å±‚+æ¡ä»¶éšæœºåœºï¼Œå¹¶ä½¿ç”¨ `BIO` è§£ç                                                                                                                        |\n| [cascade-crf](lightningnlp/task/named_entity_recognition/crf/model.py)               |                                                                                                                                                                               | å…ˆé¢„æµ‹å®ä½“å†é¢„æµ‹å®ä½“ç±»å‹                                                                                                                                  |\n| [span](lightningnlp/task/named_entity_recognition/span/model.py)                     |                                                                                                                                                                               | ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆç½‘ç»œé¢„æµ‹å®ä½“èµ·å§‹ä½ç½®                                                                                                                              |\n| [global-pointer](lightningnlp/task/named_entity_recognition/global_pointer/model.py) |                                                                                                                                                                               | [GlobalPointerï¼šç”¨ç»Ÿä¸€çš„æ–¹å¼å¤„ç†åµŒå¥—å’ŒéåµŒå¥—NER](https://spaces.ac.cn/archives/8373)ã€[Efficient GlobalPointerï¼šå°‘ç‚¹å‚æ•°ï¼Œå¤šç‚¹æ•ˆæœ](https://spaces.ac.cn/archives/8877) |\n| [mrc](lightningnlp/task/named_entity_recognition/mrc/model.py)                       | [A Unified MRC Framework for Named Entity Recognition.](https://aclanthology.org/2020.acl-main.519.pdf)                                                                       | å°†å®ä½“è¯†åˆ«ä»»åŠ¡è½¬æ¢ä¸ºé˜…è¯»ç†è§£é—®é¢˜ï¼Œè¾“å…¥ä¸ºå®ä½“ç±»å‹æ¨¡æ¿+å¥å­ï¼Œé¢„æµ‹å¯¹åº”å®ä½“çš„èµ·å§‹ä½ç½®                                                                                                     |\n| [tplinker](lightningnlp/task/named_entity_recognition/tplinker/model.py)             | [TPLinker: Single-stage Joint Extraction of Entities and Relations Through Token Pair Linking.](https://aclanthology.org/2020.coling-main.138.pdf)                            | å°†å®ä½“è¯†åˆ«ä»»åŠ¡è½¬æ¢ä¸ºè¡¨æ ¼å¡«å……é—®é¢˜                                                                                                                              |\n| [lear](lightningnlp/task/named_entity_recognition/lear/model.py)                     | [Enhanced Language Representation with Label Knowledge for Span Extraction.](https://aclanthology.org/2021.emnlp-main.379.pdf)                                                | æ”¹è¿› `MRC` æ–¹æ³•æ•ˆç‡é—®é¢˜ï¼Œé‡‡ç”¨æ ‡ç­¾èåˆæœºåˆ¶                                                                                                                      |\n| [w2ner](lightningnlp/task/named_entity_recognition/w2ner/model.py)                   | [Unified Named Entity Recognition as Word-Word Relation Classification.](https://arxiv.org/pdf/2112.10070.pdf)                                                                | ç»Ÿä¸€è§£å†³åµŒå¥—å®ä½“ã€ä¸è¿ç»­å®ä½“çš„æŠ½å–é—®é¢˜                                                                                                                           |\n| [cnn](lightningnlp/task/named_entity_recognition/cnn/model.py)                       | [An Embarrassingly Easy but Strong Baseline for Nested Named Entity Recognition.](https://arxiv.org/abs/2208.04534)                                                           | æ”¹è¿› `W2NER` æ–¹æ³•ï¼Œé‡‡ç”¨å·ç§¯ç½‘ç»œæå–å®ä½“å†…éƒ¨tokenä¹‹é—´çš„å…³ç³»                                                                                                          |\n\n<details>\n<summary>è®­ç»ƒä»£ç ç¤ºä¾‹</summary>\n\n```python\nimport os\nos.environ['TRANSFORMERS_NO_ADVISORY_WARNINGS'] = 'true'\n\nimport pytorch_lightning as pl\nfrom pytorch_lightning.loggers import WandbLogger\nfrom transformers import BertTokenizerFast\n\nfrom lightningnlp.callbacks import LoggingCallback\nfrom lightningnlp.task.named_entity_recognition import (\n    CRFNerDataModule,\n    NamedEntityRecognitionTransformer,\n)\n\npl.seed_everything(seed=42)\npretrained_model_name_or_path = \"hfl/chinese-roberta-wwm-ext\"  # é¢„è®­ç»ƒæ¨¡å‹\ntokenizer = BertTokenizerFast.from_pretrained(pretrained_model_name_or_path)\n\ndm = CRFNerDataModule(\n    tokenizer=tokenizer,\n    train_batch_size=16,  # è®­ç»ƒé›†batch_size\n    validation_batch_size=16,  # éªŒè¯é›†batch_size\n    num_workers=16,  # å¤šè¿›ç¨‹åŠ è½½æ•°æ®\n    dataset_name=\"xusenlin/cmeee\",  # huggingfaceæ•°æ®é›†\n    train_max_length=256,\n    validation_max_length=256,\n    cache_dir=\"datasets/cmeee\",  # æ•°æ®ç¼“å­˜è·¯å¾„\n    task_name=\"cmeee-bert-crf\",  # è‡ªå®šä¹‰ä»»åŠ¡åç§°\n    is_chinese=True,\n)\n\nmodel = NamedEntityRecognitionTransformer(\n    downstream_model_name=\"crf\",  # æ¨¡å‹åç§°\n    downstream_model_type=\"bert\",  # é¢„è®­ç»ƒæ¨¡å‹ç±»å‹\n    pretrained_model_name_or_path=pretrained_model_name_or_path,\n    tokenizer=tokenizer,\n    labels=dm.label_list,\n    learning_rate=2e-5,\n    average=\"micro\",\n    output_dir=\"outputs/cmeee/crf\",  # æ¨¡å‹ä¿å­˜è·¯å¾„\n)\n\nmodel_ckpt = pl.callbacks.ModelCheckpoint(\n    dirpath=\"outputs/cmeee/crf\",\n    filename=\"best_model\",\n    monitor=\"val_f1_micro\",\n    save_top_k=1,\n    mode=\"max\",\n)\n\nwandb_logger = WandbLogger(project=\"Named Entity Recognition\", name=\"cmeee-bert-crf\")\n\ntrainer = pl.Trainer(\n    logger=wandb_logger,\n    accelerator=\"gpu\",\n    devices=1,\n    max_epochs=12,\n    val_check_interval=0.5,\n    gradient_clip_val=1.0,\n    callbacks=[model_ckpt, LoggingCallback()]\n)\n\ntrainer.fit(model, dm)\n```\n\n</details>\n\n### 3. é¢„æµ‹\n\næœ¬é¡¹ç›®åœ¨ [huggingface](https://huggingface.co/xusenlin/cmeee-global-pointer) ä¸Šæä¾›äº†ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹ä½œä¸ºç¤ºä¾‹å¯ä¾›æµ‹è¯•å’Œä½¿ç”¨ï¼Œè¿è¡Œä»¥ä¸‹ä»£ç ä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.named_entity_recognition import NerPipeline\n\npipline = NerPipeline(model_name_or_path=\"xusenlin/cmeee-global-pointer\", model_name=\"global-pointer\", model_type=\"bert\")\ntext = \"ç»“æœä¸Šå‘¨å…­ä»–ä»¬ä¸»åœº0ï¼š3æƒ¨è´¥ç»™äº†ä¸­æ¸¸çƒé˜Ÿç“¦æ‹‰å¤šåˆ©å¾·ï¼Œè¿‘7ä¸ªå¤šæœˆä»¥æ¥è¥¿ç”²é¦–æ¬¡è¾“çƒã€‚\"\npprint(pipline(text))\n```\n\n### 4. APPåº”ç”¨\n\n![ner](./images/ner.png)\n\n\n## ğŸ”– å®ä½“å…³ç³»æŠ½å–\n\n### 1. æ•°æ®æ ¼å¼\n\n<details>\n<summary>è®­ç»ƒæ•°æ®ç¤ºä¾‹</summary>\n\n```json\n{\n  \"text\": \"æŸ¥å°”æ–¯Â·é˜¿å…°åŸºæ–¯ï¼ˆCharles ArÃ¡nguizï¼‰ï¼Œ1989å¹´4æœˆ17æ—¥å‡ºç”Ÿäºæ™ºåˆ©åœ£åœ°äºšå“¥ï¼Œæ™ºåˆ©èŒä¸šè¶³çƒè¿åŠ¨å‘˜ï¼Œå¸èŒä¸­åœºï¼Œæ•ˆåŠ›äºå¾·å›½è¶³çƒç”²çº§è”èµ›å‹’æ²ƒåº“æ£®è¶³çƒä¿±ä¹éƒ¨\", \n  \"spo_list\": [\n    {\n      \"predicate\": \"å‡ºç”Ÿåœ°\", \n      \"object_type\": \"åœ°ç‚¹\", \n      \"subject_type\": \"äººç‰©\", \n      \"object\": \"åœ£åœ°äºšå“¥\", \n      \"subject\": \"æŸ¥å°”æ–¯Â·é˜¿å…°åŸºæ–¯\"\n    }, \n    {\n      \"predicate\": \"å‡ºç”Ÿæ—¥æœŸ\", \n      \"object_type\": \"Date\", \n      \"subject_type\": \"äººç‰©\", \n      \"object\": \"1989å¹´4æœˆ17æ—¥\",\n      \"subject\": \"æŸ¥å°”æ–¯Â·é˜¿å…°åŸºæ–¯\"\n    }\n  ]\n}\n```\n\n</details>\n\n\n### 2. æ¨¡å‹\n\n| æ¨¡å‹                                                                  | è®ºæ–‡                                                                                                                                                 | å¤‡æ³¨                                                                  |\n|---------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n| [casrel](lightningnlp/task/relation_extraction/casrel/model.py)     | [A Novel Cascade Binary Tagging Framework for Relational Triple Extraction.](https://aclanthology.org/2020.acl-main.136.pdf)                       | ä¸¤é˜¶æ®µå…³ç³»æŠ½å–ï¼Œå…ˆæŠ½å–å‡ºå¥å­ä¸­çš„ä¸»è¯­ï¼Œå†é€šè¿‡æŒ‡é’ˆç½‘ç»œæŠ½å–å‡ºä¸»è¯­å¯¹åº”çš„å…³ç³»å’Œå®¾è¯­                             |\n| [tplinker](lightningnlp/task/relation_extraction/tplinker/model.py) | [TPLinker: Single-stage Joint Extraction of Entities and Relations Through Token Pair Linking.](https://aclanthology.org/2020.coling-main.138.pdf) | å°†å…³ç³»æŠ½å–é—®é¢˜è½¬æ¢ä¸ºä¸»è¯­-å®¾è¯­çš„é¦–å°¾è¿æ¥é—®é¢˜                                              |\n| [spn](lightningnlp/task/relation_extraction/spn/model.py)           | [Joint Entity and Relation Extraction with Set Prediction Networks.](http://xxx.itp.ac.cn/pdf/2011.01675v2)                                        | å°†å…³ç³»æŠ½å–é—®é¢˜è½¬ä¸ºä¸ºä¸‰å…ƒç»„çš„é›†åˆé¢„æµ‹é—®é¢˜ï¼Œé‡‡ç”¨ `Encoder-Decoder` æ¡†æ¶                        |\n| [prgc](lightningnlp/task/relation_extraction/prgc/model.py)         | [PRGC: Potential Relation and Global Correspondence Based Joint Relational Triple Extraction.](https://aclanthology.org/2021.acl-long.486.pdf)     | å…ˆæŠ½å–å¥å­çš„æ½œåœ¨å…³ç³»ç±»å‹ï¼Œç„¶åå¯¹äºç»™å®šå…³ç³»æŠ½å–å‡ºå¯¹åº”çš„ä¸»è¯­-å®¾è¯­å¯¹ï¼Œæœ€åé€šè¿‡å…¨å±€å¯¹é½æ¨¡å—è¿‡æ»¤                      |\n| [pfn](lightningnlp/task/relation_extraction/pfn/model.py)           | [A Partition Filter Network for Joint Entity and Relation Extraction.](https://aclanthology.org/2021.emnlp-main.17.pdf)                            | é‡‡ç”¨ç±»ä¼¼  `LSTM`  çš„åˆ†åŒºè¿‡æ»¤æœºåˆ¶ï¼Œå°†éšè—å±‚ä¿¡æ¯åˆ†æˆå®ä½“è¯†åˆ«ã€å…³ç³»è¯†åˆ«å’Œå…±äº«ä¸‰éƒ¨åˆ†ï¼Œå¯¹ä¸ä¸åŒçš„ä»»åŠ¡åˆ©ç”¨ä¸åŒçš„ä¿¡æ¯        |\n| [grte](lightningnlp/task/relation_extraction/grte/model.py)         | [A Novel Global Feature-Oriented Relational Triple Extraction Model based on Table Filling.](https://aclanthology.org/2021.emnlp-main.208.pdf)     | å°†å…³ç³»æŠ½å–é—®é¢˜è½¬æ¢ä¸ºå•è¯å¯¹çš„åˆ†ç±»é—®é¢˜ï¼ŒåŸºäºå…¨å±€ç‰¹å¾æŠ½å–æ¨¡å—å¾ªç¯ä¼˜åŒ–å•è¯å¯¹çš„å‘é‡è¡¨ç¤º                           |\n| [gplinker](lightningnlp/task/relation_extraction/gplinker/model.py) |                                                                                                                                                    | [GPLinkerï¼šåŸºäºGlobalPointerçš„å®ä½“å…³ç³»è”åˆæŠ½å–](https://kexue.fm/archives/8888) |\n\n\n<details>\n<summary>è®­ç»ƒä»£ç ç¤ºä¾‹</summary>\n\n```python\nimport os\nos.environ['TRANSFORMERS_NO_ADVISORY_WARNINGS'] = 'true'\n\nimport pytorch_lightning as pl\nfrom pytorch_lightning.loggers import WandbLogger\nfrom transformers import BertTokenizerFast\n\nfrom lightningnlp.callbacks import LoggingCallback\nfrom lightningnlp.task.relation_extraction import (\n    GPLinkerDataModule,\n    RelationExtractionTransformer,\n)\n\npl.seed_everything(seed=42)\npretrained_model_name_or_path = \"hfl/chinese-roberta-wwm-ext\"  # é¢„è®­ç»ƒæ¨¡å‹\ntokenizer = BertTokenizerFast.from_pretrained(pretrained_model_name_or_path)\n\ndm = GPLinkerDataModule(\n    tokenizer=tokenizer,\n    train_batch_size=16,  # è®­ç»ƒé›†batch_size\n    validation_batch_size=16,  # éªŒè¯é›†batch_size\n    num_workers=16,  # å¤šè¿›ç¨‹åŠ è½½æ•°æ®\n    dataset_name=\"xusenlin/duie\",  # huggingfaceæ•°æ®é›†\n    train_max_length=256,\n    validation_max_length=256,\n    cache_dir=\"datasets/duie\",  # æ•°æ®ç¼“å­˜è·¯å¾„\n    task_name=\"duie-bert-gplinker\",  # è‡ªå®šä¹‰ä»»åŠ¡åç§°\n    is_chinese=True,\n)\n\nmodel = RelationExtractionTransformer(\n    downstream_model_name=\"gplinker\",  # æ¨¡å‹åç§°\n    downstream_model_type=\"bert\",  # é¢„è®­ç»ƒæ¨¡å‹ç±»å‹\n    pretrained_model_name_or_path=pretrained_model_name_or_path,\n    tokenizer=tokenizer,\n    predicates=dm.predicate_list,\n    learning_rate=2e-5,\n    average=\"micro\",\n    output_dir=\"outputs/duie/gplinker\",  # æ¨¡å‹ä¿å­˜è·¯å¾„\n)\n\nmodel_ckpt = pl.callbacks.ModelCheckpoint(\n    dirpath=\"outputs/duie/gplinker\",\n    filename=\"best_model\",\n    monitor=\"val_f1_micro\",\n    save_top_k=1,\n    mode=\"max\",\n)\n\nwandb_logger = WandbLogger(project=\"Relation Extraction\", name=\"duie-bert-gplinker\")\n\ntrainer = pl.Trainer(\n    logger=wandb_logger,\n    accelerator=\"gpu\",\n    devices=1,\n    max_epochs=12,\n    val_check_interval=0.5,\n    gradient_clip_val=1.0,\n    callbacks=[model_ckpt, LoggingCallback()]\n)\n\ntrainer.fit(model, dm)\n```\n\n</details>\n\n### 3. é¢„æµ‹\n\næœ¬é¡¹ç›®åœ¨ [huggingface](https://huggingface.co/xusenlin/duie-gplinker) ä¸Šæä¾›äº†ä¸€ä¸ªè®­ç»ƒå¥½çš„æ¨¡å‹ä½œä¸ºç¤ºä¾‹å¯ä¾›æµ‹è¯•å’Œä½¿ç”¨ï¼Œè¿è¡Œä»¥ä¸‹ä»£ç ä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.relation_extraction import RelationExtractionPipeline\n\npipline = RelationExtractionPipeline(model_name_or_path=\"xusenlin/duie-gplinker\", model_name=\"gplinker\", model_type=\"bert\")\ntext = \"æŸ¥å°”æ–¯Â·é˜¿å…°åŸºæ–¯ï¼ˆCharles ArÃ¡nguizï¼‰ï¼Œ1989å¹´4æœˆ17æ—¥å‡ºç”Ÿäºæ™ºåˆ©åœ£åœ°äºšå“¥ï¼Œæ™ºåˆ©èŒä¸šè¶³çƒè¿åŠ¨å‘˜ï¼Œå¸èŒä¸­åœºï¼Œæ•ˆåŠ›äºå¾·å›½è¶³çƒç”²çº§è”èµ›å‹’æ²ƒåº“æ£®è¶³çƒä¿±ä¹éƒ¨ã€‚\"\npprint(pipline(text))\n```\n\n### 4. APPåº”ç”¨\n\n![re](./images/re.png)\n\n\n## ğŸ­ é€šç”¨ä¿¡æ¯æŠ½å–\n\n+ [UIE(Universal Information Extraction)](https://arxiv.org/pdf/2203.12277.pdf)ï¼šYaojie Luç­‰äººåœ¨ACL-2022ä¸­æå‡ºäº†é€šç”¨ä¿¡æ¯æŠ½å–ç»Ÿä¸€æ¡†æ¶ `UIE`ã€‚\n\n+ è¯¥æ¡†æ¶å®ç°äº†å®ä½“æŠ½å–ã€å…³ç³»æŠ½å–ã€äº‹ä»¶æŠ½å–ã€æƒ…æ„Ÿåˆ†æç­‰ä»»åŠ¡çš„ç»Ÿä¸€å»ºæ¨¡ï¼Œå¹¶ä½¿å¾—ä¸åŒä»»åŠ¡é—´å…·å¤‡è‰¯å¥½çš„è¿ç§»å’Œæ³›åŒ–èƒ½åŠ›ã€‚\n\n+ ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ `UIE` çš„å¼ºå¤§èƒ½åŠ›ï¼Œ[PaddleNLP](https://github.com/PaddlePaddle/PaddleNLP)å€Ÿé‰´è¯¥è®ºæ–‡çš„æ–¹æ³•ï¼ŒåŸºäº `ERNIE 3.0` çŸ¥è¯†å¢å¼ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œè®­ç»ƒå¹¶å¼€æºäº†é¦–ä¸ªä¸­æ–‡é€šç”¨ä¿¡æ¯æŠ½å–æ¨¡å‹ `UIE`ã€‚\n\n+ è¯¥æ¨¡å‹å¯ä»¥æ”¯æŒä¸é™å®šè¡Œä¸šé¢†åŸŸå’ŒæŠ½å–ç›®æ ‡çš„å…³é”®ä¿¡æ¯æŠ½å–ï¼Œå®ç°é›¶æ ·æœ¬å¿«é€Ÿå†·å¯åŠ¨ï¼Œå¹¶å…·å¤‡ä¼˜ç§€çš„å°æ ·æœ¬å¾®è°ƒèƒ½åŠ›ï¼Œå¿«é€Ÿé€‚é…ç‰¹å®šçš„æŠ½å–ç›®æ ‡ã€‚\n\n![uie](./images/uie.png)\n\n<details>\n<summary>ğŸ‘‰ å‘½åå®ä½“è¯†åˆ«</summary>\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.uie import UIEPredictor\n\n# å®ä½“è¯†åˆ«\nschema = ['æ—¶é—´', 'é€‰æ‰‹', 'èµ›äº‹åç§°'] \n# uie-baseæ¨¡å‹å·²ä¸Šä¼ è‡³huggingfaceï¼Œå¯è‡ªåŠ¨ä¸‹è½½ï¼Œå…¶ä»–æ¨¡å‹åªéœ€æä¾›æ¨¡å‹åç§°å°†è‡ªåŠ¨è¿›è¡Œè½¬æ¢\nuie = UIEPredictor(\"xusenlin/uie-base\", schema=schema)\npprint(uie(\"2æœˆ8æ—¥ä¸ŠåˆåŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›ä¸­ä¸­å›½é€‰æ‰‹è°·çˆ±å‡Œä»¥188.25åˆ†è·å¾—é‡‘ç‰Œï¼\")) # Better print results using pprint\n```\nè¾“å‡ºï¼š\n```text\n[{'æ—¶é—´': [{'end': 6,\n          'probability': 0.9857378532924486,\n          'start': 0,\n          'text': '2æœˆ8æ—¥ä¸Šåˆ'}],\n  'èµ›äº‹åç§°': [{'end': 23,\n            'probability': 0.8503089953268272,\n            'start': 6,\n            'text': 'åŒ—äº¬å†¬å¥¥ä¼šè‡ªç”±å¼æ»‘é›ªå¥³å­å¤§è·³å°å†³èµ›'}],\n  'é€‰æ‰‹': [{'end': 31,\n          'probability': 0.8981548639781138,\n          'start': 28,\n          'text': 'è°·çˆ±å‡Œ'}]}]\n```\n</details>\n\n<details>\n<summary>ğŸ‘‰ å®ä½“å…³ç³»æŠ½å–</summary>\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.uie import UIEPredictor\n\n# å…³ç³»æŠ½å–\nschema = {'ç«èµ›åç§°': ['ä¸»åŠæ–¹', 'æ‰¿åŠæ–¹', 'å·²ä¸¾åŠæ¬¡æ•°']}\n# uie-baseæ¨¡å‹å·²ä¸Šä¼ è‡³huggingfaceï¼Œå¯è‡ªåŠ¨ä¸‹è½½ï¼Œå…¶ä»–æ¨¡å‹åªéœ€æä¾›æ¨¡å‹åç§°å°†è‡ªåŠ¨è¿›è¡Œè½¬æ¢\nuie = UIEPredictor(\"xusenlin/uie-base\", schema=schema)\npprint(uie(\"2022è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›ç”±ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šå’Œä¸­å›½è®¡ç®—æœºå­¦ä¼šè”åˆä¸»åŠï¼Œç™¾åº¦å…¬å¸ã€ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šè¯„æµ‹å·¥ä½œå§”å‘˜ä¼šå’Œä¸­å›½è®¡ç®—æœºå­¦ä¼šè‡ªç„¶è¯­è¨€å¤„ç†ä¸“å§”ä¼šæ‰¿åŠï¼Œå·²è¿ç»­ä¸¾åŠ4å±Šï¼Œæˆä¸ºå…¨çƒæœ€çƒ­é—¨çš„ä¸­æ–‡NLPèµ›äº‹ä¹‹ä¸€ã€‚\")) # Better print results using pprint\n```\nè¾“å‡ºï¼š\n```text\n[{'ç«èµ›åç§°': [{'end': 13,\n            'probability': 0.7825402622754041,\n            'relations': {'ä¸»åŠæ–¹': [{'end': 22,\n                                  'probability': 0.8421710521379353,\n                                  'start': 14,\n                                  'text': 'ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼š'},\n                                  {'end': 30,\n                                  'probability': 0.7580801847701935,\n                                  'start': 23,\n                                  'text': 'ä¸­å›½è®¡ç®—æœºå­¦ä¼š'}],\n                          'å·²ä¸¾åŠæ¬¡æ•°': [{'end': 82,\n                                    'probability': 0.4671295049136148,\n                                    'start': 80,\n                                    'text': '4å±Š'}],\n                          'æ‰¿åŠæ–¹': [{'end': 39,\n                                  'probability': 0.8292706618236352,\n                                  'start': 35,\n                                  'text': 'ç™¾åº¦å…¬å¸'},\n                                  {'end': 72,\n                                  'probability': 0.6193477885474685,\n                                  'start': 56,\n                                  'text': 'ä¸­å›½è®¡ç®—æœºå­¦ä¼šè‡ªç„¶è¯­è¨€å¤„ç†ä¸“å§”ä¼š'},\n                                  {'end': 55,\n                                  'probability': 0.7000497331473241,\n                                  'start': 40,\n                                  'text': 'ä¸­å›½ä¸­æ–‡ä¿¡æ¯å­¦ä¼šè¯„æµ‹å·¥ä½œå§”å‘˜ä¼š'}]},\n            'start': 0,\n            'text': '2022è¯­è¨€ä¸æ™ºèƒ½æŠ€æœ¯ç«èµ›'}]}]\n```\n</details>\n\n\n<details>\n<summary>ğŸ‘‰  äº‹ä»¶æŠ½å–</summary>\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.uie import UIEPredictor\n\n# äº‹ä»¶æŠ½å–\nschema = {\"åœ°éœ‡è§¦å‘è¯\": [\"åœ°éœ‡å¼ºåº¦\", \"æ—¶é—´\", \"éœ‡ä¸­ä½ç½®\", \"éœ‡æºæ·±åº¦\"]}\n# uie-baseæ¨¡å‹å·²ä¸Šä¼ è‡³huggingfaceï¼Œå¯è‡ªåŠ¨ä¸‹è½½ï¼Œå…¶ä»–æ¨¡å‹åªéœ€æä¾›æ¨¡å‹åç§°å°†è‡ªåŠ¨è¿›è¡Œè½¬æ¢\nuie = UIEPredictor(\"xusenlin/uie-base\", schema=schema)\npprint(uie(\"ä¸­å›½åœ°éœ‡å°ç½‘æ­£å¼æµ‹å®šï¼š5æœˆ16æ—¥06æ—¶08åˆ†åœ¨äº‘å—ä¸´æ²§å¸‚å‡¤åº†å¿(åŒ—çº¬24.34åº¦ï¼Œä¸œç»99.98åº¦)å‘ç”Ÿ3.5çº§åœ°éœ‡ï¼Œéœ‡æºæ·±åº¦10åƒç±³ã€‚\")) # Better print results using pprint\n```\nè¾“å‡ºï¼š\n```text\n[{'åœ°éœ‡è§¦å‘è¯': {'end': 58,\n            'probability': 0.9977425932884216,\n            'relation': {'åœ°éœ‡å¼ºåº¦': [{'end': 56,\n                                   'probability': 0.9980800747871399,\n                                   'start': 52,\n                                   'text': '3.5çº§'}],\n                         'æ—¶é—´': [{'end': 22,\n                                 'probability': 0.9853301644325256,\n                                 'start': 11,\n                                 'text': '5æœˆ16æ—¥06æ—¶08åˆ†'}],\n                         'éœ‡ä¸­ä½ç½®': [{'end': 50,\n                                   'probability': 0.7874020934104919,\n                                   'start': 23,\n                                   'text': 'äº‘å—ä¸´æ²§å¸‚å‡¤åº†å¿(åŒ—çº¬24.34åº¦ï¼Œä¸œç»99.98åº¦)'}],\n                         'éœ‡æºæ·±åº¦': [{'end': 67,\n                                   'probability': 0.9937973618507385,\n                                   'start': 63,\n                                   'text': '10åƒç±³'}]},\n            'start': 56,\n            'text': 'åœ°éœ‡'}}]\n```\n</details>\n\n<details>\n<summary>ğŸ‘‰ è¯„è®ºè§‚ç‚¹æŠ½å–</summary>\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.uie import UIEPredictor\n\n# äº‹ä»¶æŠ½å–\nschema = {'è¯„ä»·ç»´åº¦': ['è§‚ç‚¹è¯', 'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]']}\n# uie-baseæ¨¡å‹å·²ä¸Šä¼ è‡³huggingfaceï¼Œå¯è‡ªåŠ¨ä¸‹è½½ï¼Œå…¶ä»–æ¨¡å‹åªéœ€æä¾›æ¨¡å‹åç§°å°†è‡ªåŠ¨è¿›è¡Œè½¬æ¢\nuie = UIEPredictor(\"xusenlin/uie-base\", schema=schema)\npprint(uie(\"åº—é¢å¹²å‡€ï¼Œå¾ˆæ¸…é™ï¼ŒæœåŠ¡å‘˜æœåŠ¡çƒ­æƒ…ï¼Œæ€§ä»·æ¯”å¾ˆé«˜ï¼Œå‘ç°æ”¶é“¶å°æœ‰æ’é˜Ÿ\")) # Better print results using pprint\n```\nè¾“å‡ºï¼š\n```text\n[{'è¯„ä»·ç»´åº¦': [{'end': 20,\n            'probability': 0.9817040258681473,\n            'relations': {'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': [{'probability': 0.9966142505350533,\n                                          'text': 'æ­£å‘'}],\n                          'è§‚ç‚¹è¯': [{'end': 22,\n                                  'probability': 0.957396472711558,\n                                  'start': 21,\n                                  'text': 'é«˜'}]},\n            'start': 17,\n            'text': 'æ€§ä»·æ¯”'},\n          {'end': 2,\n            'probability': 0.9696849569741168,\n            'relations': {'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': [{'probability': 0.9982153274927796,\n                                          'text': 'æ­£å‘'}],\n                          'è§‚ç‚¹è¯': [{'end': 4,\n                                  'probability': 0.9945318044652538,\n                                  'start': 2,\n                                  'text': 'å¹²å‡€'}]},\n            'start': 0,\n            'text': 'åº—é¢'}]}]\n```\n</details>\n\n\n<details>\n<summary>ğŸ‘‰ æƒ…æ„Ÿåˆ†ç±»</summary>\n\n\n```python\nfrom pprint import pprint\nfrom lightningnlp.task.uie import UIEPredictor\n\n# äº‹ä»¶æŠ½å–\nschema = 'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]'\n# uie-baseæ¨¡å‹å·²ä¸Šä¼ è‡³huggingfaceï¼Œå¯è‡ªåŠ¨ä¸‹è½½ï¼Œå…¶ä»–æ¨¡å‹åªéœ€æä¾›æ¨¡å‹åç§°å°†è‡ªåŠ¨è¿›è¡Œè½¬æ¢\nuie = UIEPredictor(\"xusenlin/uie-base\", schema=schema)\npprint(uie(\"è¿™ä¸ªäº§å“ç”¨èµ·æ¥çœŸçš„å¾ˆæµç•…ï¼Œæˆ‘éå¸¸å–œæ¬¢\")) # Better print results using pprint\n```\nè¾“å‡ºï¼š\n```text\n[{'æƒ…æ„Ÿå€¾å‘[æ­£å‘ï¼Œè´Ÿå‘]': {'end': 0,\n                  'probability': 0.9990023970603943,\n                  'start': 0,\n                  'text': 'æ­£å‘'}}]\n```\n</details>\n\n\n## Citation\nå¦‚æœ `LightningNLP` å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œæ¬¢è¿å¼•ç”¨\n\n```text\n@misc{=lightningnlp,\n    title={LightningNLP: An Easy-to-use NLP Library},\n    author={senlin xu},\n    howpublished = {\\url{https://github.com/xusenlinzy/lightningblocks}},\n    year={2022}\n}\n```\n\n## Acknowledge\n\næˆ‘ä»¬å€Ÿé‰´äº†[`Lightning-transformers`](https://github.com/Lightning-AI/lightning-transformers) å…³äºæ¨¡å‹ä½¿ç”¨çš„ä¼˜ç§€è®¾è®¡ï¼Œåœ¨æ­¤å¯¹`Lightning-transformers` ä½œè€…åŠå…¶å¼€æºç¤¾åŒºè¡¨ç¤ºæ„Ÿè°¢ã€‚\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/xusenlinzy/lightningblocks",
    "keywords": "",
    "license": "MIT Licence",
    "maintainer": "",
    "maintainer_email": "",
    "name": "lightningnlp",
    "package_url": "https://pypi.org/project/lightningnlp/",
    "platform": null,
    "project_url": "https://pypi.org/project/lightningnlp/",
    "project_urls": {
      "Homepage": "https://github.com/xusenlinzy/lightningblocks"
    },
    "release_url": "https://pypi.org/project/lightningnlp/1.0.3/",
    "requires_dist": [
      "colorama",
      "colorlog",
      "datasets",
      "faster-tokenizer",
      "jieba",
      "onnx",
      "onnxconverter-common",
      "onnxruntime",
      "pypinyin",
      "pytorch-lightning",
      "scikit-learn",
      "scipy",
      "seaborn",
      "sentencepiece",
      "setuptools",
      "spacy",
      "streamlit",
      "torchmetrics",
      "transformers"
    ],
    "requires_python": ">=3.7",
    "summary": "Pytorch-lightning Code Blocks for NLP",
    "version": "1.0.3",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 16868320,
  "releases": {
    "1.0.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "e8c82ed400841d3471c7553f0f0a1e6be534719d25491ff2027acbad3c81e615",
          "md5": "a5388c661bb71a51a8d0e416e74c66a9",
          "sha256": "f0b25374fcdd7b2ce4af418bbb3d45689da217ea8b8d41239cd064f012e74171"
        },
        "downloads": -1,
        "filename": "lightningnlp-1.0.3-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "a5388c661bb71a51a8d0e416e74c66a9",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.7",
        "size": 319068,
        "upload_time": "2023-02-15T08:57:05",
        "upload_time_iso_8601": "2023-02-15T08:57:05.398396Z",
        "url": "https://files.pythonhosted.org/packages/e8/c8/2ed400841d3471c7553f0f0a1e6be534719d25491ff2027acbad3c81e615/lightningnlp-1.0.3-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "e8c82ed400841d3471c7553f0f0a1e6be534719d25491ff2027acbad3c81e615",
        "md5": "a5388c661bb71a51a8d0e416e74c66a9",
        "sha256": "f0b25374fcdd7b2ce4af418bbb3d45689da217ea8b8d41239cd064f012e74171"
      },
      "downloads": -1,
      "filename": "lightningnlp-1.0.3-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "a5388c661bb71a51a8d0e416e74c66a9",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.7",
      "size": 319068,
      "upload_time": "2023-02-15T08:57:05",
      "upload_time_iso_8601": "2023-02-15T08:57:05.398396Z",
      "url": "https://files.pythonhosted.org/packages/e8/c8/2ed400841d3471c7553f0f0a1e6be534719d25491ff2027acbad3c81e615/lightningnlp-1.0.3-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}