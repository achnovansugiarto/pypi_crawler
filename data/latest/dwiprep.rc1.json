{
  "info": {
    "author": "Gal Ben-Zvi",
    "author_email": "benzvigal@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Intended Audience :: Healthcare Industry",
      "Intended Audience :: Science/Research",
      "License :: OSI Approved :: MIT License",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3 :: Only",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9"
    ],
    "description": "# _DWIPrep_: A Robust Preprocessing Pipeline for dMRI Data\n\nThis pipeline is being developed and maintaing [Yaniv Assaf's lab at Tel Aviv University](https://www.yalab.sites.tau.ac.il/), as an open-source tool for preprocessing of dMRI data.\n\n_DWIPrep_ is a diffusion magnetic resonance image (dMRI) data preprocessing pipeline that is designed to provide an easily accessible, robust and dynamic interface, allowing basic pre-processing for both within-subject (plasticity) and between-subjects datasets, envolving a wide variety of dMRI scan acquisitions. <br />\nThe _dMRIPrep_ pipeline uses a combination of tools from well-known software packages, including [FSL](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/), [MRtrix3](https://mrtrix.readthedocs.io/en/latest/), [SPM](https://www.fil.ion.ucl.ac.uk/spm/) and [CAT12](http://www.neuro.uni-jena.de/cat/). This pipeline was designed to provide a potentially best preprocessing pipeline for a wide range of dMRI data acquisition parameters, and will be updated as new neuroimaging software become available.\n\nThis tool allows you to easily do the following:\n\n- Preprocess a wide variety of dMRI data, from raw NIfTI (structured to follow the [BIDS format](https://bids-specification.readthedocs.io/en/stable/)) to fully preprocessed form.\n- Account for specific preprocessing procedures that are crucial of analyzing plasticity (i.e, within-subjects) datasets.\n- Automate processing steps.\n\n____\n# **Preprocessing (including demonstrations):**\n\n1. Extraction of opposite phase-encoding DWI's **B<sub>0</sub> volumes** for later Susceptability Distortions Correction (SDC).\n\n\n2. **Motion & Susceptability Distortions Correction (SDC)** using FSL's [*topup*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/topup)<sup>1</sup> and [*Eddy*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/eddy)<sup>2</sup>, as implemented via MRTrix3's [*dwifslpreproc*](https://mrtrix.readthedocs.io/en/latest/reference/commands/dwifslpreproc.html)<sup>3</sup>. Note that the pipeline assumes **opposite** phase encoding directions, as it was found to be optimal for SDC<sup>4</sup>.\n\n   <p align=\"center\"> \n   <img width=\"500\" src=\"images/preprocessing/SDC.gif\" > \n   </p>\n   <p align=\"center\"> \n\n    *Figure 1:* AP and PA represent the opposite, uncorrected, B0 volumes - extracted from opposite phase-encoded DWIs, \"corrected\" stands for post-SDC implementation of *dwifslpreproc*.\n3. B1 field inhomogeneity correction for a DWI volume series, using the N4 algorithm as provided in ANTs* ([*N4BiasFieldCorrection*](https://simpleitk.readthedocs.io/en/master/link_N4BiasFieldCorrection_docs.html))<sup>5</sup>, as implemented in MRTtrix3's [*dwibiascorrect*](https://mrtrix.readthedocs.io/en/latest/reference/commands/dwibiascorrect.html#dwibiascorrect-ants)<sup>3</sup>.\n\n\\* In case ANTs is not installed in user's computer, the pipeline will use FSL's  *fast* algorithm<sup>6,7</sup>, which is discouraged due to its dependency on DWI's brain masking.\n\n___\n# **Estimation of diffusion (kurtosis) tensor & tensor-derived parameters**\nFollowing the preprocessing of DWI data, the pipeline automatically estimates several, widely used, tensor-derived parameters:\n1. **Estimation of diffusion tensor** using MRTrix3 *tensor2metric* implementation of the Weighted Linear Least Squares estimation of diffusion MRI parameters<sup>8</sup>.\n2. **Generation of tensor-derived parameters maps**<sup>9,10</sup>\n<p align=\"center\"> \n   <img width=\"400\" src=\"images/tensors/tensor_parameters.png\" > \n</p>\n\n___\n# **Registration pipeline**\n## **Longitudinal (Multi-sessions)**\nTo account for registration-induced biases, we've implemented a within-subject (i.e, between-sessions) registration pipeline, before normalizing subject's data into standard space. This implementation includes the following steps:\n1. Registration of subject’s first session (\"pre\") b<sub>0</sub> to it’s second one (“post”) b<sub>0</sub> and vice versa (post's b<sub>0</sub> to pre's b<sub>0</sub>), using FSL’s [*flirt*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT)<sup>11,12</sup>, with a *mutual information* cost function.\n2. Calculation of forward and backward *halfway transformation matrices* (pre to post and post to pre, accordingly) using FSL’s [*avscle*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT/UserGuide#avscale). \n3. Applying halfway transformation to both sessions’ b<sub>0</sub> (forward to pre, backward to post), registrating them into subject's \"middle\" space.\n4. Calculating subject’s average (between sessions) b<sub>0</sub>, as the average of both coregistered b<sub>0</sub>s.\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/coreg_within.gif\" > \n</p>\n5. Same procedure is applied to register (between-sessions) subjects’ anatomical (T1) images.\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/coreg_t1_within.gif\" > \n</p>\n\n## **Co-registrations and Normalization**\nNote that all registerations procedures denoted below, when performed on a longitudinal dataset, do so for the within-subject (between-sessions) registered images.\n## **Coregistration (DWI to T<sub>1</sub>)**\nCoregistration, in this case, refers to the registration of images of different modalities (i.e DWI, T<sub>1</sub>, etc.) of the same subject.\nCoregisteration is performed using FSL's [*epi_reg*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FLIRT/UserGuide#epi_reg) script, performing appropriate linear registration between subject's B<sub>0</sub> and T<sub>1</sub> images.\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/coreg_modalities.gif\" > \n</p>\n\n## **Normalization**\nBy default, the *normalization* procedure conducted as part of this pipeline makes use of the [Computational Anatomy Toolbox (CAT)](http://www.neuro.uni-jena.de/cat/) for SPM. Since it requires MATLAB and SPM to be installed, the pipeline will resort to using FSL's [*fsl_anat*](https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/fsl_anat) script.\n### **CAT12**\nCAT12 is a structural preprocessing tool offered as an addition to the Statistical Parametric Mapping (SPM) toolbox. It offers robust spatial normalization algorithms, as well as a Quality Assurance (QA) score regarding the structural image being processed, for example:\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/cat_example.jpg\" > \n</p>\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/cat12_preproc.gif\" > \n</p>\n\n### **fsl_anat**\nIn case the user doesn't have MATLAB/SPM/CAT12 installed, the pipeline will resort to performing the spatial normalization using FSL's *fsl_anat*, which includes the following:\n1. Reorientation to standard (MNI) orientation using fslreorient2std.\n2. Automatically cropping the image using robustfov.\n3. Bias-field correction (RF/B1-inhomogeneity-correction) using FAST.\n4. Registration to standard space (linear and nonlinear) using FLIRT and FNIRT.\n5. Brain extraction (FNIRT-based)\n6. Tissue-type segmentation using FAST.\n7. Subcortical structure segmentation using FIRST.\nA summarized presentation of the anatomical preprocessing conducted via *fsl_anat*:\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/anat_preproc.gif\" > \n</p>\n\n\n## **Inverse registration**\nFollowing the \"forward\" registration (i.e, from subject to average space), and only if a parcellation atlas in MNI space is given as input for the pipeline, a \"backward\" registration (i.e from MNI to native space) is performed to transform the parcellation atlas into subject's space.\nNote that this behaviour is promoted due to our agenda to promote region-based analyses (RBA), as described in our paper<sup>13</sup> (under review).\nFor example, a reverse registration performed on the Brainnetome parcellation atlas<sup>14</sup>:\n<p align=\"center\"> \n   <img width=\"500\" src=\"images/registrations/atlas2native.gif\"> \n</p>\n\n___\n\n## References\n1. Andersson, J. L., Skare, S., & Ashburner, J. (2003). How to correct susceptibility distortions in spin-echo echo-planar images: application to diffusion tensor imaging. Neuroimage, 20(2), 870-888.\n2. Andersson, J. L., & Sotiropoulos, S. N. (2016). An integrated approach to correction for off-resonance effects and subject movement in diffusion MR imaging. Neuroimage, 125, 1063-1078.\n3. Tournier, J. D., Smith, R., Raffelt, D., Tabbara, R., Dhollander, T., Pietsch, M., ... & Connelly, A. (2019). MRtrix3: A fast, flexible and open software framework for medical image processing and visualisation. NeuroImage, 202, 116137.\n4. Gu, X., & Eklund, A. (2019). Evaluation of six phase encoding based susceptibility distortion correction methods for diffusion MRI. Frontiers in neuroinformatics, 13, 76.\n5. Tustison, N. J., Avants, B. B., Cook, P. A., Zheng, Y., Egan, A., Yushkevich, P. A., & Gee, J. C. (2010). N4ITK: improved N3 bias correction. IEEE transactions on medical imaging, 29(6), 1310-1320.\n6. Zhang, Y.; Brady, M. & Smith, S. Segmentation of brain MR images through a hidden Markov random field model and the expectation-maximization algorithm. IEEE Transactions on Medical Imaging, 2001, 20, 45-57\n7. Smith, S. M.; Jenkinson, M.; Woolrich, M. W.; Beckmann, C. F.; Behrens, T. E.; Johansen-Berg, H.; Bannister, P. R.; De Luca, M.; Drobnjak, I.; Flitney, D. E.; Niazy, R. K.; Saunders, J.; Vickers, J.; Zhang, Y.; De Stefano, N.; Brady, J. M. & Matthews, P. M. Advances in functional and structural MR image analysis and implementation as FSL. NeuroImage, 2004, 23, S208-S219\n8. Veraart, J.; Sijbers, J.; Sunaert, S.; Leemans, A. & Jeurissen, B. Weighted linear least squares estimation of diffusion MRI parameters: strengths, limitations, and pitfalls. NeuroImage, 2013, 81, 335-346\n9. Basser, P. J.; Mattiello, J. & Lebihan, D. MR diffusion tensor spectroscopy and imaging. Biophysical Journal, 1994, 66, 259-267\n10. Westin, C. F.; Peled, S.; Gudbjartsson, H.; Kikinis, R. & Jolesz, F. A. Geometrical diffusion measures for MRI from tensor basis analysis. Proc Intl Soc Mag Reson Med, 1997, 5, 1742\n11. Jenkinson, M., Bannister, P., Brady, M., Smith, S., 2002. Improved optimization for the\nrobust and accurate linear registration and motion correction of brain images. Neuroimage 17, 825-841.\n12. Jenkinson, M., Smith, S., 2001. A global optimisation method for robust affine registration of brain images. Med Image Anal 5, 143-156.\n13. Ben-Zvi, G., Hofstetter, S., Tavor, I. \\& Assaf, Y. (2021). Measuring neuroplasticity with diffusion MRI: experimental considerations. (under review)\n14. Fan, L., Li, H., Zhuo, J., Zhang, Y., Wang, J., Chen, L., ... & Jiang, T. (2016). The human brainnetome atlas: a new brain atlas based on connectional architecture. Cerebral cortex, 26(8), 3508-3526.\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/GalBenZvi/dwiprep",
    "keywords": "mri,dwi,python,neuroimaging",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "dwiprep",
    "package_url": "https://pypi.org/project/dwiprep/",
    "platform": "",
    "project_url": "https://pypi.org/project/dwiprep/",
    "project_urls": {
      "Bug Reports": "https://github.com/GalBenZvi/dwiprep/issues/",
      "Homepage": "https://github.com/GalBenZvi/dwiprep",
      "Source": "https://github.com/GalBenZvi/dwiprep"
    },
    "release_url": "https://pypi.org/project/dwiprep/0.1.5/",
    "requires_dist": [
      "pydicom (~=2.1.2)",
      "numpy ; python_version == \"3.6\"",
      "numpy (~=1.21) ; python_version > \"3.6\"",
      "black (==21.5b1) ; extra == 'all'",
      "build ; extra == 'all'",
      "nibabel (~=1.6) ; extra == 'all'",
      "pybids (~=0.12) ; extra == 'all'",
      "termcolor (~=1.1) ; extra == 'all'",
      "coverage[toml] (~=5.5) ; extra == 'all'",
      "coverage-badge (~=1.0) ; extra == 'all'",
      "doc8 (~=0.8) ; extra == 'all'",
      "flake8 (~=3.7) ; extra == 'all'",
      "ipython ; extra == 'all'",
      "isort (~=5.8) ; extra == 'all'",
      "jinja2 (~=3.0) ; extra == 'all'",
      "pandas (~=1.3) ; extra == 'all'",
      "pytest (~=6.2) ; extra == 'all'",
      "sphinx (~=4.0) ; extra == 'all'",
      "sphinx-rtd-theme (~=0.5) ; extra == 'all'",
      "tox (~=3.23) ; extra == 'all'",
      "twine ; extra == 'all'",
      "python-magic (~=0.4) ; (platform_system != \"Windows\") and extra == 'all'",
      "pickle5 (~=0.0) ; (python_version <= \"3.7\") and extra == 'all'",
      "black (==21.5b1) ; extra == 'dev'",
      "coverage[toml] (~=5.5) ; extra == 'dev'",
      "doc8 (~=0.8) ; extra == 'dev'",
      "flake8 (~=3.7) ; extra == 'dev'",
      "ipython ; extra == 'dev'",
      "isort (~=5.8) ; extra == 'dev'",
      "pytest (~=6.2) ; extra == 'dev'",
      "sphinx (~=4.0) ; extra == 'dev'",
      "sphinx-rtd-theme (~=0.5) ; extra == 'dev'",
      "tox (~=3.23) ; extra == 'dev'",
      "python-magic (~=0.4) ; (platform_system != \"Windows\") and extra == 'dev'",
      "build ; extra == 'dist'",
      "twine ; extra == 'dist'",
      "sphinx (~=4.0) ; extra == 'docs'",
      "sphinx-rtd-theme (~=0.5) ; extra == 'docs'",
      "python-magic (~=0.4) ; (platform_system != \"Windows\") and extra == 'magic'",
      "jinja2 ; extra == 'pandas'",
      "pandas ; extra == 'pandas'",
      "coverage[toml] (~=5.5) ; extra == 'test'",
      "pytest (~=6.2) ; extra == 'test'",
      "tox (~=3.23) ; extra == 'test'",
      "python-magic (~=0.4) ; (platform_system != \"Windows\") and extra == 'test'",
      "pickle5 (~=0.0) ; (python_version <= \"3.7\") and extra == 'test'"
    ],
    "requires_python": "<4,>=3.6",
    "summary": "DWIprep is a robust and easy-to-use preprocessing pipeline for diffusion-weighted imaging of various acquisitions.",
    "version": "0.1.5",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 11128950,
  "releases": {
    "0.1.5": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "a76192cc71aa89db6dd1993e3a01b72203c20aba8ce8ac301c6759f202884834",
          "md5": "c236ce475b9dad61c42758d6f2123308",
          "sha256": "5654da301634df38165f758073554c5133e22091afc4e9ab5fda12d3e9e3fe3e"
        },
        "downloads": -1,
        "filename": "dwiprep-0.1.5-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "c236ce475b9dad61c42758d6f2123308",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": "<4,>=3.6",
        "size": 38328,
        "upload_time": "2021-08-09T11:03:14",
        "upload_time_iso_8601": "2021-08-09T11:03:14.886099Z",
        "url": "https://files.pythonhosted.org/packages/a7/61/92cc71aa89db6dd1993e3a01b72203c20aba8ce8ac301c6759f202884834/dwiprep-0.1.5-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "56224282b09e1399cd6dd1c0b03d6998290a34d26e5e6956a72c9d98d4962b64",
          "md5": "7cb2a1b3f92962bb78d33114e84d1d09",
          "sha256": "43800f4dcc663c6eceae1b643347711c4d7d0543a2602e69faf3dbe49ce92166"
        },
        "downloads": -1,
        "filename": "dwiprep-0.1.5.tar.gz",
        "has_sig": false,
        "md5_digest": "7cb2a1b3f92962bb78d33114e84d1d09",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": "<4,>=3.6",
        "size": 38963,
        "upload_time": "2021-08-09T11:03:16",
        "upload_time_iso_8601": "2021-08-09T11:03:16.497295Z",
        "url": "https://files.pythonhosted.org/packages/56/22/4282b09e1399cd6dd1c0b03d6998290a34d26e5e6956a72c9d98d4962b64/dwiprep-0.1.5.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "a76192cc71aa89db6dd1993e3a01b72203c20aba8ce8ac301c6759f202884834",
        "md5": "c236ce475b9dad61c42758d6f2123308",
        "sha256": "5654da301634df38165f758073554c5133e22091afc4e9ab5fda12d3e9e3fe3e"
      },
      "downloads": -1,
      "filename": "dwiprep-0.1.5-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "c236ce475b9dad61c42758d6f2123308",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": "<4,>=3.6",
      "size": 38328,
      "upload_time": "2021-08-09T11:03:14",
      "upload_time_iso_8601": "2021-08-09T11:03:14.886099Z",
      "url": "https://files.pythonhosted.org/packages/a7/61/92cc71aa89db6dd1993e3a01b72203c20aba8ce8ac301c6759f202884834/dwiprep-0.1.5-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "56224282b09e1399cd6dd1c0b03d6998290a34d26e5e6956a72c9d98d4962b64",
        "md5": "7cb2a1b3f92962bb78d33114e84d1d09",
        "sha256": "43800f4dcc663c6eceae1b643347711c4d7d0543a2602e69faf3dbe49ce92166"
      },
      "downloads": -1,
      "filename": "dwiprep-0.1.5.tar.gz",
      "has_sig": false,
      "md5_digest": "7cb2a1b3f92962bb78d33114e84d1d09",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": "<4,>=3.6",
      "size": 38963,
      "upload_time": "2021-08-09T11:03:16",
      "upload_time_iso_8601": "2021-08-09T11:03:16.497295Z",
      "url": "https://files.pythonhosted.org/packages/56/22/4282b09e1399cd6dd1c0b03d6998290a34d26e5e6956a72c9d98d4962b64/dwiprep-0.1.5.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}