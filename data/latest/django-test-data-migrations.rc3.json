{
  "info": {
    "author": "Imran Ariffin",
    "author_email": "ariffin.imran@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "License :: OSI Approved :: MIT License",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9"
    ],
    "description": "[![PyPI version](https://badge.fury.io/py/django-test-data-migrations.svg)](https://badge.fury.io/py/django-test-data-migrations) [![Downloads](https://pepy.tech/badge/django-test-data-migrations/week)](https://pepy.tech/project/django-test-data-migrations) [![codecov](https://codecov.io/gh/imranariffin/django-test-data-migrations/branch/main/graph/badge.svg?token=ipUDI8A4ol)](https://codecov.io/gh/imranariffin/django-test-data-migrations)\n\n# Django Data Migration Test\n\nTest utilities for easily testing Django data migrations\n\n## Installation\n\n```\npip install django-test-data-migrations\n```\n\n## Usage\n\nDefine the following functions in your migration file\n1. `data_forward(*args)`\n2. `data_backward(*args)` (optional)\n\n```python\nfrom django_test_data_migrations import DataMigrationsTestCaseBase\n\nfrom app_a.models import Animal\n\nclass YourDataMigrationTestCase(DataMigrationsTestCaseBase):\n    def test__forward_migration__something_important(self):\n        # Prepare some data\n\n        # Run\n        self.data_forward(some_arg_0, some_arg_1, ...)\n\n        # Some assertions\n    \n    def test__backward_migration__something_important(self):\n        # Prepare some data\n\n        # Run\n        self.data_backward(some_arg_0, some_arg_1, ...)\n\n        # Some assertions\n```\n\n## Example\nSay you have a simple Django project with following general structure\n```bash\ntest_project/\n└── app_a\n    ├── apps.py\n    ├── __init__.py\n    ├── migrations\n    │   ├── 0001_initial.py\n    │   ├── 0002_datafix_addsuffixtoname.py\n    │   └── __init__.py\n    ├── models.py\n    └── tests\n        ├── __init__.py\n        └── test_0002_datafix_addsuffixtoname.py\n```\nwith the following model\n```python\nfrom django.db import models\n\n\nclass Animal(models.Model):\n    species = models.CharField(blank=False, null=False, max_length=50)\n    name = models.CharField(blank=False, null=False, max_length=100)\n\n    def __str__(self):\n        return f\"Animal [name={self.name}, species={self.species}]\"\n```\nalong with the following migration\n```python\n# app_a/migrations/0002_datafix_addsuffixtoname.py\n\nfrom django.db import migrations\n\nSUFFIX = \" ZZ\"\n\n\ndef data_forward(Animal):\n    for animal in Animal.objects.all():\n        animal.name += SUFFIX\n        animal.save()\n\n\ndef data_backward(Animal):\n    for animal in Animal.objects.filter(name__endswith=SUFFIX):\n        animal.name = animal.name.rstrip(SUFFIX)\n        animal.save()\n\n\ndef forward(apps, schema_editor):\n    Animal = apps.get_model(\"app_a\", \"Animal\")\n    data_forward(Animal)\n\n\ndef backward(apps, schema_editor):\n    Animal = apps.get_model(\"app_a\", \"Animal\")\n    data_backward(Animal)\n\n\nclass Migration(migrations.Migration):\n\n    dependencies = [\n        ('app_a', '0001_initial'),\n    ]\n\n    operations = [\n        migrations.RunPython(forward, backward),\n    ]\n```\nYou can test it as the following\n```python\nfrom django_test_data_migrations import DataMigrationsTestCaseBase\n\nfrom app_a.models import Animal\n\n\nclass DataMigrationsTestCase(DataMigrationsTestCaseBase):\n    app_name = \"app_a\"\n    migration_name = \"0002_datafix_addsuffixtoname\"\n\n    def test__data_forward__append_suffix_to_name(self):\n        # Prepare data before migration\n        dog = Animal.objects.create(name=\"Dog\", species=\"dog\")\n        cat = Animal.objects.create(name=\"Cat\", species=\"cat\")\n\n        # Run `data_forward` aka the entry point to your data migration\n        self.data_forward(Animal)\n\n        # Make your assertions\n        self.assertEqual(Animal.objects.get(id=dog.id).name, \"Dog ZZ\")\n        self.assertEqual(Animal.objects.get(id=cat.id).name, \"Cat ZZ\")\n\n    def test__data_backward__append_suffix_to_name(self):\n        dog = Animal.objects.create(name=\"Dog ZZ\", species=\"dog\")\n        cat = Animal.objects.create(name=\"Cat zz\", species=\"cat\")\n\n        self.data_backward(Animal)\n\n        self.assertEqual(Animal.objects.get(id=dog.id).name, \"Dog\")\n        self.assertEqual(Animal.objects.get(id=cat.id).name, \"Cat zz\")\n```\n\n## Why would you need this library?\n\n1. It runs your data migration test very fast.\n2. It encourages developers to write data-related Django migrations separately from model definition related Django migrations\n3. Writing tests for data related migrations is extremely important, but it's either tricky to do or very run-time consuming. This library intends to enable testing data migrations easy and fast\n\n## Development\n\n### Setup\nCheck requirements\n```\npoetry --version\n```\nClone source code repository\n```bash\ngit clone git@github.com:imranariffin/django-test-data-migrations.git\n```\nInstall dev dependencies\n```bash\npoetry install\n```\n\n### Run tests\n```bash\nmake test\n```\nYou should be ready to start development\n\n## Links\n\n* [PyPi](https://pypi.org/project/django-test-data-migrations/)\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/imranariffin/django-test-data-migrations",
    "keywords": "django,django-test,django-migration,django-migrations,django-data-migration-test,django-data-migration-tests,django-orm,migration,migrations,data-migration,data-migrations,orm,sql,tests,test",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "django-test-data-migrations",
    "package_url": "https://pypi.org/project/django-test-data-migrations/",
    "platform": "",
    "project_url": "https://pypi.org/project/django-test-data-migrations/",
    "project_urls": {
      "Homepage": "https://github.com/imranariffin/django-test-data-migrations",
      "Repository": "https://github.com/imranariffin/django-test-data-migrations"
    },
    "release_url": "https://pypi.org/project/django-test-data-migrations/0.1.2/",
    "requires_dist": null,
    "requires_python": ">=3.6,<4.0",
    "summary": "Test utilities for easily testing Django data migrations",
    "version": "0.1.2",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 8944153,
  "releases": {
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "8853cd6da13155cfc934c702c28413b99f9dbc36ab4a982b9bed0a710f2382d4",
          "md5": "a078f3adbf5ec3672f45677aa0590265",
          "sha256": "8183249040e22043a988dbd69c0e2fa6e61eb2c3ccf44d4fd71f22db2ee66035"
        },
        "downloads": -1,
        "filename": "django_test_data_migrations-0.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "a078f3adbf5ec3672f45677aa0590265",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6,<4.0",
        "size": 3329,
        "upload_time": "2020-11-28T05:39:51",
        "upload_time_iso_8601": "2020-11-28T05:39:51.818929Z",
        "url": "https://files.pythonhosted.org/packages/88/53/cd6da13155cfc934c702c28413b99f9dbc36ab4a982b9bed0a710f2382d4/django_test_data_migrations-0.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "af78a7c23976e38bf53ec37309041461b3c6ebb8d46c812877310f30c9b17cc5",
          "md5": "3ff7316bd2a7cd03e7fde306ed09daaa",
          "sha256": "f85e88af6bde66e9082a8655401f6c263665f13a8e526c1a436e4968ecbc0956"
        },
        "downloads": -1,
        "filename": "django-test-data-migrations-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "3ff7316bd2a7cd03e7fde306ed09daaa",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6,<4.0",
        "size": 3506,
        "upload_time": "2020-11-28T05:39:53",
        "upload_time_iso_8601": "2020-11-28T05:39:53.075518Z",
        "url": "https://files.pythonhosted.org/packages/af/78/a7c23976e38bf53ec37309041461b3c6ebb8d46c812877310f30c9b17cc5/django-test-data-migrations-0.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "ca6fbad5d9321bd8dc0f6a2e3c09d2c2ac15c50847005bbfaa00464c0c5aff55",
          "md5": "dfc0a98d4cbfa2a19ec8722b810652ca",
          "sha256": "eb0b6369024eb702cc63e5fd98d05f6899aa3aebec51967b9d6770818bf74005"
        },
        "downloads": -1,
        "filename": "django_test_data_migrations-0.1.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "dfc0a98d4cbfa2a19ec8722b810652ca",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6,<4.0",
        "size": 3367,
        "upload_time": "2020-11-28T05:44:45",
        "upload_time_iso_8601": "2020-11-28T05:44:45.192994Z",
        "url": "https://files.pythonhosted.org/packages/ca/6f/bad5d9321bd8dc0f6a2e3c09d2c2ac15c50847005bbfaa00464c0c5aff55/django_test_data_migrations-0.1.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "f029e84b60105f24df682537c46b850cc9f19137ea124fa55cb49ce1d4c52ffe",
          "md5": "ca3d7abdc4b05ad01101ea93188f3dfd",
          "sha256": "4d4bacdda4cc9258a9fab9710fb4e6a30e27229b837efcd8be98559b29e2689a"
        },
        "downloads": -1,
        "filename": "django-test-data-migrations-0.1.1.tar.gz",
        "has_sig": false,
        "md5_digest": "ca3d7abdc4b05ad01101ea93188f3dfd",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6,<4.0",
        "size": 3554,
        "upload_time": "2020-11-28T05:44:46",
        "upload_time_iso_8601": "2020-11-28T05:44:46.361908Z",
        "url": "https://files.pythonhosted.org/packages/f0/29/e84b60105f24df682537c46b850cc9f19137ea124fa55cb49ce1d4c52ffe/django-test-data-migrations-0.1.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "f41833062bbd18a62324bfdd59b472bc56eb95c714ac4ce80ca2ab6b24ed351d",
          "md5": "e955efda872e2e19bf8965f88b853a88",
          "sha256": "a1d8d270c26c2fb319877eb62646fd582e45a0bc6412729f45873a0fce371c76"
        },
        "downloads": -1,
        "filename": "django_test_data_migrations-0.1.2-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "e955efda872e2e19bf8965f88b853a88",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.6,<4.0",
        "size": 4677,
        "upload_time": "2020-12-20T03:35:18",
        "upload_time_iso_8601": "2020-12-20T03:35:18.282563Z",
        "url": "https://files.pythonhosted.org/packages/f4/18/33062bbd18a62324bfdd59b472bc56eb95c714ac4ce80ca2ab6b24ed351d/django_test_data_migrations-0.1.2-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "81bb2bd7f23f28fa0a0fa88432aff3650819727cc722f78852a5d8fcaf920c8a",
          "md5": "aa06ad5048ae606286ba165fa568e745",
          "sha256": "4d02a14c8d44c9f111021b224d0e8463d06d8168db066ad3df6fc2d3eae6c47a"
        },
        "downloads": -1,
        "filename": "django-test-data-migrations-0.1.2.tar.gz",
        "has_sig": false,
        "md5_digest": "aa06ad5048ae606286ba165fa568e745",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.6,<4.0",
        "size": 4512,
        "upload_time": "2020-12-20T03:35:19",
        "upload_time_iso_8601": "2020-12-20T03:35:19.303634Z",
        "url": "https://files.pythonhosted.org/packages/81/bb/2bd7f23f28fa0a0fa88432aff3650819727cc722f78852a5d8fcaf920c8a/django-test-data-migrations-0.1.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "f41833062bbd18a62324bfdd59b472bc56eb95c714ac4ce80ca2ab6b24ed351d",
        "md5": "e955efda872e2e19bf8965f88b853a88",
        "sha256": "a1d8d270c26c2fb319877eb62646fd582e45a0bc6412729f45873a0fce371c76"
      },
      "downloads": -1,
      "filename": "django_test_data_migrations-0.1.2-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "e955efda872e2e19bf8965f88b853a88",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.6,<4.0",
      "size": 4677,
      "upload_time": "2020-12-20T03:35:18",
      "upload_time_iso_8601": "2020-12-20T03:35:18.282563Z",
      "url": "https://files.pythonhosted.org/packages/f4/18/33062bbd18a62324bfdd59b472bc56eb95c714ac4ce80ca2ab6b24ed351d/django_test_data_migrations-0.1.2-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "81bb2bd7f23f28fa0a0fa88432aff3650819727cc722f78852a5d8fcaf920c8a",
        "md5": "aa06ad5048ae606286ba165fa568e745",
        "sha256": "4d02a14c8d44c9f111021b224d0e8463d06d8168db066ad3df6fc2d3eae6c47a"
      },
      "downloads": -1,
      "filename": "django-test-data-migrations-0.1.2.tar.gz",
      "has_sig": false,
      "md5_digest": "aa06ad5048ae606286ba165fa568e745",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.6,<4.0",
      "size": 4512,
      "upload_time": "2020-12-20T03:35:19",
      "upload_time_iso_8601": "2020-12-20T03:35:19.303634Z",
      "url": "https://files.pythonhosted.org/packages/81/bb/2bd7f23f28fa0a0fa88432aff3650819727cc722f78852a5d8fcaf920c8a/django-test-data-migrations-0.1.2.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}