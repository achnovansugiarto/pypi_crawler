{
  "info": {
    "author": "Radovan Bast",
    "author_email": "radovan.bast@uit.no",
    "bugtrack_url": null,
    "classifiers": [
      "License :: OSI Approved :: GNU General Public License v3 (GPLv3)"
    ],
    "description": ".. image:: https://github.com/NordicHPC/sonar/workflows/Test/badge.svg\n   :target: https://github.com/NordicHPC/sonar/actions\n.. image:: https://img.shields.io/badge/license-%20GPL--v3.0-blue.svg\n   :target: LICENSE\n.. image:: https://badge.fury.io/py/sonar.svg\n   :target: https://badge.fury.io/py/sonar\n\n\nsonar\n=====\n\nTool to profile usage of HPC resources by regularly probing processes\nusing ``ps``.\n\n.. contents:: Table of contents\n\n\nOverview\n--------\n\nThe code can do two things: take snapshots (``sonar probe``, typically every 20\nminutes or so), and map them (``sonar map``, whenever you like) to\napplications/projects/users::\n\n  $ sonar --help\n\n  usage: sonar [-h]  ...\n\n  Tool to profile usage of HPC resources by regularly probing processes using ps.\n\n  optional arguments:\n    -h, --help  show this help message and exit\n\n  Subcommands:\n\n      probe     Take a snapshot of the system. Run this on every node and often\n                (e.g. every 20 minutes).\n      map       Parse the system snapshots and map applications. Run this only\n                once centrally and typically once a day.\n\n  Run sonar <subcommand> -h to get more information about subcommands.\n\n\nSimilar and related tools\n-------------------------\n\n-  Reference implementation which serves as inspiration:\n   https://github.com/UNINETTSigma2/appusage\n-  `TACC Stats <https://github.com/TACC/tacc_stats>`__\n-  `sonar-web <https://github.com/NordicHPC/sonar-web>`__: Plots\n   daily/weekly/monthly CPU usage summary for clusters.\n\n\nAuthors\n-------\n\n-  Henrik Rojas Nagel\n-  Mathias Bockwoldt\n-  `Radovan Bast <https://bast.fr>`__\n\n\nDesign goals and design decisions\n---------------------------------\n\n- Pip installable\n- Minimal overhead for recording\n- Super quick reporting and dashboard, both stdout and csv for web\n  postprocessing\n- Can be used as health check tool\n\nWhy ``ps`` instead of ``top``?\nWe started using ``top`` but it turned out that ``top`` is dependent on\nlocale, so it displays floats with comma instead of decimal point in\nmany non-English locales. ``ps`` always uses decimal points. In\naddition, ``ps`` is (arguably) more versatile/configurable and does not\nprint the header that ``top`` prints. All these properties make the\n``ps`` output easier to parse than the ``top`` output.\n\n\nInstallation\n------------\n\nIdeally install into a virtual environment::\n\n  $ pip install sonar\n\nIf you develop sonar, you can install like this::\n\n  $ git clone https://github.com/nordichpc/sonar.git\n  $ cd sonar\n  $ virtualenv venv\n  $ source venv/bin/activate\n  $ pip install -r requirements.txt\n  $ flit install --symlink\n\n\nHow to analyze sonar logs\n-------------------------\n\nFor this run ``sonar map`` which will go through the logs,\nand map processes to applications::\n\n  $ sonar map --input-dir /home/user/folder/with/logs\n\nBy default you will see data for the past 7 days. But you can change this::\n\n  $ sonar map --input-dir /home/user/folder/with/logs --num-days 300\n\nSonar uses the following mapping files: https://github.com/nordichpc/sonar/tree/main/sonar/mapping\n\nThe mapping files (`string_map.txt` and `regex_map.txt`) contain a space-separated\n(does not matter how many spaces) mapping from process to application.\n\nYou can use your own mapping files instead::\n\n  $ sonar map --input-dir /home/user/folder/with/logs \\\n              --str-map-file /home/user/my-own-mapping/string_map.txt \\\n              --re-map-file /home/user/my-own-mapping/regex_map.txt\n\nYou are welcome to use your own but encouraged to contribute mappings to\nhttps://github.com/nordichpc/sonar/tree/main/sonar/mapping.\n\nYou can also export daily, weekly, and monthly CPU load percentages in CSV format for further postprocessing, e.g.\nusing https://github.com/NordicHPC/sonar-web::\n\n  $ sonar map --input-dir /home/user/folder/with/logs --export-csv daily\n  $ sonar map --input-dir /home/user/folder/with/logs --export-csv weekly --num-days 200\n\n\nTaking snapshots with sonar probe\n---------------------------------\n\nThis is me running `sonar probe` on a compute node::\n\n  $ sonar probe --output-delimiter \",\"\n\n  2019-05-10T17:11:34.585859+0200,c10-4,16,me,sonar,31.0,0,-,-,-,-\n  2019-05-10T17:11:34.585859+0200,c10-4,16,somebody,vasp.5.3.5,1506.4,5151,someproject,1598301,64,2000M\n\nThe columns are:\n- time stamp\n- hostname\n- number of cores on this node\n- user\n- process\n- CPU percentage (this is a 20-core node)\n- memory used in MB\n- Slurm project\n- Slurm job ID\n- Number of CPUs requested by the job\n- Minimum size of memory requested by the job\n\nBy default they are tab-separated but here I chose to display the result\ncomma-separated. You can also change cutoffs or ignore users to not measure the tool\nitself (``sonar probe --help``).\n\nIt can be useful to redirect the result to a file::\n\n  $ sonar probe >> /home/user/tmp/example.tsv\n\nThis is how it looks when I run ``sonar probe`` on my laptop (without Slurm)::\n\n  $ sonar probe --output-delimiter \",\"\n\n  2019-05-11T14:54:16.940502+0200,laptop,4,root,Xorg,0.7,47,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,gnome-shell,0.7,188,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,pulseaudio,0.6,7,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,chromium,16.9,3283,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,fish,0.5,23,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,vim,0.6,7,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,sonar,23.0,23,-,-,-,-\n  2019-05-11T14:54:16.940502+0200,laptop,4,me,gnome-terminal-,0.9,47,-,-,-,-\n\n\nRunning sonar probe on a cluster\n--------------------------------\n\nWe let cron execute a script every 20 minutes::\n\n  10,30,50 * * * * /global/work/sonar/sonar/cron-sonar.sh\n\nThe script ``cron-sonar.sh`` creates a list of active nodes and executes\n``run-probe.sh`` on all of these nodes::\n\n  #!/bin/bash\n\n  SONAR_ROOT=\"/global/work/sonar\"\n\n  # get list of all available nodes\n  /usr/bin/sinfo -h -r -o '%n' > ${SONAR_ROOT}/tmp/list-of-nodes 2> ${SONAR_ROOT}/tmp/list-of-nodes.err\n\n  # run sonar probe on all available nodes\n  /usr/bin/pdsh -w \\^${SONAR_ROOT}/tmp/list-of-nodes ${SONAR_ROOT}/sonar/run-probe.sh >> ${SONAR_ROOT}/tmp/pdsh.log 2>> ${SONAR_ROOT}/tmp/pdsh.err\n\n\nIn ``run-probe.sh`` we load the Python environment and wrap around ``sonar probe``::\n\n  #!/usr/bin/env bash\n\n  source /global/work/sonar/python/environment\n  pyenv shell 3.6.7\n\n  source /global/work/sonar/sonar/venv/bin/activate\n  current_year=$(date +'%Y')\n  mkdir -p /global/work/sonar/probe-outputs/${current_year}\n  sonar probe --ignored-users root >> /global/work/sonar/probe-outputs/${current_year}/${HOSTNAME}.tsv\n\nThis produces ca. 10 MB data per day.\n",
    "description_content_type": "text/x-rst",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/NordicHPC/sonar",
    "keywords": "",
    "license": "",
    "maintainer": "",
    "maintainer_email": "",
    "name": "sonar",
    "package_url": "https://pypi.org/project/sonar/",
    "platform": "",
    "project_url": "https://pypi.org/project/sonar/",
    "project_urls": {
      "Homepage": "https://github.com/NordicHPC/sonar"
    },
    "release_url": "https://pypi.org/project/sonar/0.5.0/",
    "requires_dist": [
      "tqdm"
    ],
    "requires_python": "",
    "summary": "Sonar: Tool to profile usage of HPC resources by regularly probing processes",
    "version": "0.5.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 12810222,
  "releases": {
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "250b0f3f068d6af60faa42f248dac8418e4fa4d3b6c324206ebe6abf5d87f9be",
          "md5": "ec29395562b4e64a6fb3b003efdb6f16",
          "sha256": "d63a93a47d48b4c155577dd6cb1bc0a6aad1bed7d707e07d23ef9f39905e0e61"
        },
        "downloads": -1,
        "filename": "sonar-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "ec29395562b4e64a6fb3b003efdb6f16",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 7306,
        "upload_time": "2019-05-11T12:24:50",
        "upload_time_iso_8601": "2019-05-11T12:24:50.191673Z",
        "url": "https://files.pythonhosted.org/packages/25/0b/0f3f068d6af60faa42f248dac8418e4fa4d3b6c324206ebe6abf5d87f9be/sonar-0.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.2.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "8b984a915313b45b0ada71b954d052d7bd5f4e96075a0a9881bc66ff322901b1",
          "md5": "bf18b08dd872dd5d6598ccdc4637778d",
          "sha256": "279b7be38fac461297d148d1598528b135f14bb293196de1cf349865923e2497"
        },
        "downloads": -1,
        "filename": "sonar-0.2.0.tar.gz",
        "has_sig": false,
        "md5_digest": "bf18b08dd872dd5d6598ccdc4637778d",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 8692,
        "upload_time": "2019-05-21T15:39:54",
        "upload_time_iso_8601": "2019-05-21T15:39:54.226811Z",
        "url": "https://files.pythonhosted.org/packages/8b/98/4a915313b45b0ada71b954d052d7bd5f4e96075a0a9881bc66ff322901b1/sonar-0.2.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.3.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "fdba754dd386eba800e17740e7c52cd9b746fd709937208dcc5e9fda094c2bc8",
          "md5": "6cadce0617f54895de83202fabd6defe",
          "sha256": "f736fac5eb996a191d94fdf8ff1cbd5eee06dc46170492ed6002799692f098d6"
        },
        "downloads": -1,
        "filename": "sonar-0.3.0.tar.gz",
        "has_sig": false,
        "md5_digest": "6cadce0617f54895de83202fabd6defe",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 9481,
        "upload_time": "2019-07-05T09:53:10",
        "upload_time_iso_8601": "2019-07-05T09:53:10.550784Z",
        "url": "https://files.pythonhosted.org/packages/fd/ba/754dd386eba800e17740e7c52cd9b746fd709937208dcc5e9fda094c2bc8/sonar-0.3.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.4.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "ef557dd49705d79e1a7c7d479c0990d466384953fda5c8cbcfca1e8a52b53a8b",
          "md5": "5a7b6f08c44e51b84b2b12ef38afd5df",
          "sha256": "4425591c075a833409ab5ac63800c334423b5a3891d566a7e5cdf9ad28b9a8ea"
        },
        "downloads": -1,
        "filename": "sonar-0.4.0.tar.gz",
        "has_sig": false,
        "md5_digest": "5a7b6f08c44e51b84b2b12ef38afd5df",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 10290,
        "upload_time": "2019-08-05T14:27:19",
        "upload_time_iso_8601": "2019-08-05T14:27:19.118784Z",
        "url": "https://files.pythonhosted.org/packages/ef/55/7dd49705d79e1a7c7d479c0990d466384953fda5c8cbcfca1e8a52b53a8b/sonar-0.4.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.4.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "36caa893a1bcce75ce3d63d1e528c4935c56da9a8284c65b8ae3a502c756306b",
          "md5": "7fb57475a833ae114feacf11c49e16ae",
          "sha256": "7d1ec53b2f4b870a2b6edc87eb95741e8121ba2f99731cc82d156b1a6e800e46"
        },
        "downloads": -1,
        "filename": "sonar-0.4.1.tar.gz",
        "has_sig": false,
        "md5_digest": "7fb57475a833ae114feacf11c49e16ae",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 10401,
        "upload_time": "2020-03-06T16:06:30",
        "upload_time_iso_8601": "2020-03-06T16:06:30.269853Z",
        "url": "https://files.pythonhosted.org/packages/36/ca/a893a1bcce75ce3d63d1e528c4935c56da9a8284c65b8ae3a502c756306b/sonar-0.4.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.4.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "a81df48f5efb16736110e59e36de9c03d57ffd6cd8407923f5b6836907bc8565",
          "md5": "44e6cb4bab97e3d79e575561da41e6ad",
          "sha256": "06f820c9f70dca662723273aeb3865b8685002e77c6fb101a8474abf7369bc55"
        },
        "downloads": -1,
        "filename": "sonar-0.4.2.tar.gz",
        "has_sig": false,
        "md5_digest": "44e6cb4bab97e3d79e575561da41e6ad",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 11004,
        "upload_time": "2020-04-16T16:10:48",
        "upload_time_iso_8601": "2020-04-16T16:10:48.550367Z",
        "url": "https://files.pythonhosted.org/packages/a8/1d/f48f5efb16736110e59e36de9c03d57ffd6cd8407923f5b6836907bc8565/sonar-0.4.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.4.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "ec1c1754004a7400ff9481a37c7dd2431c0287b8afd4adbf78e0873dcfe291c5",
          "md5": "d79ec4dfca3846c9350413b5f90032bd",
          "sha256": "0a81e8f48a5b9b59a6806a5655e4e0d5ebfbf9554c9dbf5a0a128dae85b7092a"
        },
        "downloads": -1,
        "filename": "sonar-0.4.3-py2.py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "d79ec4dfca3846c9350413b5f90032bd",
        "packagetype": "bdist_wheel",
        "python_version": "py2.py3",
        "requires_python": null,
        "size": 25443,
        "upload_time": "2020-06-18T10:51:35",
        "upload_time_iso_8601": "2020-06-18T10:51:35.848097Z",
        "url": "https://files.pythonhosted.org/packages/ec/1c/1754004a7400ff9481a37c7dd2431c0287b8afd4adbf78e0873dcfe291c5/sonar-0.4.3-py2.py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "a66df397e2e9be85adb0e55ecefbbcfddc682ccbfeeb3ad5611bf739813e4049",
          "md5": "8034dfda5cbece9833be508ffecd3012",
          "sha256": "cdafec12ab2d925a7372200240d270b7da42ccc6caaa7fc9382998785e00353e"
        },
        "downloads": -1,
        "filename": "sonar-0.4.3.tar.gz",
        "has_sig": false,
        "md5_digest": "8034dfda5cbece9833be508ffecd3012",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 23911,
        "upload_time": "2020-06-18T10:51:36",
        "upload_time_iso_8601": "2020-06-18T10:51:36.833893Z",
        "url": "https://files.pythonhosted.org/packages/a6/6d/f397e2e9be85adb0e55ecefbbcfddc682ccbfeeb3ad5611bf739813e4049/sonar-0.4.3.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.4.4": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "9ce34f94f6190bbb3d5e0ab82066df2a4f44eb8e136bb195bb90ab8feb8b22f9",
          "md5": "4c964dfd3bcecb885cc63facf9b30c57",
          "sha256": "39581b260658e5a9890020eecc9d8f4e7f4334c2ca3ad3cd35bdd76582f4cf9f"
        },
        "downloads": -1,
        "filename": "sonar-0.4.4-py2.py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "4c964dfd3bcecb885cc63facf9b30c57",
        "packagetype": "bdist_wheel",
        "python_version": "py2.py3",
        "requires_python": null,
        "size": 25450,
        "upload_time": "2020-07-08T11:10:35",
        "upload_time_iso_8601": "2020-07-08T11:10:35.080696Z",
        "url": "https://files.pythonhosted.org/packages/9c/e3/4f94f6190bbb3d5e0ab82066df2a4f44eb8e136bb195bb90ab8feb8b22f9/sonar-0.4.4-py2.py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "32db4202f8b179f85c46a4bdec170909d225e72f0f3c6f68dff86c2c81677a8d",
          "md5": "21742129e19a58cea85ec0a7e01e368e",
          "sha256": "7d26cf97b7d53e598ae1a440c00191fd046663a5d52c8a596b47bf8fe158ceb2"
        },
        "downloads": -1,
        "filename": "sonar-0.4.4.tar.gz",
        "has_sig": false,
        "md5_digest": "21742129e19a58cea85ec0a7e01e368e",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 23916,
        "upload_time": "2020-07-08T11:10:35",
        "upload_time_iso_8601": "2020-07-08T11:10:35.987392Z",
        "url": "https://files.pythonhosted.org/packages/32/db/4202f8b179f85c46a4bdec170909d225e72f0f3c6f68dff86c2c81677a8d/sonar-0.4.4.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.5.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "8d638a01cac516f59d486234228d2cdc57867ea57281560eefca3d00c80b78b9",
          "md5": "306adb4dfd9e3724a832dd6b7cb5cc0c",
          "sha256": "3e32f72f12fff68cddf4b4935c4e874e72ca4d482e60bcac18d83918b872147a"
        },
        "downloads": -1,
        "filename": "sonar-0.5.0-py2.py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "306adb4dfd9e3724a832dd6b7cb5cc0c",
        "packagetype": "bdist_wheel",
        "python_version": "py2.py3",
        "requires_python": null,
        "size": 25464,
        "upload_time": "2022-02-07T08:38:00",
        "upload_time_iso_8601": "2022-02-07T08:38:00.986601Z",
        "url": "https://files.pythonhosted.org/packages/8d/63/8a01cac516f59d486234228d2cdc57867ea57281560eefca3d00c80b78b9/sonar-0.5.0-py2.py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "7777a43721335d6dba06923e4d995d9ba7426005c1d2f4ddac1f873cf87d2552",
          "md5": "80e5b3c11458ff5734a26a4d291d8533",
          "sha256": "4e2ca5c2b8bbfb9000332a7662ce858947876bde2c3b7ce807fbb55a7c7c9107"
        },
        "downloads": -1,
        "filename": "sonar-0.5.0.tar.gz",
        "has_sig": false,
        "md5_digest": "80e5b3c11458ff5734a26a4d291d8533",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 26118,
        "upload_time": "2022-02-07T08:38:02",
        "upload_time_iso_8601": "2022-02-07T08:38:02.523641Z",
        "url": "https://files.pythonhosted.org/packages/77/77/a43721335d6dba06923e4d995d9ba7426005c1d2f4ddac1f873cf87d2552/sonar-0.5.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "8d638a01cac516f59d486234228d2cdc57867ea57281560eefca3d00c80b78b9",
        "md5": "306adb4dfd9e3724a832dd6b7cb5cc0c",
        "sha256": "3e32f72f12fff68cddf4b4935c4e874e72ca4d482e60bcac18d83918b872147a"
      },
      "downloads": -1,
      "filename": "sonar-0.5.0-py2.py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "306adb4dfd9e3724a832dd6b7cb5cc0c",
      "packagetype": "bdist_wheel",
      "python_version": "py2.py3",
      "requires_python": null,
      "size": 25464,
      "upload_time": "2022-02-07T08:38:00",
      "upload_time_iso_8601": "2022-02-07T08:38:00.986601Z",
      "url": "https://files.pythonhosted.org/packages/8d/63/8a01cac516f59d486234228d2cdc57867ea57281560eefca3d00c80b78b9/sonar-0.5.0-py2.py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "7777a43721335d6dba06923e4d995d9ba7426005c1d2f4ddac1f873cf87d2552",
        "md5": "80e5b3c11458ff5734a26a4d291d8533",
        "sha256": "4e2ca5c2b8bbfb9000332a7662ce858947876bde2c3b7ce807fbb55a7c7c9107"
      },
      "downloads": -1,
      "filename": "sonar-0.5.0.tar.gz",
      "has_sig": false,
      "md5_digest": "80e5b3c11458ff5734a26a4d291d8533",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": null,
      "size": 26118,
      "upload_time": "2022-02-07T08:38:02",
      "upload_time_iso_8601": "2022-02-07T08:38:02.523641Z",
      "url": "https://files.pythonhosted.org/packages/77/77/a43721335d6dba06923e4d995d9ba7426005c1d2f4ddac1f873cf87d2552/sonar-0.5.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}