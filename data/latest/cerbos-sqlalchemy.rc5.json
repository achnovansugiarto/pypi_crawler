{
  "info": {
    "author": "",
    "author_email": "Cerbos Developers <sdk+sqlalchemy@cerbos.dev>",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 4 - Beta",
      "Intended Audience :: Developers",
      "Topic :: Security",
      "Topic :: Software Development :: Libraries"
    ],
    "description": "# Cerbos + SQLAlchemy Adapter\n\nAn adapter library that takes a [Cerbos](https://cerbos.dev) Query Plan ([PlanResources API](https://docs.cerbos.dev/cerbos/latest/api/index.html#resources-query-plan)) response and converts it into a [SQLAlchemy](https://docs.sqlalchemy.org/en/14/) Select instance. This is designed to work alongside a project using the [Cerbos Python SDK](https://github.com/cerbos/cerbos-sdk-python).\n\nThe following conditions are supported: `and`, `or`, `not`, `eq`, `ne`, `lt`, `gt`, `le` (`lte`), `ge` (`gte`) and `in`. Other operators (eg math operators) can be implemented programatically, and attached to the query object via the `query.where(...)` API.\n\n## Requirements\n- Cerbos > v0.16\n- SQLAlchemy >= 1.4 / 2.0\n\n## Usage\n\n```\npip install cerbos-sqlalchemy\n```\n\n```python\nfrom cerbos.sdk.client import CerbosClient\nfrom cerbos.sdk.model import Principal, ResourceDesc\n\nfrom cerbos_sqlalchemy import get_query\nfrom sqlalchemy import Column, Integer, String\nfrom sqlalchemy.orm import declarative_base\nfrom sqlalchemy.sql import Select\n\nBase = declarative_base()\n\n\nclass LeaveRequest(Base):\n    __tablename__ = \"leave_request\"\n\n    id = Column(Integer, primary_key=True)\n    department = Column(String(225))\n    geography = Column(String(225))\n    team = Column(String(225))\n    priority = Column(Integer)\n\n\nwith CerbosClient(host=\"http://localhost:3592\") as c:\n    p = Principal(\n        \"john\",\n        roles={\"employee\"},\n        policy_version=\"20210210\",\n        attr={\"department\": \"marketing\", \"geography\": \"GB\", \"team\": \"design\"},\n    )\n\n    # Get the query plan for \"view\" action\n    rd = ResourceDesc(\"leave_request\", policy_version=\"20210210\")\n    plan = c.plan_resources(\"view\", p, rd)\n\n\n# the attr_map arg of get_query expects a map[string, InstrumentedAttribute | Column], with cerbos attribute strings mapped to the column/attr instances\nattr_map = {\n    \"request.resource.attr.department\": LeaveRequest.department,  # LeaveRequest.__table__.c.department is also allowed\n    \"request.resource.attr.geography\": LeaveRequest.geography,\n    \"request.resource.attr.team\": LeaveRequest.team,\n    \"request.resource.attr.priority\": LeaveRequest.priority,\n}\n\n\n# `get_query` supports both `Table` instances and ORM entities:\n# ORM entity - honouring object level relationships via the sqlalchemy ORM\nquery: Select = get_query(plan, LeaveRequest, attr_map)\n# Alternatively it can generate legacy queries by passing the Table instance\nquery: Select = get_query(plan, LeaveRequest.__table__, attr_map)\n\n\n# NOTE: if columns defined within the attr_map originate from more than one table, we need to define a mapping as the optional 4th positional arg to `get_query`.\n# The argument is in the form:\n#   `list[tuple[Table | DeclarativeMeta, BinaryExpression | ColumnOperators]]`\n# e.g.:\nquery: Select = get_query(\n    plan,\n    Table1,\n    {\n        \"request.resource.attr.foo\": Table1.foo,  # or `Table1.__table__.c.foo`\n        \"request.resource.attr.bar\": Table2.bar,\n        \"request.resource.attr.bosh\": Table3.bosh,\n    },\n    [\n        (Table2, Table1.table2_id == Table2.id),  # or (Table2.__table__, Table1.__table__.c.table2_id == Table2.__table__.c.id)\n        (Table3, Table1.table3_id == Table3.id),\n    ]\n)\n\n\n# optionally extend the query\nquery = query.where(LeaveRequest.priority < 5)\n\n# or return a subset of the selected columns (via a new `select`)\n# NOTE: this is wise to do as standard, to avoid implicit joins generated by sqla `relationship()` usage, if present\nquery = query.with_only_columns(\n    LeaveRequest.department,\n    LeaveRequest.geography,\n)\n\n# Print the compiled query (for debug purposes)\nprint(query.compile(compile_kwargs={\"literal_binds\": True}))\n```\n\n### Overriding default predicates\n\nBy default, the library provides a base set of operators which are widely supported across a range of SQL dialects. However, in some cases, users may wish to override a particular operator for a more idiomatic/optimised alternative for a given database. An example of this could be postgres users preferring to use `= ANY` over `IN`:\n\n```python\nfrom sqlalchemy.sql.expression import any_\n\nquery = get_query(\n    plan_resource_resp,\n    some_table,\n    attr_map={\n        \"request.resource.attr.foo\": Table1.foo,\n    },\n    # override handler functions in the map below\n    operator_override_fns={\n        \"in\": lambda c, v: c == any_(v),\n    },\n)\n```\n\nThe types are as follows:\n\n```python\nfrom sqlalchemy import Column\nfrom sqlalchemy.orm import InstrumentedAttribute\nfrom sqlalchemy.sql.expression import BinaryExpression, ColumnOperators\n\nGenericColumn = Column | InstrumentedAttribute\nGenericExpression = BinaryExpression | ColumnOperators\n# and the actual map arg to `get_query` ⬇️\nOperatorFnMap = dict[str, Callable[[GenericColumn, Any], GenericExpression]]\n```\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "",
    "keywords": "",
    "license": "Apache-2.0",
    "maintainer": "",
    "maintainer_email": "",
    "name": "cerbos-sqlalchemy",
    "package_url": "https://pypi.org/project/cerbos-sqlalchemy/",
    "platform": null,
    "project_url": "https://pypi.org/project/cerbos-sqlalchemy/",
    "project_urls": {
      "Homepage": "https://cerbos.dev",
      "Repository": "https://github.com/cerbos/query-plan-adapters/tree/main/sqlalchemy"
    },
    "release_url": "https://pypi.org/project/cerbos-sqlalchemy/0.2.1/",
    "requires_dist": [
      "SQLAlchemy>=1.4.40",
      "cerbos>=0.4.0"
    ],
    "requires_python": ">=3.8",
    "summary": "SQLAlchemy adapter for generating queries with Cerbos: an open core, language-agnostic, scalable authorization solution",
    "version": "0.2.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 15437481,
  "releases": {
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "4198425b38373632456023ae5fab23c9d700cc055b2c2f9b5f9be3a244400232",
          "md5": "b087f28cbc51f0edb930c80780c47383",
          "sha256": "02cb34c0de53f7b17ca0bf59cd8545e9d376de86115316e618359d74fdec0ff9"
        },
        "downloads": -1,
        "filename": "cerbos_sqlalchemy-0.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "b087f28cbc51f0edb930c80780c47383",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 3331,
        "upload_time": "2022-08-23T13:05:30",
        "upload_time_iso_8601": "2022-08-23T13:05:30.639802Z",
        "url": "https://files.pythonhosted.org/packages/41/98/425b38373632456023ae5fab23c9d700cc055b2c2f9b5f9be3a244400232/cerbos_sqlalchemy-0.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "5976d91fe3a73984159eb81e26aa553d1a363e951374c681bd78eca7cfccb03d",
          "md5": "961b7df51266f2277137a86c09d27def",
          "sha256": "67aff88a7f6a79154d7a456eb09034c6236bcfb3bca9f21ca55ef30d573ca32a"
        },
        "downloads": -1,
        "filename": "cerbos-sqlalchemy-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "961b7df51266f2277137a86c09d27def",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 5031,
        "upload_time": "2022-08-23T13:05:32",
        "upload_time_iso_8601": "2022-08-23T13:05:32.123223Z",
        "url": "https://files.pythonhosted.org/packages/59/76/d91fe3a73984159eb81e26aa553d1a363e951374c681bd78eca7cfccb03d/cerbos-sqlalchemy-0.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.3": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "c94c994a52677286783dac3643f844effc45290b4db35a3e7ee477be4fd0677d",
          "md5": "dab7f6e43176cb77b423669a81697f34",
          "sha256": "fc2e33ae01cfb75e1fc50fd43b8eeca5ea0e6cd66d8ce7d8124bd2f8b3349aaa"
        },
        "downloads": -1,
        "filename": "cerbos_sqlalchemy-0.1.3-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "dab7f6e43176cb77b423669a81697f34",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 4367,
        "upload_time": "2022-09-15T07:28:46",
        "upload_time_iso_8601": "2022-09-15T07:28:46.798482Z",
        "url": "https://files.pythonhosted.org/packages/c9/4c/994a52677286783dac3643f844effc45290b4db35a3e7ee477be4fd0677d/cerbos_sqlalchemy-0.1.3-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "7e10f5df8064b0800ea3c038f69a113237e33baa06c8419d76838d27b54974ba",
          "md5": "7733c90207859a85a74682fc8db19d41",
          "sha256": "56f6f31fea180f75aec752e0f6fe0b21b2c02f02eeb9c62f29c59ff072dd0865"
        },
        "downloads": -1,
        "filename": "cerbos-sqlalchemy-0.1.3.tar.gz",
        "has_sig": false,
        "md5_digest": "7733c90207859a85a74682fc8db19d41",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 6561,
        "upload_time": "2022-09-15T07:28:48",
        "upload_time_iso_8601": "2022-09-15T07:28:48.292024Z",
        "url": "https://files.pythonhosted.org/packages/7e/10/f5df8064b0800ea3c038f69a113237e33baa06c8419d76838d27b54974ba/cerbos-sqlalchemy-0.1.3.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.4": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "b535d434ea0ff4784036ab3378390d366c1b5f57d86118c0e30983324758f81e",
          "md5": "bf3da17128186f44313942dd7da9985a",
          "sha256": "54b899ef8b98bf58ee33d59931d0da85b62b32bceacda0e38e1ccacb95b3d8af"
        },
        "downloads": -1,
        "filename": "cerbos_sqlalchemy-0.1.4-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "bf3da17128186f44313942dd7da9985a",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 4428,
        "upload_time": "2022-10-04T09:07:12",
        "upload_time_iso_8601": "2022-10-04T09:07:12.011448Z",
        "url": "https://files.pythonhosted.org/packages/b5/35/d434ea0ff4784036ab3378390d366c1b5f57d86118c0e30983324758f81e/cerbos_sqlalchemy-0.1.4-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "ae4b570095b7b661ca710421e5b0bf4d96102cf8837c034f738d950d1309a913",
          "md5": "966a550ae3d2a8dcc78e1a0ab2561253",
          "sha256": "8d721c2675821e6ad99e4def15ad2736e9c35f9ccd3257aabe0a195eeb9d7e8a"
        },
        "downloads": -1,
        "filename": "cerbos-sqlalchemy-0.1.4.tar.gz",
        "has_sig": false,
        "md5_digest": "966a550ae3d2a8dcc78e1a0ab2561253",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 6675,
        "upload_time": "2022-10-04T09:07:13",
        "upload_time_iso_8601": "2022-10-04T09:07:13.547811Z",
        "url": "https://files.pythonhosted.org/packages/ae/4b/570095b7b661ca710421e5b0bf4d96102cf8837c034f738d950d1309a913/cerbos-sqlalchemy-0.1.4.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.2.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "397daf2eaccab2ffa057bdacaf492daaa343a5ab93f64dbc74769553cfb46999",
          "md5": "476334d57a23f646162d33831faa7715",
          "sha256": "4793248dfab82fd8f75d6078ce3e4b1dacd1cf60b1d9817e8122908578fe7dbd"
        },
        "downloads": -1,
        "filename": "cerbos_sqlalchemy-0.2.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "476334d57a23f646162d33831faa7715",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 5350,
        "upload_time": "2022-10-12T14:00:31",
        "upload_time_iso_8601": "2022-10-12T14:00:31.459080Z",
        "url": "https://files.pythonhosted.org/packages/39/7d/af2eaccab2ffa057bdacaf492daaa343a5ab93f64dbc74769553cfb46999/cerbos_sqlalchemy-0.2.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "384da42ff61debd9d1c3467de75ec0b93cef403fecd2fd7951fc31c5b9f8a480",
          "md5": "b5ee4b63bfbaa4714074a8baca078df1",
          "sha256": "99abdfe46dd3fbe6c7e0d69b4b019c7af54ef81883ea5a55562225f9af335d30"
        },
        "downloads": -1,
        "filename": "cerbos-sqlalchemy-0.2.0.tar.gz",
        "has_sig": false,
        "md5_digest": "b5ee4b63bfbaa4714074a8baca078df1",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 8088,
        "upload_time": "2022-10-12T14:00:33",
        "upload_time_iso_8601": "2022-10-12T14:00:33.245622Z",
        "url": "https://files.pythonhosted.org/packages/38/4d/a42ff61debd9d1c3467de75ec0b93cef403fecd2fd7951fc31c5b9f8a480/cerbos-sqlalchemy-0.2.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.2.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "a24e1f2ab94d3e2da1249462d76bc69c29bf5ad7b031fd063a32e908d627df35",
          "md5": "a57b98f47102b4f0f44d2e443ea46262",
          "sha256": "108f00664509612a5f74439370f33a6d38cdbd842ef1a9915a3e3239b4bfacfd"
        },
        "downloads": -1,
        "filename": "cerbos_sqlalchemy-0.2.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "a57b98f47102b4f0f44d2e443ea46262",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": ">=3.8",
        "size": 5360,
        "upload_time": "2022-10-17T14:49:13",
        "upload_time_iso_8601": "2022-10-17T14:49:13.104197Z",
        "url": "https://files.pythonhosted.org/packages/a2/4e/1f2ab94d3e2da1249462d76bc69c29bf5ad7b031fd063a32e908d627df35/cerbos_sqlalchemy-0.2.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "e4355d09039c78c23824df8a50f8e102e91995990a394a1cb5bcf5e869865762",
          "md5": "ba2edda31fc26faef9959fc077352b00",
          "sha256": "dd232b373d949629a23496e3c7493c801f257483d1eca5f991f2f7fed40a35c1"
        },
        "downloads": -1,
        "filename": "cerbos-sqlalchemy-0.2.1.tar.gz",
        "has_sig": false,
        "md5_digest": "ba2edda31fc26faef9959fc077352b00",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": ">=3.8",
        "size": 8678,
        "upload_time": "2022-10-17T14:49:14",
        "upload_time_iso_8601": "2022-10-17T14:49:14.685718Z",
        "url": "https://files.pythonhosted.org/packages/e4/35/5d09039c78c23824df8a50f8e102e91995990a394a1cb5bcf5e869865762/cerbos-sqlalchemy-0.2.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "a24e1f2ab94d3e2da1249462d76bc69c29bf5ad7b031fd063a32e908d627df35",
        "md5": "a57b98f47102b4f0f44d2e443ea46262",
        "sha256": "108f00664509612a5f74439370f33a6d38cdbd842ef1a9915a3e3239b4bfacfd"
      },
      "downloads": -1,
      "filename": "cerbos_sqlalchemy-0.2.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "a57b98f47102b4f0f44d2e443ea46262",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.8",
      "size": 5360,
      "upload_time": "2022-10-17T14:49:13",
      "upload_time_iso_8601": "2022-10-17T14:49:13.104197Z",
      "url": "https://files.pythonhosted.org/packages/a2/4e/1f2ab94d3e2da1249462d76bc69c29bf5ad7b031fd063a32e908d627df35/cerbos_sqlalchemy-0.2.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "e4355d09039c78c23824df8a50f8e102e91995990a394a1cb5bcf5e869865762",
        "md5": "ba2edda31fc26faef9959fc077352b00",
        "sha256": "dd232b373d949629a23496e3c7493c801f257483d1eca5f991f2f7fed40a35c1"
      },
      "downloads": -1,
      "filename": "cerbos-sqlalchemy-0.2.1.tar.gz",
      "has_sig": false,
      "md5_digest": "ba2edda31fc26faef9959fc077352b00",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.8",
      "size": 8678,
      "upload_time": "2022-10-17T14:49:14",
      "upload_time_iso_8601": "2022-10-17T14:49:14.685718Z",
      "url": "https://files.pythonhosted.org/packages/e4/35/5d09039c78c23824df8a50f8e102e91995990a394a1cb5bcf5e869865762/cerbos-sqlalchemy-0.2.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}