{
  "info": {
    "author": "CorticoMetrics",
    "author_email": "ltirrell@corticometrics.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 2 - Pre-Alpha",
      "Natural Language :: English",
      "Programming Language :: Python :: 3"
    ],
    "description": "# fs2dicom\n`fs2dicom` is a tool to convert [FreeSurfer](https://surfer.nmr.mgh.harvard.edu/) outputs to DICOM.\n\nTwo subcommands are implemented: `create-seg` and `create-sr`, to produce [DICOM Segmentation Image objects](https://qiicr.gitbooks.io/dicom4qi/content/results/seg.html), and DICOM Structured Report objects, respectively. `aseg.stats` to `DICOM-SR` using [dcmqi](https://github.com/QIICR/dcmqi/).\n\nCurrently, only [`aseg.mgz`](http://surfer.nmr.mgh.harvard.edu/fswiki/SubcorticalSegmentation/) and `aseg.stats`  are supported and documented. Future versions may support other FreeSurfer segmentations and parcellations (such as thickness and volumes of different cortical regions)\n\n## Dependencies\n[dcmqi](https://github.com/QIICR/dcmqi) and [FreeSurfer](https://surfer.nmr.mgh.harvard.edu/fswiki/DownloadAndInstall) are required. Alternatively, instead of installing these programs locally, [Docker](https://docs.docker.com/install/) can be used instead to run the necessary commands. Using Docker is the default.\n\nNote: future updates should be able to remove the FreeSurfer dependency, and replace its functionality with python-based tools.\n\n## Installation\nClone the repo, cd into it, and run:\n```\npip install -e .\n```\nThis will install all python requirements needed to run `fs2dicom` (listed in `requirements.txt`). \n\n## Usage\n### `fs2dicom` base options\n```\nUsage: fs2dicom [OPTIONS] COMMAND [ARGS]...\n\n  Create DICOM Segmentation Image and Structured Report objects from\n  FreeSurfer segmentations.\n\n  Currently requires either docker OR FreeSurfer and dcmqi installed locally\n\n  Docker is the default way to run FreeSurfer and dcmqi commands needed to\n  create DICOM SEG/SR\n\n  A FreeSurfer License key is required to run the docker image. This can be\n  downloaded from: https://surfer.nmr.mgh.harvard.edu/registration.html\n\n  FreeSurfer commands are used to resample the aseg to native space Future\n  versions may remove this dependency\n\nOptions:\n  --dcmqi_type [docker|local]     Use docker or local installed version of\n                                  dcmqi (default: docker)\n  --dcmqi_docker_image TEXT       Name of the dcmqi docker image (default:\n                                  qiicr/dcmqi:latest)\n  --freesurfer_type [docker|local]\n                                  Use docker or local installed version of\n                                  freesurfer (default: docker)\n  --freesurfer_docker_image TEXT  Name of the FreeSurfer docker image.\n                                  Currently only supports\n                                  corticometrics/fs6-base (default:\n                                  corticometrics/fs6-base:latest)\n  --fs_license_key TEXT           Path to FreeSurfer License key file.\n                                  (default: path set by environment variable\n                                  FS_LICENSE_KEY)\n  -h, --help                      Show this message and exit.\n\nCommands:\n  create-seg  Creates a DICOM Segementation Image object ...\n  create-sr   Creates a DICOM Structured Report object...\n```\n### `create-seg` subcommand options\n```\nUsage: fs2dicom create-seg [OPTIONS] T1_DICOM_FILE ASEG_IMAGE_FILE\n                           [ASEG_DICOM_SEG_OUTPUT]\n\n  Creates a DICOM Segementation Image object from the T1_DICOM_FILE (one of\n  the T1w DICOM files processed with FreeSurfer) and ASEG_IMAGE_FILE, and\n  outputs to the ASEG_DICOM_SEG_OUTPUT file name (default: ./aseg.dcm)\n\nOptions:\n  --seg_metadata PATH  Path to the DICOM SEG metadata schema describing the\n                       aseg (default: provided within package)\n  -h, --help           Show this message and exit.\n```\n### `create-sr` subcommand options\n```\nUsage: fs2dicom create-sr [OPTIONS] T1_DICOM_FILE ASEG_STATS_FILE\n                          [ASEG_DICOM_SR_OUTPUT]\n\n  Creates a DICOM Structured Report object ASEG_DICOM_SR_OUTPUT (default:\n  ./aseg-sr.dcm) using the values from the ASEG_STATS_FILE created by\n  FreeSurfer. The T1_DICOM_FILE (one of the T1w DICOM files processed with\n  FreeSurfer) and aseg_dicom_seg_file (default: ./aseg.dcm, specified with\n  --aseg_dicom_seg_file) are needed to provide context for this DICOM SR.\n  sr_metadata_output is also created (default: ./fs-aseg-sr.json, specified\n  with --sr_metadata_output), containing the values used to create the DICOM\n  SR.\n\nOptions:\n  --aseg_dicom_seg_file PATH  DICOM SEG of the aseg, for example created by\n                              `fs2dicom create-seg` (default: ./aseg.dcm)\n  --sr_metadata_output PATH   JSON file output containing the values used to\n                              create the DICOM SR (default: ./fs-aseg-sr.json)\n  --seg_metadata PATH         Path to the DICOM SEG metadata schema describing\n                              the aseg (default: provided within package)\n  --sr_template PATH          Path to DICOM SR template that is filled in with\n                              aseg.stats values (default: provided within\n                              package)\n  -h, --help                  Show this message and exit.\n\n```\n\n## Descriptions of steps implemented by `fs2dicom`\nPreprocessing (not done by fs2dicom):\n - Run Freesurfer's [`recon-all`](https://surfer.nmr.mgh.harvard.edu/fswiki/ReconAllDevTable) on your input DICOM(s) to generate `aseg.mgz` and `aseg.stats`.\n\n### `aseg.mgz` to `DICOM-SEG`\n1. Call [`mri_vol2vol`](https://surfer.nmr.mgh.harvard.edu/fswiki/mri_vol2vol) from FreeSurfer to resample `aseg.mgz` from FreeSurfer space to the native space of the input T1 DICOM, and convert to nifti.\n```\nmri_vol2vol \\\n  --mov /path/to/aseg.mgz \\\n  --targ /path/to/t1/dicom/file \\\n  --regheader \\\n  --nearest \\\n  --o aseg_native.nii.gz\n```\n2. Use [`itkimage2segimage`](https://qiicr.gitbooks.io/dcmqi-guide/user_guide/itkimage2segimage.html) from [dmcqi](https://github.com/QIICR/dcmqi) to convert `aseg.nii.gz` to DICOM-SEG using [`fs-aseg.json`](fs2dicom/templates/fs-aseg.json) in this repo.\n```\nitkimage2segimage \\\n  --inputDICOMDirectory /path/to/t1/dicom/directory \\\n  --inputMetadata /path/to/fs2dicom/fs2dicom/templates/fs-aseg.json \\\n  --inputImageList aseg_native.nii.gz \\\n  --outputDICOM aseg.dcm\n  --skip\n```\n\n[`fs-aseg.json`](fs2dicom/templates/fs-aseg.json) maps [FreeSurfer aseg labels](https://surfer.nmr.mgh.harvard.edu/fswiki/FsTutorial/AnatomicalROI/FreeSurferColorLUT) to [SNOMED](https://www.snomed.org/) codes and preserves the FreeSurfer's recommended color scheme.\n\n`fs-aseg.json` has been kindly provided by [Emily Lindemer](https://www.linkedin.com/in/emily-lindemer-87206667/)\n\nSee the [DCMQI gitbook](https://qiicr.gitbooks.io/dicom4qi/results/seg/freesurfer.html) for details\n\n### `aseg.stats` to `DICOM-SR`\n1. Read the `aseg.stats` file into a `pandas` dataframe\n2. Fill in  the [`fs-aseg-sr-template.json`](fs2dicom/templates/fs-aseg-sr-template.json) `jinja2` template with:\n  - the T1 DICOM file list,\n  - the name of the aseg `DICOM SEG` file, and\n  - the volume values from the `aseg.stats` dataframe\n3. Create the `DICOM SR` file using `dcmqi`'s `tid1500writer`:\n```\ntid1500writer \\\n  --inputImageLibraryDirectory /path/to/t1/dicom/directory \\\n  --inputCompositeContextDirectory /path/to/aseg_dicom_seg/directory \\\n  --outputDICOM aseg-sr.dcm \\\n  --inputMetadata fs-aseg-sr.json  # created in previous step\n```\nMore information can be found here:\n- [`tid1500writer` user guide](https://qiicr.gitbooks.io/dcmqi-guide/user_guide/tid1500writer.html)\n- [example `--inputMetadata` json file](https://github.com/QIICR/dcmqi/blob/master/doc/examples/sr-tid1500-ct-liver-example.json)\n- [aseg-specific example `--inputMetadata` json file](examples/fs-aseg-sr.json)\n  - Subject-specific modifications\n    - `\"compositeContext\"` needs to point to DICOM-SEG object\n    - `\"imageLibrary\"` needs to point to list of source MPRAGE dicoms\n    - `\"Measurements\"->\"measurementItems\"-\"value\"` needs to be harvested from `aseg.stats`\n    - `\"Measurements\"->\"SourceSeriesForImageSegmentation\"` needs to be set to the DICOM \"Series Instance UID Attribute\" (0020,000E)\n\n\n",
    "description_content_type": "",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/corticometrics/fs2dicom",
    "keywords": "",
    "license": "BSD (3-clause)",
    "maintainer": "",
    "maintainer_email": "",
    "name": "fs2dicom",
    "package_url": "https://pypi.org/project/fs2dicom/",
    "platform": "",
    "project_url": "https://pypi.org/project/fs2dicom/",
    "project_urls": {
      "Homepage": "https://github.com/corticometrics/fs2dicom"
    },
    "release_url": "https://pypi.org/project/fs2dicom/0.1.2/",
    "requires_dist": [
      "click",
      "docker",
      "jinja2",
      "numpy",
      "pandas",
      "pydicom"
    ],
    "requires_python": "",
    "summary": "Create DICOM Segmentation Image and Structured Report objects from FreeSurfer segmentations",
    "version": "0.1.2",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 4531863,
  "releases": {
    "0.1.0": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3e290b1d548ad15e18355388a5de880560b4102b6abee30a4fd9bf2f486db4c4",
          "md5": "561460087c2aa940d3b0eea769ac6cc1",
          "sha256": "cce778d50283a812c01574610f8d716b68a16d0de20129902d4deb329f66c652"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.0-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "561460087c2aa940d3b0eea769ac6cc1",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": null,
        "size": 14631,
        "upload_time": "2018-11-17T00:55:16",
        "upload_time_iso_8601": "2018-11-17T00:55:16.490963Z",
        "url": "https://files.pythonhosted.org/packages/3e/29/0b1d548ad15e18355388a5de880560b4102b6abee30a4fd9bf2f486db4c4/fs2dicom-0.1.0-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "f9973010f1b20e811db135241af2a2619df7b584a32701316220e4ddc773a837",
          "md5": "c32cad446c9b281c81286b2015338e4c",
          "sha256": "2a715903fcab8db6da2adea428987d65b4d198d7a445a10a6cb6731c52e048e1"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.0.tar.gz",
        "has_sig": false,
        "md5_digest": "c32cad446c9b281c81286b2015338e4c",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 31375,
        "upload_time": "2018-11-17T00:55:18",
        "upload_time_iso_8601": "2018-11-17T00:55:18.342079Z",
        "url": "https://files.pythonhosted.org/packages/f9/97/3010f1b20e811db135241af2a2619df7b584a32701316220e4ddc773a837/fs2dicom-0.1.0.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.1": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "2a2d673708a0f20e348ceb9dedc0fecb81dbcc169321028f0c2e1137db52e373",
          "md5": "ac26f9dd4d7351b0cfde2ee1179ee64f",
          "sha256": "a005794b085f108bd5fa66bc175a2eb278c676209f2df22618f327813dc827d0"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.1-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "ac26f9dd4d7351b0cfde2ee1179ee64f",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": null,
        "size": 14623,
        "upload_time": "2018-11-21T04:57:49",
        "upload_time_iso_8601": "2018-11-21T04:57:49.126789Z",
        "url": "https://files.pythonhosted.org/packages/2a/2d/673708a0f20e348ceb9dedc0fecb81dbcc169321028f0c2e1137db52e373/fs2dicom-0.1.1-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "3ec95042946ab22d3b4a3174a40f2c414703da40fb0e368e1c66593437f28d99",
          "md5": "05394d4219b510cfa2b8032e8b7e35cf",
          "sha256": "b0a347815cc51d513ef5390308cb56026122d1c2553523d667ae259c02ae1d52"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.1.tar.gz",
        "has_sig": false,
        "md5_digest": "05394d4219b510cfa2b8032e8b7e35cf",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 31410,
        "upload_time": "2018-11-21T04:57:51",
        "upload_time_iso_8601": "2018-11-21T04:57:51.034865Z",
        "url": "https://files.pythonhosted.org/packages/3e/c9/5042946ab22d3b4a3174a40f2c414703da40fb0e368e1c66593437f28d99/fs2dicom-0.1.1.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ],
    "0.1.2": [
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "325f68e599e1f56d02466de0d8fa84b895849530e8a653180ae4f99ac8c15ad7",
          "md5": "fe1c7e70ccd1f0d4f9ad9868348fb5dd",
          "sha256": "564823f57e663ec33b622398de2bb8a44c388cd3097b0dd369c33f702502801b"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.2-py3-none-any.whl",
        "has_sig": false,
        "md5_digest": "fe1c7e70ccd1f0d4f9ad9868348fb5dd",
        "packagetype": "bdist_wheel",
        "python_version": "py3",
        "requires_python": null,
        "size": 14623,
        "upload_time": "2018-11-27T00:10:27",
        "upload_time_iso_8601": "2018-11-27T00:10:27.699405Z",
        "url": "https://files.pythonhosted.org/packages/32/5f/68e599e1f56d02466de0d8fa84b895849530e8a653180ae4f99ac8c15ad7/fs2dicom-0.1.2-py3-none-any.whl",
        "yanked": false,
        "yanked_reason": null
      },
      {
        "comment_text": "",
        "digests": {
          "blake2b_256": "49f96b892ea01df47659c32962defa29ebbecb293d197482b149339429ec11ad",
          "md5": "818c772aff6f3427c5b45e42320b5359",
          "sha256": "dfa30625196c42ce360d6a462c7ab8a5e0271f588fdf97c9a0e73e1dd20c1123"
        },
        "downloads": -1,
        "filename": "fs2dicom-0.1.2.tar.gz",
        "has_sig": false,
        "md5_digest": "818c772aff6f3427c5b45e42320b5359",
        "packagetype": "sdist",
        "python_version": "source",
        "requires_python": null,
        "size": 31418,
        "upload_time": "2018-11-27T00:10:29",
        "upload_time_iso_8601": "2018-11-27T00:10:29.934731Z",
        "url": "https://files.pythonhosted.org/packages/49/f9/6b892ea01df47659c32962defa29ebbecb293d197482b149339429ec11ad/fs2dicom-0.1.2.tar.gz",
        "yanked": false,
        "yanked_reason": null
      }
    ]
  },
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "325f68e599e1f56d02466de0d8fa84b895849530e8a653180ae4f99ac8c15ad7",
        "md5": "fe1c7e70ccd1f0d4f9ad9868348fb5dd",
        "sha256": "564823f57e663ec33b622398de2bb8a44c388cd3097b0dd369c33f702502801b"
      },
      "downloads": -1,
      "filename": "fs2dicom-0.1.2-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "fe1c7e70ccd1f0d4f9ad9868348fb5dd",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": null,
      "size": 14623,
      "upload_time": "2018-11-27T00:10:27",
      "upload_time_iso_8601": "2018-11-27T00:10:27.699405Z",
      "url": "https://files.pythonhosted.org/packages/32/5f/68e599e1f56d02466de0d8fa84b895849530e8a653180ae4f99ac8c15ad7/fs2dicom-0.1.2-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "49f96b892ea01df47659c32962defa29ebbecb293d197482b149339429ec11ad",
        "md5": "818c772aff6f3427c5b45e42320b5359",
        "sha256": "dfa30625196c42ce360d6a462c7ab8a5e0271f588fdf97c9a0e73e1dd20c1123"
      },
      "downloads": -1,
      "filename": "fs2dicom-0.1.2.tar.gz",
      "has_sig": false,
      "md5_digest": "818c772aff6f3427c5b45e42320b5359",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": null,
      "size": 31418,
      "upload_time": "2018-11-27T00:10:29",
      "upload_time_iso_8601": "2018-11-27T00:10:29.934731Z",
      "url": "https://files.pythonhosted.org/packages/49/f9/6b892ea01df47659c32962defa29ebbecb293d197482b149339429ec11ad/fs2dicom-0.1.2.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}