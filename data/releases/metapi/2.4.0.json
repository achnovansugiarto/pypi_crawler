{
  "info": {
    "author": "Jie Zhu, Fangming Yang",
    "author_email": "alienchuj@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 3 - Alpha",
      "Environment :: Console",
      "Intended Audience :: Developers",
      "Intended Audience :: Science/Research",
      "License :: OSI Approved :: GNU General Public License v3 (GPLv3)",
      "Natural Language :: English",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3.10",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: 3.9",
      "Topic :: Scientific/Engineering :: Bio-Informatics"
    ],
    "description": "[![bioconda-badge](https://img.shields.io/badge/install%20with-bioconda-brightgreen.svg?style=flat)](http://bioconda.github.io)\n[![ohmeta-badge](https://img.shields.io/badge/install%20with-ohmeta-brightgreen.svg?style=flat)](http://anaconda.org/ohmeta)\n[![PyPI version](https://badge.fury.io/py/metapi.svg)](https://badge.fury.io/py/metapi)\n[![Anaconda-Server Badge](https://anaconda.org/bioconda/metapi/badges/downloads.svg)](https://anaconda.org/bioconda/metapi)\n\n<div align=center><img width=\"500\" height=\"280\" src=\"docs/logo.svg\"/></div>\n\nA general metagenomics data mining system focus on robust microbiome research.\n\n## Overview\n### MAG workflow (WIP figure)\n<div align=center><img width=\"600\" height=\"800\" src=\"docs/mag_workflow.svg\"></div>\n\n## Installation\n\nmetapi works with Python 3.7+.\nYou can install it via [bioconda](https://bioconda.github.io/):\n\n```\n# It is recommended to install the latest version\n➤ mamba install -c conda-forge -c bioconda metapi=2.4.0\n```\n\n## Run\n\n### Help\n\n```\n➤ metapi --help\n\n  .___  ___.  _______ .___________.    ___      .______    __\n  |   \\/   | |   ____||           |   /   \\     |   _  \\  |  |\n  |  \\  /  | |  |__   `---|  |----`  /  ^  \\    |  |_)  | |  |\n  |  |\\/|  | |   __|      |  |      /  /_\\  \\   |   ___/  |  |\n  |  |  |  | |  |____     |  |     /  _____  \\  |  |      |  |\n  |__|  |__| |_______|    |__|    /__/     \\__\\ | _|      |__|\n\n            Omics for All, Open Source for All\n\n A general metagenomics data mining system focus on robust microbiome research.\n\n    optional arguments:\n    -h, --help     show this help message and exit\n    -v, --version  print software version and exit\n\n    available subcommands:\n\n    init         init project\n    mag_wf       metagenome-assembly-genome pipeline\n    gene_wf      metagenome-assembly-gene pipeline\n    sync         metapi sync project\n```\n\n### Init\n\n```\n➤ metapi init --help\nusage: metapi init [-h] [-d WORKDIR] [--check-samples] [-s SAMPLES]\n                        [-b {simulate,trimming,rmhost,assembly,binning,checkm}]\n                        [--trimmer {sickle,fastp}]\n                        [--rmhoster {bwa,bowtie2,minimap2,kraken2,kneaddata}]\n                        [--assembler {idba-ud,megahit,metaspades,spades,opera-ms} [{idba-ud,megahit,metaspades,spades,opera-ms} ...]]\n                        [--binner BINNER [BINNER ...]]\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -d, --workdir WORKDIR\n                        project workdir (default: ./)\n  --check-samples       check samples, default: False\n  -s, --samples SAMPLES\n                        desired input:\n                        samples list, tsv format required.\n                        \n                        if begin from trimming, rmhost, or assembly:\n                            if it is fastq:\n                                the header is: [sample_id, assembly_group, binning_group, fq1, fq2]\n                            if it is sra:\n                                the header is: [sample_id, assembly_group, binning_group, sra]\n                        \n                        if begin from simulate:\n                                the header is: [id, genome, abundance, reads_num, model]\n                        \n  -b, --begin {simulate,trimming,rmhost,assembly,binning,checkm}\n                        pipeline starting point (default: trimming)\n  --trimmer {sickle,fastp}\n                        which trimmer used (default: fastp)\n  --rmhoster {bwa,bowtie2,minimap2,kraken2,kneaddata}\n                        which rmhoster used (default: bowtie2)\n  --assembler {idba-ud,megahit,metaspades,spades,opera-ms} [{idba-ud,megahit,metaspades,spades,opera-ms} ...]\n                        which assembler used, required when begin with binning, can be changed in config.yaml (default: ['metaspades'])\n  --binner BINNER [BINNER ...]\n                        wchich binner used (default: ['metabat2', 'concoct', 'maxbin2', 'vamb', 'dastools'])\n```\n- **Note**  \n  * When we do `metapi init`, metapi will help us to create project structure,\n  include `config.yaml`, `profiles/`, `envs/`, `logs/` and `results/`.\n    - `config.yaml`: workflow configuration, can be edited\n    - `profiles/`: used when run pipeline on cluster, can be edited\n      + For `SGE` user, please see `profiles/sge/cluster.yaml`\n      + For `SLURM` user, please see `profiles/slurm/cluster.yaml`\n    - `envs/`: conda environment file for some rules, can be edited to update software version by yourself\n\n  * We recommand you to create a directory, and `cd` it and put `samples.tsv` in the directory, then do ```metapi init -s samples.tsv -d ./```.\n\n  * Samples file is required when init project. Samples input format requirement can see [here](#inputtag).\n\n  * Begin point can be `simulate`, `trimming`, `rmhost`, `assembly` and `binning`, it means:\n    - simulate: simulate reads\n    - trimming: samples need trimming, do quality control\n    - rmhost: samples is quality control well, only need to remove host sequence, will not do trimming\n    - assembly: samples is clean, just do assembly, will not do trimming and rmhost\n    -  (WIP) binning: supply samples and assembly, then do binning, will no do trimming, rmhost and assembly\n\n  * When metapi init executed, then corresponding configuration will be writen into `config.yaml`.  \n    Of course, you can edit `config.yaml` to update config, then when run `metapi mag_wf` or `metapi gene_wf`,  \n    `metapi` will understand it. Just edit it, see what will happen.\n\n\n### mag_wf\n\n```\n➤ metapi mag_wf --help\n          [--cluster-engine {slurm,sge,lsf,pbs-torque}]\n          [--wait WAIT] [--use-conda] [--conda-prefix CONDA_PREFIX]\n          [--conda-create-envs-only]\n          [TASK]\n\npositional arguments:\n  TASK                  pipeline end point. Allowed values are\n  \n  simulate_all,\n  prepare_short_reads_all,\n  prepare_long_reads_all,\n  prepare_reads_all,\n  raw_fastqc_all,\n  raw_report_all, raw_all,\n  trimming_sickle_all,\n  trimming_fastp_all,\n  trimming_report_all,\n  trimming_all,\n  rmhost_bwa_all,\n  rmhost_bowtie2_all,\n  rmhost_minimap2_all,\n  rmhost_kraken2_all,\n  rmhost_kneaddata_all,\n  rmhost_report_all,\n  rmhost_all,\n  qcreport_all,\n  assembly_megahit_all,\n  assembly_idba_ud_all,\n  assembly_metaspades_all,\n  assembly_spades_all,\n  assembly_plass_all,\n  assembly_opera_ms_all, \n  assembly_metaquast_all,\n  assembly_report_all,\n  assembly_all,\n  alignment_base_depth_all,\n  alignment_report_all,\n  alignment_all,\n  binning_metabat2_coverage_all,\n  binning_metabat2_all,\n  binning_maxbin2_all, \n  binning_concoct_all,\n  binning_graphbin2_all,\n  binning_dastools_all,\n  binning_vamb_prepare_all, \n  binning_vamb_all,\n  binning_report_all,\n  binning_all,\n  identify_virsorter2_all,\n  identify_deepvirfinder_all,\n  identify_single_all,\n  identify_phamb_all,\n  identify_multi_all,\n  identify_all,\n  predict_scaftigs_gene_prodigal_all,\n  predict_scaftigs_gene_prokka_all,\n  predict_bins_gene_prodigal_all,\n  predict_bins_gene_prokka_all,\n  predict_scaftigs_gene_all,\n  predict_bins_gene_all,\n  predict_all,\n  checkm_all,\n  dereplicate_mags_drep_all,\n  dereplicate_mags_all,\n  taxonomic_all,\n  upload_sequencing_all,\n  upload_assembly_all,\n  upload_all,\n  all (default: all)\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -d, --workdir WORKDIR\n                        project workdir (default: ./)\n  --check-samples       check samples, default: False\n  --config CONFIG       config.yaml (default: ./config.yaml)\n  --profile PROFILE     cluster profile name (default: ./profiles/slurm)\n  --cores CORES         all job cores, available on '--run-local' (default: 240)\n  --local-cores LOCAL_CORES\n                        local job cores, available on '--run-remote' (default: 8)\n  --jobs JOBS           cluster job numbers, available on '--run-remote' (default: 30)\n  --list                list pipeline rules\n  --debug               debug pipeline\n  --dry-run             dry run pipeline\n  --run-local           run pipeline on local computer\n  --run-remote          run pipeline on remote cluster\n  --cluster-engine {slurm,sge,lsf,pbs-torque}\n                        cluster workflow manager engine, support slurm(sbatch) and sge(qsub) (default: slurm)\n  --wait WAIT           wait given seconds (default: 60)\n  --use-conda           use conda environment\n  --conda-prefix CONDA_PREFIX\n                        conda environment prefix (default: ~/.conda/envs)\n  --conda-create-envs-only\n                        conda create environments only\n```\n\n### mag_wf example\n\n```\n# init project\n➤ metapi init -d . -s samples.tsv -b trimming\n\n# create conda environments, which will create envs at ~/.conda/envs\n# run it firstly, recommend\n➤ metapi mag_wf --conda-create-envs-only\n\n# run pipeline with conda\n➤ metapi mag_wf all --use-conda --run-local\n\n# run raw_fastqc\n➤ metapi mag_wf raw_fastqc_all --use-conda --run-local\n\n# run trimming\n➤ metapi mag_wf trimming_all --use-conda --run-local\n\n# run rmhost\n➤ metapi mag_wf rmhost_all --use-conda --run-local\n\n# run qc report\n➤ metapi mag_wf qcreport_all --use-conda --run-local\n\n# run assembly\n➤ metapi mag_wf assembly_all --use-conda --run-local\n\n# run binning (microbial MAG)\n➤ metapi mag_wf binning_all --use-conda --run-local\n\n# run identify (virus MAG)\n➤ metapi mag_wf identify_all --use-conda --run-local\n\n# run gene predict\n➤ metapi mag_wf predict_all --use-conda --run-local\n\n# run checkm\n➤ metapi mag_wf checkm_all --use-conda --run-local\n\n#run taxonomic \n➤ metapi mag_wf taxonomic_all --use-conda --run-local\n\n# run mag_wf all\n➤ metapi mag_wf --use-conda --run-local\n\n# run mag_wf all on SGE/SLURM cluster\n➤ metapi mag_wf all --use-conda --run-remote\n```\n\n## Input details\n<a name=\"inputtag\"></a>\n\n+ The input fastq need gzip compress.\n\n+ If `sample_id` col contain same id, then the reads of each sample will be merged.\n\n+ For the same `assembly_group`, the reads will be combined together to do co-assembly,\n  then the reads of each sample will map to the co-assembled results to calculate co-abundance for each `assembly_group`,\n  then using MetaBAT2, MaxBin2, CONCOCT (You can specific which binner to use) to do binning.\n\n+ For the same `binning_group`, the assembled results will be combined together to build minimap2 index,\n  then the reads of each sample will map to the combined index to calculate co-abundance,\n  then using vamb to do binning\n\n+ `assembly_group` control the assembly and binning strategy; `binning_group` control the multisplit binning strategy developed by vamb.\n\n+ If all `assembly_group` are unique, for MetaBAT2, MaxBin2, CONCOCT, etc., that is the traditional single-assembly and single-binning strategy.\n\n+ If `binning_group` has multiple groups, then vamb will perform multisplit binning in each `binning_group` separately, which is useful for very large-scale data.\n  For example, if there are 10,000 samples, and multisplit binning is performed once for every thousand samples, the binning group can be set to 10 different groups.\n\n## Input format\n- begin from trimming, rmhost or assembly:\n\n  - `Paired-end reads`\n\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: |\n  |  s1          | ag1             | bg1           | s1.1.fq.gz | s1.2.fq.gz |\n  |  s2          | ag1             | bg1           | s2.1.fq.gz | s2.2.fq.gz |\n  |  s3          | ag2             | bg2           | s3.1.fq.gz | s3.2.fq.gz |\n  |  s4          | ag2             | bg2           | s4.1.fq.gz | s4.2.fq.gz |\n\n  - `Paired-end reads(interleaved)`, update `config.yaml::reads_interleaved=true`  \n\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: |\n  |  s1          | ag1             | bg1           | s1.fq.gz   |            |\n  |  s2          | ag1             | bg1           | s2.fq.gz   |            |\n  |  s3          | ag2             | bg2           | s3.fq.gz   |            |\n  |  s4          | ag2             | bg2           | s4.fq.gz   |            |\n\n  - (WIP) `Paired-end reads with long reads`, update `config.yaml::have_long=true`\n\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |   fq_long      |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: | :------------: |\n  |  s1          | ag1             | bg1           | s1.1.fq.gz | s1.2.fq.gz |  s1.long.fq.gz |\n  |  s2          | ag1             | bg1           | s2.1.fq.gz | s2.2.fq.gz |  s2.long.fq.gz |\n  |  s3          | ag2             | bg2           | s3.1.fq.gz | s3.2.fq.gz |  s3.long.fq.gz |\n  |  s4          | ag2             | bg2           | s4.1.fq.gz | s4.2.fq.gz |  s4.long.fq.gz |\n\n  - (WIP)`Paired-end reads(interleaved) with long reads`, update `config.yaml::reads_interleaved=true` and `config.yaml::have_long=true`\n\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |   fq_long      |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: | :------------: |\n  |  s1          | ag1             | bg1           | s1.fq.gz   |            |  s1.long.fq.gz |\n  |  s2          | ag1             | bg1           | s2.fq.gz   |            |  s2.long.fq.gz |\n  |  s3          | ag2             | bg2           | s3.fq.gz   |            |  s3.long.fq.gz |\n  |  s4          | ag2             | bg2           | s4.fq.gz   |            |  s4.long.fq.gz |\n\n  - `Single-end reads`, update `config.yaml::reads_layout=se`\n\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: |\n  |  s1          | ag1             | bg1           | s1.fq.gz   |            |\n  |  s2          | ag1             | bg1           | s2.fq.gz   |            |\n  |  s3          | ag2             | bg2           | s3.fq.gz   |            |\n  |  s4          | ag2             | bg2           | s4.fq.gz   |            |\n\n  - `SRA (only support paired-end reads)` :\n  SRA can be dumpped to Paired-end fastq reads\n\n  |  sample_id   |  assembly_group | binning_group |    sra     |\n  | :----------: | :-------------: | :-----------: | :--------: |\n  |  s1          | ag1             | bg1           | s1.sra     |\n  |  s2          | ag1             | bg1           | s2.sra     |\n  |  s3          | ag2             | bg2           | s3.sra     |\n  |  s4          | ag2             | bg2           | s4.sra     |\n\n- begin from simulate, only support paired-end reads\n\n  |  id   | genome | abundance | reads_num | model |\n  | :---: | :----: | :-------: | :-------: | :---: |\n  |  s1   | g1.fa  |    1.0    |    1M     | hiseq |\n  |  s2   | g1.fa  |    0.5    |    2M     | hiseq |\n  |  s2   | g2.fa  |    0.5    |    2M     | hiseq |\n  |  s3   | g1.fa  |    0.2    |    3M     | hiseq |\n  |  s3   | g2.fa  |    0.3    |    3M     | hiseq |\n  |  s3   | g3.fa  |    0.5    |    3M     | hiseq |\n\nIt means:\n\nThe sample s1 contain 1M reads which come from g1, the relative abundance of\nspecies g1 is 1.0.\n\nThe sample s2 contain 2M reads, 1M reads come from g1\nand 1M reads come from g2. the relative abundance of\nspecies g1 is 0.5, the relative abundance of\nspecies g2 is 0.5.\n\nThe sample s3 contain 3M reads, 0.6M reads come from g1, 0.9M reads come from\ng2 and 1.5M reads come from g3, the relative abundance of\nspecies g1 is 0.2, the relative abundance of\nspecies g2 is 0.3, the relative abundance of\nspecies g3 is 0.5.\n\nThen metapi will use [InSilicoSeq](https://github.com/HadrienG/InSilicoSeq) to generate metagenomics shotgun reads.\n\n- (WIP) begin from binning\n  |  sample_id   |  assembly_group | binning_group |    fq1     |    fq2     |   scaftigs          |\n  | :----------: | :-------------: | :-----------: | :--------: | :--------: | :-----------------: |\n  |  s1          | ag1             | bg1           | s1.1.fq.gz | s1.2.fq.gz |  ag1.scaftigs.fa.gz |\n  |  s2          | ag1             | bg1           | s2.1.fq.gz | s2.2.fq.gz |  ag1.scaftigs.fa.gz |\n  |  s3          | ag2             | bg2           | s3.1.fq.gz | s3.2.fq.gz |  ag2.scaftigs.fa.gz |\n  |  s4          | ag2             | bg2           | s4.1.fq.gz | s4.2.fq.gz |  ag2.scaftigs.fa.gz |\n\n- (WIP) begin from checkm, or dereplicate, or taxonomic assignment (fq1 and fq2 can be empty)\n  |  sample_id   |   bins          |\n  | :----------: | :-------------: |\n  |  s1          |   s1.bin.1.fa   |\n  |  s1          |   s1.bin.2.fa   |\n  |  s1          |   s1.bin.3.fa   |\n  |  s2          |   s2.bin.1.fa   |\n  |  s2          |   s2.bin.2.fa   |\n  |  s2          |   s3.bin.3.fa   |\n\n## Default output structure (begin from trimming)\n```\n- config.yaml\n- logs/\n- profiles/\n- envs/\n- results/\n    00.raw/\n    01.trimming/\n    02.rmhost/\n    03.qcreport/\n    04.assembly/\n    05.alignment/\n    06.binning/\n    06.identify/\n    07.predict/\n    08.checkm/\n    09.dereplicate/\n    10.taxonomic/\n    99.upload/\n```\n\n- We will try our best to keep the directory structure uniform. Sequence files are generally placed in the reads directory, and report files are generally placed in the report directory. \n- If you are not very clear about the output of the whole process, it is recommended to directly raise an issue or look at the code. \n\n## Getting help\n\nIf you want to report a bug or issue, or have problems with installing or\nrunning the software, please create [a new\nissue](https://github.com/ohmeta/metapi/issues).\nThis is the preferred way of getting support. Alternatively, you can [mail me](mailto:alienchuj@gmail.com).\n\n## Contributing\n\nContributions welcome! Send me a pull request or get in [touch](mailto:alienchuj@gmail.com).\n\nWhen contributing a PR, please use the [dev](https://github.com/ohmeta/metapi/tree/dev) branch.\nFor style, code will be checked using flake8,\n[black](https://github.com/psf/black), and\n[snakefmt](https://github.com/snakemake/snakefmt). These modules can be\ninstalled via conda, `conda install black flake8 flake8-bugbear snakefmt` or via\npip `pip install black flake8 flake8-bugbear snakefmt`.\n\n## Contributors\n\n- Jie Zhu - [@alienzj](https://github.com/alienzj)\n- Fangming Yang - [@yangfangming](https://github.com/yangfangming)\n- Yanmei Ju - [@juyanmei](https://github.com/juyanmei)\n- Weiting Liang - [@weiting-liang](https://github.com/weiting-liang)\n\n## Citation\n\nOver 50,000 Metagenomically Assembled Draft Genomes for the Human Oral Microbiome Reveal New Taxa  \nGenomics, Proteomics & Bioinformatics, 2021, https://doi.org/10.1016/j.gpb.2021.05.001  \n\n## License\n\nThis module is licensed under the terms of the [GPLv3 license](https://opensource.org/licenses/GPL-3.0).\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/ohmeta/metapi",
    "keywords": "",
    "license": "GPLv3+",
    "maintainer": "",
    "maintainer_email": "",
    "name": "metapi",
    "package_url": "https://pypi.org/project/metapi/",
    "platform": null,
    "project_url": "https://pypi.org/project/metapi/",
    "project_urls": {
      "Homepage": "https://github.com/ohmeta/metapi"
    },
    "release_url": "https://pypi.org/project/metapi/2.4.0/",
    "requires_dist": [
      "numpy",
      "pandas",
      "openpyxl",
      "snakemake (>=7.0)",
      "ruamel.yaml",
      "natsort",
      "biopython (>=1.73)",
      "seaborn",
      "matplotlib"
    ],
    "requires_python": "",
    "summary": "a pipeline to construct a genome catalogue from metagenomics data",
    "version": "2.4.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 14809957,
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "b11315385ff861a6993cf27608e638d321004d764f2eae5d07494a92f70b1ee9",
        "md5": "9618cabf61a13cbc32be13ce9aeea3fa",
        "sha256": "c878fdd0d5f90c757d07040327b097b80d47a4195653868d13fdea25673225fe"
      },
      "downloads": -1,
      "filename": "metapi-2.4.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "9618cabf61a13cbc32be13ce9aeea3fa",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": null,
      "size": 151216,
      "upload_time": "2022-08-19T07:07:49",
      "upload_time_iso_8601": "2022-08-19T07:07:49.067141Z",
      "url": "https://files.pythonhosted.org/packages/b1/13/15385ff861a6993cf27608e638d321004d764f2eae5d07494a92f70b1ee9/metapi-2.4.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "17645285643be8b8ca209a4d688a0250c68bff025cca0d0b0d466a039884e048",
        "md5": "131241fdee87806998d50cf120ef05ee",
        "sha256": "db1b9f325f5a447904e348c5ddb0754bec74b5e2ae40803f05d2992247472a2f"
      },
      "downloads": -1,
      "filename": "metapi-2.4.0.tar.gz",
      "has_sig": false,
      "md5_digest": "131241fdee87806998d50cf120ef05ee",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": null,
      "size": 110168,
      "upload_time": "2022-08-19T07:07:51",
      "upload_time_iso_8601": "2022-08-19T07:07:51.279944Z",
      "url": "https://files.pythonhosted.org/packages/17/64/5285643be8b8ca209a4d688a0250c68bff025cca0d0b0d466a039884e048/metapi-2.4.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}