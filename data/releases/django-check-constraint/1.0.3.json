{
  "info": {
    "author": "Tonye Jack",
    "author_email": "jtonye@ymail.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 3 - Alpha",
      "Framework :: Django :: 2.2",
      "Framework :: Django :: 3.0",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: Apache Software License",
      "License :: OSI Approved :: MIT License",
      "Natural Language :: English",
      "Operating System :: OS Independent",
      "Programming Language :: Python :: 3.5",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8",
      "Programming Language :: Python :: Implementation :: CPython",
      "Programming Language :: Python :: Implementation :: PyPy",
      "Topic :: Internet :: WWW/HTTP"
    ],
    "description": "# django-check-constraint\n![django check constraint test.](https://github.com/jackton1/django-check-constraint/workflows/django%20check%20constraint%20test./badge.svg?branch=master)\n[![PyPI - License](https://img.shields.io/pypi/l/django-check-constraint.svg)](https://github.com/jackton1/django-check-constraint/blob/master/LICENSE)\n[![PyPI - Python Version](https://img.shields.io/pypi/pyversions/django-check-constraint.svg)](https://pypi.org/project/django-check-constraint)\n[![PyPI - Django Version](https://img.shields.io/pypi/djversions/django-check-constraint.svg)](https://docs.djangoproject.com/en/2.2/releases/)\n\nExtends [Django's Check](https://docs.djangoproject.com/en/3.0/ref/models/options/#constraints) constraint to include annotations and function references.\n\n\n#### Scenario:\n\nSuppose you have a database function that returns the counts of null values in `[i, ...n]`.\n\n```postgresql\nCREATE OR REPLACE FUNCTION public.non_null_count(VARIADIC arg_array ANYARRAY)\n  RETURNS BIGINT AS\n  $$\n    SELECT COUNT(x) FROM UNNEST($1) AS x\n  $$ LANGUAGE SQL IMMUTABLE;\n\n```\n\n#### Example:\n```postgresql\nSELECT public.non_null_count(1, null, null);\n```\n\n#### Outputs:\n\n```sql\nnon_null_count\n----------------\n              1\n(1 row)\n```\n\nDefining a check constraint with this function\n\nThe equivalent of\n\n```postgresql\nALTER TABLE app_name_test_modoel ADD CONSTRAINT app_name_test_model_optional_field_provided\n    CHECK(non_null_count(amount::integer , amount_off::integer, percentage::integer) = 1);\n```\n\n## Usage\n\nConverting this to django functions and annotated check contraints can be done using:\n\n`function.py`\n\n```python\nfrom django.db.models import Func, SmallIntegerField, TextField\nfrom django.db.models.functions import Cast\n\n\nclass NotNullCount(Func):\n    function = 'non_null_count'\n\n    def __init__(self, *expressions, **extra):\n        filter_exp = [\n            Cast(exp, TextField()) for exp in expressions if isinstance(exp, str)\n        ]\n        if 'output_field' not in extra:\n            extra['output_field'] = SmallIntegerField()\n\n        if len(expressions) < 2:\n            raise ValueError('NotNullCount must take at least two expressions')\n\n        super().__init__(*filter_exp, **extra)\n```\n\n\n\n#### Creating annotated check constraints\n\n\n```python\nfrom django.db import models\nfrom django.db.models import Q\nfrom check_constraint.models import AnnotatedCheckConstraint\n\nclass TestModel(models.Model):\n    amount = models.DecimalField(max_digits=9, decimal_places=2, null=True, blank=True)\n    amount_off = models.DecimalField(max_digits=7, decimal_places=2, null=True, blank=True)\n    percentage = models.DecimalField(max_digits=3, decimal_places=0, null=True, blank=True)\n\n\n    class Meta:\n        constraints = [\n            AnnotatedCheckConstraint(\n                check=Q(not_null_count=1),\n                annotations={\n                    'not_null_count': (\n                        NotNullCount(\n                            'amount',\n                            'amount_off',\n                            'percentage',\n                        )\n                    ),\n                },\n                name='%(app_label)s_%(class)s_optional_field_provided',\n            ),\n        ]\n\n```\n\n\nTODO's\n------\n\n- [ ] Add support for schema based functions.\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/jackton1/django-check-constraint",
    "keywords": "django,django-check-constraint,django check constraint,check constraint-django,model constraints",
    "license": "MIT/Apache-2.0",
    "maintainer": "Tonye Jack",
    "maintainer_email": "jtonye@ymail.com",
    "name": "django-check-constraint",
    "package_url": "https://pypi.org/project/django-check-constraint/",
    "platform": "",
    "project_url": "https://pypi.org/project/django-check-constraint/",
    "project_urls": {
      "Homepage": "https://github.com/jackton1/django-check-constraint"
    },
    "release_url": "https://pypi.org/project/django-check-constraint/1.0.3/",
    "requires_dist": [
      "Django (>=2.2.10)",
      "bump2version (==1.0.0) ; extra == 'deploy'",
      "readme-renderer[md] ; extra == 'deploy'",
      "changes (==0.7.0) ; extra == 'deploy'",
      "git-changelog (==0.1.0) ; extra == 'deploy'",
      "twine (==1.3.1) ; extra == 'deploy'",
      "pip-tools (==4.4.1) ; extra == 'development'",
      "check-manifest (==0.37) ; extra == 'development'",
      "Django (>=2.2.10) ; extra == 'development'",
      "nox (==2019.11.9) ; extra == 'development'",
      "pluggy (>=0.7) ; extra == 'development'",
      "mock (==2.0.0) ; extra == 'development'",
      "unittest-xml-reporting (==2.5.2) ; extra == 'development'",
      "codacy-coverage (==1.3.11) ; extra == 'development'",
      "flake8 (==3.4.1) ; extra == 'development'",
      "yamllint (==1.10.0) ; extra == 'development'",
      "isort (==4.2.15) ; extra == 'development'",
      "pre-commit (==2.0.1) ; extra == 'development'",
      "flake8 (==3.4.1) ; extra == 'lint'",
      "yamllint (==1.10.0) ; extra == 'lint'",
      "isort (==4.2.15) ; extra == 'lint'",
      "pre-commit (==2.0.1) ; extra == 'lint'",
      "nox (==2019.11.9) ; extra == 'nox'",
      "pluggy (>=0.7) ; extra == 'nox'",
      "mock (==2.0.0) ; extra == 'nox'",
      "unittest-xml-reporting (==2.5.2) ; extra == 'nox'",
      "codacy-coverage (==1.3.11) ; extra == 'nox'",
      "nox (==2019.11.9) ; extra == 'test'",
      "pluggy (>=0.7) ; extra == 'test'",
      "mock (==2.0.0) ; extra == 'test'",
      "unittest-xml-reporting (==2.5.2) ; extra == 'test'",
      "codacy-coverage (==1.3.11) ; extra == 'test'"
    ],
    "requires_python": ">=3.5",
    "summary": "Extends django check constraint to support annotations.",
    "version": "1.0.3",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 6712721,
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "371d8533b168a89639299360033c11c76ab53566b14840c7be13523937f91504",
        "md5": "5a4ab3312deeeb98967a5d6ff013268d",
        "sha256": "d078ff634ddd23151d7db13fd8ffc53894beeb4a12e85e9245568a147cce3477"
      },
      "downloads": -1,
      "filename": "django_check_constraint-1.0.3-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "5a4ab3312deeeb98967a5d6ff013268d",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.5",
      "size": 7374,
      "upload_time": "2020-02-16T15:21:57",
      "upload_time_iso_8601": "2020-02-16T15:21:57.477910Z",
      "url": "https://files.pythonhosted.org/packages/37/1d/8533b168a89639299360033c11c76ab53566b14840c7be13523937f91504/django_check_constraint-1.0.3-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "c5f742f1606057a7ba165bce1d710c2f3fb5a2828a9c30221fd8826cb6077b1d",
        "md5": "e8152a2500c3c7e982628f67c5462958",
        "sha256": "17041deac55c247982c82a096af0c871c8244e73516505ec7f4cf1c6a9db5b56"
      },
      "downloads": -1,
      "filename": "django-check-constraint-1.0.3.tar.gz",
      "has_sig": false,
      "md5_digest": "e8152a2500c3c7e982628f67c5462958",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.5",
      "size": 8090,
      "upload_time": "2020-02-16T15:21:59",
      "upload_time_iso_8601": "2020-02-16T15:21:59.525049Z",
      "url": "https://files.pythonhosted.org/packages/c5/f7/42f1606057a7ba165bce1d710c2f3fb5a2828a9c30221fd8826cb6077b1d/django-check-constraint-1.0.3.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}