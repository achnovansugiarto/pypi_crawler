{
  "info": {
    "author": "Matt Pye",
    "author_email": "pyematt@gmail.com",
    "bugtrack_url": null,
    "classifiers": [
      "License :: OSI Approved :: MIT License",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Programming Language :: Python :: 3.8"
    ],
    "description": "# Django MagicLink\n\n\nPasswordless Authentication for Django with Magic Links.\n\nThis package was created with a focus on [ease of setup](#steps-to-impliment), [security](#security) and testing (coverage is currently at 100%). The idea is to use sane defaults to quickly create secure single-use token authentication for Django.\n\n![](example.gif)\n\n\n## Install\n\n```bash\npip install django-magiclink\n```\n\n\n## Setup\n\nThe setup of the app is simple but has a few steps and a few templates that need overriding.\n\n1. [Install the app](#install)\n1. [Configure the app](#configuration) adding urls and settings. There are also a number of [additional configuration settings](#configuration-settings)\n1. [Set up the login page](#login-page) by overriding the login page template\n1. [Override the login sent page HTML](#login-sent-page)\n1. [Customise the login failed page](#login-failed-page)\n1. [Set up the magic link email](#magic-link-email) (optional) by setting the email logo and colours. It's also possible to override the email templates\n1. [Create a signup page](#signup-page) (optional) depending on your settings configuration\n\n\n### Basic login flow\n\n1. The user signs up via the sign up page (This can be skipped if `MAGICLINK_REQUIRE_SIGNUP = False`)\n1. They enter their email on the login page to request a magic link\n1. A magic link is sent to users email address\n1. The user is redirected to a login sent page\n1. The user clicks on the magic link in their email\n1. The user is logged in and redirected\n\n\n*If you want to create a different passwordless login flow see the [Manual usage](#manual-usage) section*\n\n\n#### Configuration\n\nAdd to the `urlpatterns` in `urls.py`:\n```python\nurlpatterns = [\n    ...\n    path('auth/', include('magiclink.urls', namespace='magiclink')),\n    ...\n]\n```\n\nAdd `magiclink` to your `INSTALLED_APPS`:\n```python\nINSTALLED_APPS = (\n    ...\n    'magiclink',\n    ...\n)\n```\n\n```python\nAUTHENTICATION_BACKENDS = (\n    'magiclink.backends.MagicLinkBackend',\n    ...\n    'django.contrib.auth.backends.ModelBackend',\n)\n```\n*Note: MagicLinkBackend should be placed at the top of AUTHENTICATION_BACKENDS* to ensure it is used as the primary login backend.\n\n\nAdd the following settings to your `settings.py` (you will need to replace the template names in the below steps):\n```python\n# Set Djangos login URL to the magiclink login page\nLOGIN_URL = 'magiclink:login'\n\nMAGICLINK_LOGIN_TEMPLATE_NAME = 'magiclink/login.html'\nMAGICLINK_LOGIN_SENT_TEMPLATE_NAME = 'magiclink/login_sent.html'\nMAGICLINK_LOGIN_FAILED_TEMPLATE_NAME = 'magiclink/login_failed.html'\n\n# Optional:\n# If this setting is set to False a user account will be created the first\n# time a user requests a login link.\nMAGICLINK_REQUIRE_SIGNUP = True\nMAGICLINK_SIGNUP_TEMPLATE_NAME = 'magiclink/signup.html'\n```\n\nSee [additional configuration settings](#configuration-settings) for all of the different available settings.\n\n\n#### Login page\n\nEach login page will need different HTML so you need to set the `MAGICLINK_LOGIN_TEMPLATE_NAME` setting to a template of your own. When overriding this template please ensure the following code is included:\n\n```html\n<form action=\"{% url 'magiclink:login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}\" method=\"post\">\n    {% csrf_token %}\n    {{ login_form }}\n    <button type='submit'>Send login email</button>\n</form>\n```\n\nSee the login docs if you want to create your own login view\n\n\n#### Login sent page\n\nAfter the user has requested a magic link, they will be redirected to a success page. The HTML for this page can be overridden using the setting `MAGICLINK_LOGIN_SENT_TEMPLATE_NAME`. It is advised you return a simple message telling the user to check their email:\n\n```html\n<h1>Check your email</h1>\n<p>We have sent you a magic link to your email address</p>\n<p>Please click the link to be logged in automatically</p>\n```\n\n\n#### Login failed page\n\nIf the user tries to use an invalid magic token they will be shown a custom error page. To override the HTML for this page you can set the `MAGICLINK_LOGIN_FAILED_TEMPLATE_NAME` setting. If you would like to return a 404 page you can set this setting to a empty string (or any falsy value).\n\nThe reasons for the login failing is passed through as the context variable `{{ login_error }}`\n\nTo help tailor the error page and explain the possible reasons the user could not login the following context variables are provided:\n\n* `{{ login_error }}` - The reason the login failed (raised by `MagicLink.validate()`)\n* `{{ one_token_per_user }}` - The value of the `MAGICLINK_ONE_TOKEN_PER_USER` setting\n* `{{ require_same_browser }}` - The value of the `MAGICLINK_REQUIRE_SAME_BROWSER` setting\n* `{{ require_same_ip }}` - The value of the `MAGICLINK_REQUIRE_SAME_IP` setting\n* `{{ allow_superuser_login }}` - The value of the `MAGICLINK_ALLOW_SUPERUSER_LOGIN` setting\n* `{{ allow_staff_login }}` - The value of the `MAGICLINK_ALLOW_STAFF_LOGIN` setting\n\n\nFor an example of this page see the [default login failed template](https://github.com/pyepye/django-magiclink/blob/master/magiclink/templates/magiclink/login_failed.html)\n\n\n#### Magic link email\n\nThe login email which includes the magic link needs to be configured. By default, a simple HTML template is used which can be adapted to your own branding using the `MAGICLINK_EMAIL_STYLES` setting, or you can override the template (see below)\n\nThis `MAGICLINK_EMAIL_STYLES` setting should be a dict with the following key values:\n\n```python\nMAGICLINK_EMAIL_STYLES = {\n    'logo_url': 'https://example.com/logo.png',\n    'background-colour': '#ffffff',\n    'main-text-color': '#000000',\n    'button-background-color': '#0078be',\n    'button-text-color': '#ffffff',\n}\n```\n*Note: The logo URL must be a full URL. For email client support you should use either a jpeg or png.*\n\nIf this email template is not to your liking you can override the email templates (one for text and one for html). To do so you need to override the `MAGICLINK_EMAIL_TEMPLATE_NAME_TEXT` and `MAGICLINK_EMAIL_TEMPLATE_NAME_HTML` settings.  If you override these templates the following context variables are available:\n\n* `{{ subject }}` - The subject of the email \"Your login magic link\"\n* `{{ magiclink }}` - The magic link URL\n* `{{ user }}` - The full user object\n* `{{ expiry }}` - Datetime for when the magiclink expires\n* `{{ ip_address }}` - The IP address of the person who requested the magic link\n* `{{ created }}` - Datetime of when the magic link was created\n* `{{ require_same_ip }}` - The value of `MAGICLINK_REQUIRE_SAME_IP`\n* `{{ require_same_browser }}` - The value of `MAGICLINK_REQUIRE_SAME_BROWSER`\n* `{{ token_uses }}` - The value of `MAGICLINK_TOKEN_USES`\n\n\n#### Signup page\n\nIf you want users to have to signup before being able to log in you will want to override the signup page template using the `MAGICLINK_SIGNUP_TEMPLATE_NAME` setting. This is needed when `MAGICLINK_REQUIRE_SIGNUP = True`. On successful signup the user will be sent a login email with a magic link.\n\nWhen overriding this template please ensure the following content is included:\n\n```html\n<form action=\"{% url 'magiclink:signup' %}\" method=\"post\">\n    {% csrf_token %}\n    {{ SignupForm }}\n    <button type='submit'>Signup</button>\n</form>\n<p>Already have an account? <a href='{% url 'magiclink:login' %}'>Log in here</a></p>\n```\n\nThere are several forms made avalible in the context on this page depending on what information you want to collect:\n* **SignupFormEmailOnly** - Only includes an `email` field\n* **SignupForm** - Includes `name` and `email` fields\n* **SignupFormWithUsername** - Includes `username` and `email` fields\n* **SignupFormFull** - Includes `username`, `name` and `email` fields\n\n\nLike the login for the sign up flow can be overridden if you require more information from the user on signup. See the login/setup docs for more details.\n\n\n#### Configuration settings\n\nBelow are the different settings that can be overridden. To do so place the setting into your `settings.py`.\n\n*Note: Each of the url / redirect settings can either be a URL or url name*\n\n```python\n\n# Override the login page template. See 'Login page' in the Setup section\nMAGICLINK_LOGIN_TEMPLATE_NAME = 'myapp/login.html'\n\n# Override the login page template. See 'Login sent page' in the Setup section\nMAGICLINK_LOGIN_SENT_TEMPLATE_NAME = 'myapp/login_sent.html'\n\n# Override the template that shows when the user tries to login with a\n# magic link that is not valid. See 'Login failed page' in the Setup section\nMAGICLINK_LOGIN_FAILED_TEMPLATE_NAME = 'magiclink/login_failed.html'\n\n# If a login failed redirect is specified the user will be redirected to this\n# URL instead of being shown the LOGIN_FAILED_TEMPLATE\nMAGICLINK_LOGIN_FAILED_REDIRECT = ''\n\n# If this setting is set to False a user account will be created the first time\n# a user requests a login link.\nMAGICLINK_REQUIRE_SIGNUP = True\n# Override the login page template. See 'Login sent page' in the Setup section\nMAGICLINK_SIGNUP_TEMPLATE_NAME = 'myapp/signup.html'\n\n# Set Djangos login redirect URL to be used once the user opens the magic link\n# This will be used whenever a ?next parameter is not set on login\nLOGIN_REDIRECT_URL = '/accounts/profile/'\n\n# If a new user is created via the signup page use this setting to send them to\n# a different url than LOGIN_REDIRECT_URL when clicking the magic link\n# This will fall back to LOGIN_REDIRECT_URL\nMAGICLINK_SIGNUP_LOGIN_REDIRECT = '/welcome/'\n\n# Change the url a user is redirect to after requesting a magic link\nMAGICLINK_LOGIN_SENT_REDIRECT = 'magiclink:login_sent'\n\n# Ensure the branding of the login email is correct. This setting is not needed\n# if you override the `login_email.html` template\nMAGICLINK_EMAIL_STYLES = {\n    'logo_url': '',\n    'background-colour': '#ffffff',\n    'main-text-color': '#000000',\n    'button-background-color': '#0078be',\n    'button-text-color': '#ffffff',\n}\n\n# If you want to use your own email templates you can override the text and\n# html templates used with:\nMAGICLINK_EMAIL_TEMPLATE_NAME_TEXT = 'myapp/login_email.text'\nMAGICLINK_EMAIL_TEMPLATE_NAME_HTML = 'myapp/login_email.html'\n\n# How long a magic link is valid for before returning an error\nMAGICLINK_AUTH_TIMEOUT = 300  # In second - Default is 5 minutes\n\n# Email address is not case sensitive. If this setting is set to True all\n# emails addresses will be set to lowercase before any checks are run against it\nMAGICLINK_IGNORE_EMAIL_CASE = True\n\n# When creating a user assign their email as the username (if the User model\n# has a username field)\nMAGICLINK_EMAIL_AS_USERNAME = True\n\n# Allow superusers to login via a magic link\nMAGICLINK_ALLOW_SUPERUSER_LOGIN = True\n\n# Allow staff users to login via a magic link\nMAGICLINK_ALLOW_STAFF_LOGIN = True\n\n# Ignore the Django user model's is_active flag for login requests\nMAGICLINK_IGNORE_IS_ACTIVE_FLAG = True\n\n# Override the default magic link length\n# Warning: Overriding this setting has security implications, shorter tokens\n# are much more susceptible to brute force attacks*\nMAGICLINK_TOKEN_LENGTH = 50\n\n# Require the user email to be included in the verification link\n# Warning: If this is set to false tokens are more vulnerable to brute force\nMAGICLINK_VERIFY_INCLUDE_EMAIL = True\n\n# Ensure the user who clicked magic link used the same browser as the\n# initial login request.\n# Note: This can cause issues on devices where the default browser is\n# different from the browser being used by the user such as on iOS)\nMAGICLINK_REQUIRE_SAME_BROWSER = True\n\n# Ensure the user who clicked magic link has the same IP address as the\n# initial login request.\nMAGICLINK_REQUIRE_SAME_IP = True\n\n# Remove the last 8-bit octet of a clients IP address.\n# Note: This has no effect if MAGICLINK_REQUIRE_SAME_IP as no IP address\n# is stored\nMAGICLINK_ANONYMIZE_IP = True\n\n# The number of times a login token can be used before being disabled\nMAGICLINK_TOKEN_USES = 1\n\n# How often a user can request a new login token (basic rate limiting).\nMAGICLINK_LOGIN_REQUEST_TIME_LIMIT = 30  # In seconds\n\n# Disable all other tokens for a user when a new token is requested\nMAGICLINK_ONE_TOKEN_PER_USER = True\n\n# Include basic anti spam form fields to help stop bots. False by default\n# Note: IF you use the default forms you will need to add CSS to your\n# page / stylesheet to hide the labels for the anti spam fields.\n# See the login.html or signup.html for an example\nMAGICLINK_ANTISPAM_FORMS = False\n# The shortest time a user can fill out each field and submit a form without\n# being considered a bot. The time is per field and defaults to 1 second.\n# This means if the form has 3 fields and the user will need to make more than\n# 3 seconds to fill out a form.\nMAGICLINK_ANTISPAM_FIELD_TIME = 1\n\n# Override the login verify address. You must inherit from Magiclink LoginVerify\n# view. See Manual usage for more details\nMAGICLINK_LOGIN_VERIFY_URL = 'magiclink:login_verify'\n```\n\n## Magic Link cleanup\n\nEach Magic Link is a seperate row in the database. To help give the user a better warning as to why their login was not successful, magic links are not cleared even once they have expired or have been disabled.\n\nTo clear old disabled magic links as well as magic links which expired over 1 week ago, you can use the `magiclink_clear_logins` management command\n\n```\npython manage.py magiclink_clear_logins\n```\n\n\n## Security\n\nUsing magic links can be dangerous as poorly implemented login links can be brute-forced and emails can be forwarded by accident. There are several security measures used to mitigate these risks:\n\n* The one-time password issued will be valid for 5 minutes before it expires\n* The user's email is specified alongside login tokens to stop URLs being brute-forced\n* Each login token will be at least 20 digits\n* The initial request and its response must take place from the same IP address\n* The initial request and its response must take place in the same browser\n* Each one-time link can only be used once\n* Only the last one-time link issued will be accepted. Once the latest one is issued, any others are invalidated.\n\n*Note: Each of the above settings can be overridden / changed when configuring django-magiclink*\n\n\n## Manual usage\n\n### Creating magiclinks\n\ndjango-magiclink uses a model to help create, send and validate magic links. A `create_magiclink` helper function can be used easily create a MagicLink using the correct settings:\n\n```python\nfrom magiclink.helpers import create_magiclink\n\n# Returns newly created from magiclink.models.MagicLink instance\nmagiclink = create_magiclink(email, request, redirect_url='')\n\n# Generates the magic link url and sends it in an email\nmagiclink.send(request)\n\n# If you want to build the magic link from the model instance but don't want to\n#  send the email you can you can use:\nmagic_link_url = magiclink.generate_url(request)\n```\n\n### Custom Login verify flow\n\nIt is also possible to override the login verify flow to run your own code once the user has successfully logged in instead of a simple redirect. To do this you will need to create a new view which inherits the `magiclink.views.LoginVerify` view and overrides the `login_complete_action` method.\n\nThe below example will redirect the user to a different page depending on superuser / staff status:\n\n\nYour own `views.py`\n\n```python\nfrom magiclink.views import LoginVerify\n\n\nclass CustomLoginVerify(LoginVerify):\n\n    def login_complete_action(self):\n        if self.request.user.is_superuser:\n            url = reverse('superuser_page')\n        elif self.request.user.is_staff:\n            url = reverse('staff_page')\n        else:\n            url = reverse('normal_page')\n        return HttpResponseRedirect(url)\n```\n\n\nYour own `urls.py`\n\n```python\nurlpatterns = [\n    ...\n    path(\n        'custom-login-verify/',\n        CustomLoginVerify.as_view(),\n        name='custom_login_verify'\n    ),\n    ...\n]\n```\n\n\n`settings.py`\n\n```python\n...\nMAGICLINK_LOGIN_VERIFY_URL = 'custom_login_verify'\n...\n```\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/pyepye/django-magiclink",
    "keywords": "magic link,authentication,passwordless",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "django-magiclink",
    "package_url": "https://pypi.org/project/django-magiclink/",
    "platform": "",
    "project_url": "https://pypi.org/project/django-magiclink/",
    "project_urls": {
      "Homepage": "https://github.com/pyepye/django-magiclink",
      "Repository": "https://github.com/pyepye/django-magiclink"
    },
    "release_url": "https://pypi.org/project/django-magiclink/1.1.0/",
    "requires_dist": [
      "Django (>=2.1)",
      "packaging (>=20.9,<21.0)"
    ],
    "requires_python": ">=3.6,<4.0",
    "summary": "Passwordless authentication for Django with Magic Links",
    "version": "1.1.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 12670121,
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "a0dd0932240ff15dec27b75eddf164ebecd8e27bfa9f7005031d49618254363c",
        "md5": "50af47ec86a0c724a83c51a7dbb9a74c",
        "sha256": "b1152839b069d383d827c55cbb24663b494f813949f15b2c16abfb156220e878"
      },
      "downloads": -1,
      "filename": "django_magiclink-1.1.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "50af47ec86a0c724a83c51a7dbb9a74c",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.6,<4.0",
      "size": 24359,
      "upload_time": "2021-09-08T22:59:46",
      "upload_time_iso_8601": "2021-09-08T22:59:46.734713Z",
      "url": "https://files.pythonhosted.org/packages/a0/dd/0932240ff15dec27b75eddf164ebecd8e27bfa9f7005031d49618254363c/django_magiclink-1.1.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "d2e32a11fb8ef716cfabf516c43c6f43a552f9b8fe6f87024ff46d6aa30266db",
        "md5": "1098f739f503539778958921562d47e8",
        "sha256": "9b6a3fe66e820ccb640f564345044a1fc99a5a4713daab048b59cd294f095125"
      },
      "downloads": -1,
      "filename": "django-magiclink-1.1.0.tar.gz",
      "has_sig": false,
      "md5_digest": "1098f739f503539778958921562d47e8",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.6,<4.0",
      "size": 24423,
      "upload_time": "2021-09-08T22:59:44",
      "upload_time_iso_8601": "2021-09-08T22:59:44.996591Z",
      "url": "https://files.pythonhosted.org/packages/d2/e3/2a11fb8ef716cfabf516c43c6f43a552f9b8fe6f87024ff46d6aa30266db/django-magiclink-1.1.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}