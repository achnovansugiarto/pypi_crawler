{
  "info": {
    "author": "Incuna Ltd",
    "author_email": "admin@incuna.com",
    "bugtrack_url": null,
    "classifiers": [
      "Development Status :: 5 - Production/Stable",
      "Framework :: Django",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: BSD License",
      "Natural Language :: English",
      "Programming Language :: Python",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3 :: Only",
      "Programming Language :: Python :: 3.5",
      "Programming Language :: Python :: 3.6",
      "Programming Language :: Python :: 3.7",
      "Topic :: Database",
      "Topic :: Security :: Cryptography"
    ],
    "description": "# django-pgcrypto-fields [![Latest Release](https://img.shields.io/pypi/v/django-pgcrypto-fields.svg)](https://pypi.org/pypi/django-pgcrypto-fields/) [![Python Versions](https://img.shields.io/pypi/pyversions/django-pgcrypto-fields.svg)](https://pypi.org/pypi/django-pgcrypto-fields/) [![Build Status](https://travis-ci.org/incuna/django-pgcrypto-fields.svg?branch=master)](https://travis-ci.org/incuna/django-pgcrypto-fields?branch=master) [![Requirements Status](https://requires.io/github/incuna/django-pgcrypto-fields/requirements.svg?branch=master)](https://requires.io/github/incuna/django-pgcrypto-fields/requirements/?branch=master) [![PyUp - Python 3](https://pyup.io/repos/github/incuna/django-pgcrypto-fields/python-3-shield.svg)](https://pyup.io/repos/github/incuna/django-pgcrypto-fields/)\n\n\n`django-pgcrypto-fields` is a `Django` extension which relies upon `pgcrypto` to\nencrypt and decrypt data for fields.\n\n## Requirements\n\n - postgres with `pgcrypto`\n - Supports Django 1.11.x to 2.1.x\n - Compatible with Python 3 only\n\n Last version of this library that supports `Django` 1.8.x, 1.9.x, 1.10.x\n was `django-pgcrypto-fields` 2.2.0.\n\n\n## Installation\n\n### Install package \n\n```bash\npip install django-pgcrypto-fields\n```\n\n### Django settings\n\nOur library support different crypto keys for multiple databases by \ndefining the keys in your `DATABASES` settings.\n\nIn `settings.py`:\n```python\nimport os\nBASEDIR = os.path.dirname(os.path.dirname(__file__))\nPUBLIC_PGP_KEY_PATH = os.path.abspath(os.path.join(BASEDIR, 'public.key'))\nPRIVATE_PGP_KEY_PATH = os.path.abspath(os.path.join(BASEDIR, 'private.key'))\n\n# Used by PGPPublicKeyField used by default if not specified by the db\nPUBLIC_PGP_KEY = open(PUBLIC_PGP_KEY_PATH).read()\nPRIVATE_PGP_KEY = open(PRIVATE_PGP_KEY_PATH).read()\n\n# Used by TextHMACField and PGPSymmetricKeyField if not specified by the db\nPGCRYPTO_KEY='ultrasecret'\n\nDIFF_PUBLIC_PGP_KEY_PATH = os.path.abspath(\n    os.path.join(BASEDIR, 'tests/keys/public_diff.key')\n)\nDIFF_PRIVATE_PGP_KEY_PATH = os.path.abspath(\n    os.path.join(BASEDIR, 'tests/keys/private_diff.key')\n)\n\n# And add 'pgcrypto' to `INSTALLED_APPS` to create the extension for\n# pgcrypto (in a migration).\nINSTALLED_APPS = (\n    'pgcrypto',\n    # Other installed apps\n)\n\nDATABASES = {\n    # This db will use the default keys above\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql_psycopg2',\n        'NAME': 'pgcryto_fields',\n        'USER': 'pgcryto_fields',\n        'PASSWORD': 'xxxx',\n        'HOST': 'psql.test.com',\n        'PORT': 5432,\n        'OPTIONS': {\n            'sslmode': 'require',\n        }\n    },\n    'diff_keys': {\n        'ENGINE': 'django.db.backends.postgresql_psycopg2',\n        'NAME': 'pgcryto_fields_diff',\n        'USER': 'pgcryto_fields_diff',\n        'PASSWORD': 'xxxx',\n        'HOST': 'psqldiff.test.com',\n        'PORT': 5432,\n        'OPTIONS': {\n            'sslmode': 'require',\n        },\n        'PGCRYPTO_KEY': 'djangorocks',\n        'PUBLIC_PGP_KEY': open(DIFF_PUBLIC_PGP_KEY_PATH, 'r').read(),\n        'PRIVATE_PGP_KEY': open(DIFF_PRIVATE_PGP_KEY_PATH, 'r').read(),\n    },\n}\n```\n\n### Generate GPG keys if using Public Key Encryption\n\nThe public key is going to encrypt the message and the private key will be\nneeded to decrypt the content. The following commands have been taken from the\n[pgcrypto documentation](http://www.postgresql.org/docs/devel/static/pgcrypto.html)\n(see Generating PGP Keys with GnuPG).\n\nGenerating a public and a private key (The preferred key type is \"DSA and Elgamal\".):\n\n```bash\n$ gpg --gen-key\n$ gpg --list-secret-keys\n\n/home/bob/.gnupg/secring.gpg\n---------------------------\nsec   2048R/21 2014-10-23\nuid                  Test Key <example@example.com>\nssb   2048R/42 2014-10-23\n\n\n$ gpg -a --export 42 > public.key\n$ gpg -a --export-secret-keys 21 > private.key\n```\n\n### Upgrading to 2.4.0 from previous versions\n\nThe 2.4.0 version of this library received a large rewrite in order to support \nauto-decryption when getting encrypted field data as well as the ability to filter \non encrypted fields without using the old PGPCrypto aggregate functions available\nin previous versions.\n\nThe following items in this library have been removed and therefore references in \nyour application to these items need to be removed as well:\n\n* `managers.PGPManager`\n* `admin.PGPAdmin`\n* `aggregates.*`\n\n## Fields\n\n`django-pgcrypto-fields` has 3 kinds of fields:\n  - Hash based fields\n  - Public Key (PGP) fields\n  - Symmetric fields\n\n#### Hash Based Fields\n\nSupported hash based fields are:\n - `TextDigestField`\n - `TextHMACField`\n\n`TextDigestField` is hashed in the database using the `digest` pgcrypto function \nusing the `sha512` algorithm.\n\n`TextHMACField` is hashed in the database using the `hmac` pgcrypto function \nusing a key and the `sha512` algorithm. This is similar to the digest version however\nthe hash can only be recalculated knowing the key. This prevents someone from altering \nthe data and also changing the hash to match.\n\n#### Public Key Encryption Fields\n\nSupported PGP public key fields are:\n - `CharPGPPublicKeyField`\n - `EmailPGPPublicKeyField`\n - `IntegerPGPPublicKeyField`\n - `TextPGPPublicKeyField`\n - `DatePGPPublicKeyField`\n - `DateTimePGPPublicKeyField`\n - `DecimalPGPPublicKeyField`\n - `FloatPGPPublicKeyField`\n - `TimePGPPublicKeyField`\n\nPublic key encryption creates a token generated with a public key to\nencrypt the data and a private key to decrypt it.\n\nPublic and private keys can be set in settings with `PUBLIC_PGP_KEY` and\n`PRIVATE_PGP_KEY`.\n\n#### Symmetric Key Encryption Fields\n\nSupported PGP symmetric key fields are:\n - `CharPGPSymmetricKeyField`\n - `EmailPGPSymmetricKeyField`\n - `IntegerPGPSymmetricKeyField`\n - `TextPGPSymmetricKeyField`\n - `DatePGPSymmetricKeyField`\n - `DateTimePGPSymmetricKeyField`\n - `DecimalPGPSymmetricKeyField`\n - `FloatPGPSymmetricKeyField`\n - `TimePGPSymmetricKeyField`\n\nEncrypt and decrypt the data with `settings.PGCRYPTO_KEY` which acts like a password.\n\n### Usage\n\n#### Model Definition\n\n```python\nfrom django.db import models\n\nfrom pgcrypto import fields\n\nclass MyModel(models.Model):\n    digest_field = fields.TextDigestField()\n    digest_with_original_field = fields.TextDigestField(original='pgp_sym_field')\n    hmac_field = fields.TextHMACField()\n    hmac_with_original_field = fields.TextHMACField(original='pgp_sym_field')\n\n    email_pgp_pub_field = fields.EmailPGPPublicKeyField()\n    integer_pgp_pub_field = fields.IntegerPGPPublicKeyField()\n    pgp_pub_field = fields.TextPGPPublicKeyField()\n    date_pgp_pub_field = fields.DatePGPPublicKeyField()\n    datetime_pgp_pub_field = fields.DateTimePGPPublicKeyField()\n    time_pgp_pub_field = fields.TimePGPPublicKeyField()\n    decimal_pgp_pub_field = fields.DecimalPGPPublicKeyField()\n    float_pgp_pub_field = fields.FloatPGPPublicKeyField()\n\n    email_pgp_sym_field = fields.EmailPGPSymmetricKeyField()\n    integer_pgp_sym_field = fields.IntegerPGPSymmetricKeyField()\n    pgp_sym_field = fields.TextPGPSymmetricKeyField()\n    date_pgp_sym_field = fields.DatePGPSymmetricKeyField()\n    datetime_pgp_sym_field = fields.DateTimePGPSymmetricKeyField()\n    time_pgp_sym_field = fields.TimePGPSymmetricKeyField()\n    decimal_pgp_sym_field = fields.DecimalPGPSymmetricKeyField()\n    float_pgp_sym_field = fields.FloatPGPSymmetricKeyField()\n```\n\n#### Encrypting\n\nData is automatically encrypted when inserted into the database.\n\nExample:\n```\n>>> MyModel.objects.create(value='Value to be encrypted...')\n```\n\nHash fields can have hashes auto updated if you use the `original` attribute. This\nattribute allows you to indicate another field name to base the hash value on.\n\n```python\nfrom django.db import models\n\nfrom pgcrypto import fields\n\nclass User(models.Model):\n    first_name = fields.TextPGPSymmetricKeyField(max_length=20, verbose_name='First Name')\n    first_name_hashed = fields.TextHMACField(original='first_name') \n```\n\nIn the above example, if you specify the optional original attribute it would \ntake the unencrypted value from the first_name model field as the input value \nto create the hash. If you did not specify an original attribute, the field \nwould work as it does now and would remain backwards compatible.\n\n##### PGP fields\n\nWhen accessing the field name attribute on a model instance we are getting the\ndecrypted value.\n\nExample:\n```\n>>> # When using a PGP public key based encryption\n>>> my_model = MyModel.objects.get()\n>>> my_model.value\n'Value decrypted'\n```\n\nFiltering encrypted values is now handled automatically as of 2.4.0. And `aggregate`\nmethods are not longer supported and have been removed from the library.\n\nAlso, auto-decryption is support for `select_related()` models.\n\n```python\nfrom django.db import models\n\nfrom pgcrypto import fields\n\n\nclass EncryptedFKModel(models.Model):\n    fk_pgp_sym_field = fields.TextPGPSymmetricKeyField(blank=True, null=True)\n\n\nclass EncryptedModel(models.Model):\n    pgp_sym_field = fields.TextPGPSymmetricKeyField(blank=True, null=True)\n    fk_model = models.ForeignKey(\n        EncryptedFKModel, blank=True, null=True, on_delete=models.CASCADE\n    )\n```\n\nExample:\n```\n>>> import EncryptedModel\n>>> my_model = EncryptedModel.objects.get().select_releated('fk_model')\n>>> my_model.pgp_sym_field\n'Value decrypted'\n>>> my_model.fk_model.fk_pgp_sym_field\n'Value decrypted'\n```\n\n##### Hash fields\n\nTo filter hash based values we need to compare hashes. This is achieved by using\na `__hash_of` lookup.\n\nExample:\n```\n>>> my_model = MyModel.objects.filter(digest_field__hash_of='value')\n[<MyModel: MyModel object>]\n>>> my_model = MyModel.objects.filter(hmac_field__hash_of='value')\n[<MyModel: MyModel object>]\n\n```\n\n## Limitations\n\n#### `.distinct('encrypted_field_name')`\n\nDue to a missing feature in the Django ORM, using `distinct()` on an encrypted field\ndoes not work for Django 2.0.x and lower.\n\nThe normal distinct works on Django 2.1.x and higher:\n\n```python\nitems = EncryptedFKModel.objects.filter(\n    pgp_sym_field__startswith='P'\n).only(\n    'id', 'pgp_sym_field', 'fk_model__fk_pgp_sym_field'\n).distinct(\n    'pgp_sym_field'\n)\n```\n\nWorkaround for Django 2.0.x and lower:\n\n```python\nfrom django.db import models\n\nitems = EncryptedFKModel.objects.filter(\n    pgp_sym_field__startswith='P'\n).annotate(\n    _distinct=models.F('pgp_sym_field')\n).only(\n    'id', 'pgp_sym_field', 'fk_model__fk_pgp_sym_field'\n).distinct(\n    '_distinct'\n)\n```\n\nThis works because the annotated field is auto-decrypted by Django as a `F` field and that \nfield is used in the `distinct()`.\n\n\n## Security Limitations\n\nTaken direction from the PostgreSQL documentation:\n\nhttps://www.postgresql.org/docs/9.6/static/pgcrypto.html#AEN187024\n\nAll pgcrypto functions run inside the database server. That means that all the \ndata and passwords move between pgcrypto and client applications in clear text. Thus you must:\n\n1. Connect locally or use SSL connections.\n1. Trust both system and database administrator.\n\nIf you cannot, then better do crypto inside client application.\n\nThe implementation does not resist side-channel attacks. For example, the time \nrequired for a pgcrypto decryption function to complete varies among ciphertexts of \na given size.\n\n\n# CHANGELOG\n\n# 2.5.1\n\n* Fixed regression in the definition of EmailPGPPublicKeyField (#77)\n* Removed dead code (remove_validators and RemoveMaxLengthValidatorMixin)\n* Updated requirements_dev.txt\n\n## 2.5.0\n\n* Added new DecimalFields for both public and symmetric key (#64)\n* Added new FloatFields for both public and symmetric key (#64)\n* Added new TimeFields for both public and symmetric key (#64)\n* Added support for different keys based on database (#67)\n\n## 2.4.0\n\n* Added auto-decryption of all encrypted fields including FK tables\n* Removed django-pgcrypto-fields `aggregates`, `PGPManager` and `PGPAdmin` as they are no longer needed\n* Added support for `get_or_create()` and `update_or_create()` (#27)\n* Added support for `get_by_natural_key()` (#23)\n* Added support for `only()` and `defer()` as they were not supported with `PGPManager`\n* Added support for `distinct()` (Django 2.1+ with workaround available for 2.0 and lower)\n* Separated out dev requirements from setup.py requirements\n* Updated packaging / setup.py to include long description\n* Added AUTHORS and updated CONTRIBUTING\n* Updated TravisCI to use Xenial to gain Python 3.7 in the matrix\n\n## 2.3.1\n\n* Added `__range` lookup for Date / DateTime fields (#59)\n* Remove compatibility for `Django 1.8, 1.9, and 1.10` (#62)\n* Improved `setup.py`:\n    * check for Python 3.5+\n    * updated classifiers\n* Improved `make` file for release to use `twine`\n* Added additional shields to `README`\n* Updated Travis config to include Python 3.5 and 3.6\n* Refactored lookups and mixins\n\n## 2.3.0\n\n* Invalid release, bump to 2.3.1\n\n## 2.2.0\n\n* Merge `.coveragerc` into `setup.cfg`\n* Added `.gitignore` file\n* Updated out-dated requirements (latest versions of `Flake8` and `pycodestyle` \nare incompatible with each other)\n* Updated `README` with better explanations of the fields\n* Implemented DatePGPPublicKeyField and DateTimePGPPublicKeyField\n\n## 2.1.1\n\n* Added support for Django 2.x+\n* Updated requirements for testing\n* Updated travis config with Python 3.6 and additional environments\n\n## 2.1.0\n\nThanks to @peterfarrell:\n* Add support for `DatePGPSymmetricKeyField` and `DateTimePGPSymmetricKeyField`\nincluding support for serializing / deserializing django form fields.\n* Add support for auto decryption of symmetric key and public key fields via\nthe PGPManager (and support for disabling it in the Django Admin via the PGPAdmin)\n\n## 2.0.0\n\n* Remove compatibility for `Django 1.7`.\n* Add compatibility for `Django 1.10`.\n* Add `Django 1.9` to the travis matrix.\n\n## v1.0.1\n\n* Exclude tests app from distributed package.\n\n## v1.0.0\n\n* Rename package from `pgcrypto_fields` to `pgcrypto`.\n\n## v0.7.0\n\n* Make `get_placeholder` accepts a new argument `compiler`\n* Fix buggy import to `Aggregate`\n\n**Note: these changes have been done for django > 1.8.0.**\n\n## v0.6.4\n\n* Remove `MaxLengthValidator` from email fields.\n\n## v0.6.3\n\n* Avoid setting `max_length` on PGP fields.\n\n## v0.6.2\n\n* Allow/check `NULL` values for:\n  `TextDigestField`;\n  `TextHMACField`;\n  `EmailPGPPublicKeyField`;\n  `IntegerPGPPublicKeyField`;\n  `TextPGPPublicKeyField`;\n  `EmailPGPSymmetricKeyField`.\n  `IntegerPGPSymmetricKeyField`.\n  `TextPGPSymmetricKeyField`.\n\n## v0.6.1\n\n* Fix `cast`ing bug when sending negative values to integer fields.\n\n## v0.6.0\n\n* Add `EmailPGPPublicKeyField` and `EmailPGPSymmetricKeyField`.\n\n## v0.5.0\n\n* Rename the following fields:\n  `PGPPublicKeyField` to `TextPGPPublicKeyField`;\n  `PGPSymmetricKeyField` to `TextPGPSymmetricKeyField`;\n  `DigestField` to `TextDigestField`;\n  `HMACField` to `TextHMACField`.\n* Add new integer fields:\n  `IntegerPGPPublicKeyField`;\n  `IntegerPGPSymmetricKeyField`.\n\n## v0.4.0\n\n* Make accessing decrypted value transparent. Fix bug when field had a string\nrepresentation of `memoryview` for PGP and keyed hash fields.\n\n## v0.3.1\n\n* Fix `EncryptedProxyField` to select the correct item.\n\n## v0.3.0\n\n* Access `PGPPublicKeyField`  and `PGPSymmetricKeySQL` decrypted values with\nfield's proxy `_decrypted`.\n* Remove descriptor for field's name and raw value.\n\n## v0.2.0\n\n* Add hash based lookup for `DigestField` and `HMACField`.\n* Add `DigestField`, `HMACField`, `PGPPublicKeyAggregate`, `PGPSymmetricKeyAggregate`.\n\n## v0.1.0\n\n* Add decryption through an aggregate class.\n* Add encryption when inserting data to the database.\n\n\n",
    "description_content_type": "text/markdown",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/incuna/django-pgcrypto-fields",
    "keywords": "",
    "license": "BSD",
    "maintainer": "",
    "maintainer_email": "",
    "name": "django-pgcrypto-fields",
    "package_url": "https://pypi.org/project/django-pgcrypto-fields/",
    "platform": "",
    "project_url": "https://pypi.org/project/django-pgcrypto-fields/",
    "project_urls": {
      "Homepage": "https://github.com/incuna/django-pgcrypto-fields"
    },
    "release_url": "https://pypi.org/project/django-pgcrypto-fields/2.5.1/",
    "requires_dist": null,
    "requires_python": ">=3.5",
    "summary": "Encrypted fields for Django dealing with pgcrypto postgres extension.",
    "version": "2.5.1",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 9067291,
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "1c19e47973982ac6924b9ab2184f486a2b60aa31f72a7b25047b4e7456916d62",
        "md5": "70d1b511fec83d9a350a504f41333155",
        "sha256": "c9f86fa3935aaa99c53539516262ac430376e3241dfc11950fc53bf435d1d27d"
      },
      "downloads": -1,
      "filename": "django_pgcrypto_fields-2.5.1-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "70d1b511fec83d9a350a504f41333155",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": ">=3.5",
      "size": 12517,
      "upload_time": "2018-10-25T16:56:09",
      "upload_time_iso_8601": "2018-10-25T16:56:09.814605Z",
      "url": "https://files.pythonhosted.org/packages/1c/19/e47973982ac6924b9ab2184f486a2b60aa31f72a7b25047b4e7456916d62/django_pgcrypto_fields-2.5.1-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "c8617b2907368d036f07ab0e118a102adde9e9181866bf45d8d3d8c50c37a8cd",
        "md5": "a6bf6bf37d32b427ca7e3d0cf648d756",
        "sha256": "a386a772728fe1554c3b599c69a7065ad28caae0ab973fb5d653c14f8460b8dd"
      },
      "downloads": -1,
      "filename": "django-pgcrypto-fields-2.5.1.tar.gz",
      "has_sig": false,
      "md5_digest": "a6bf6bf37d32b427ca7e3d0cf648d756",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": ">=3.5",
      "size": 15547,
      "upload_time": "2018-10-25T16:56:11",
      "upload_time_iso_8601": "2018-10-25T16:56:11.725895Z",
      "url": "https://files.pythonhosted.org/packages/c8/61/7b2907368d036f07ab0e118a102adde9e9181866bf45d8d3d8c50c37a8cd/django-pgcrypto-fields-2.5.1.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}