{
  "info": {
    "author": "Ministry of Justice Digital Services",
    "author_email": "",
    "bugtrack_url": null,
    "classifiers": [
      "Framework :: Django",
      "Intended Audience :: Developers",
      "License :: OSI Approved :: MIT License",
      "Operating System :: OS Independent",
      "Programming Language :: Python",
      "Programming Language :: Python :: 3",
      "Programming Language :: Python :: 3.8"
    ],
    "description": "Money to Prisoners Common\n=========================\n\nA Django app containing utilities and assets common to all Prisoner Money applications.\n\n.. image:: https://circleci.com/gh/ministryofjustice/money-to-prisoners-common.svg?style=svg\n    :target: https://circleci.com/gh/ministryofjustice/money-to-prisoners-common\n\nFeatures\n--------\n\n* Build pipeline CLI with actions that can depend on others (inspired by invoke/fabric)\n* Base SCSS, JS and static assets\n* Base templates for staff and public apps\n* Build action to include GOV.UK Design System assets\n* Reusable templates for form fields and errors\n* Authentication utilities and views for connecting to `money-to-prisoners-api`_\n* User account management forms and views\n* REST utilities for communicating with `money-to-prisoners-api`_\n* Utility for communicating with HMPPS Prison API (NOMIS)\n* Integration and accessibility testing with selenium\n* Python code style testing\n* Log formatting for shipping to ELK\n* Cookie management tools to anonymise users and allow them to opt in\n* Prometheus metrics view providing app version information\n* Constants shared between apps\n* Email sending using GOV.UK Notify\n\nUsage\n-----\n\nThis is not a standalone Django application and is included as a requirement of Prisoner Money apps.\n\n* Make code changes and add any tests necessary\n* Test using ``./run.py test`` or ``python setup.py test``\n* Update the package version with ``./run.py set_version --version [?.?.?]``\n* Commit, tag with the version and push changes to Github\n* Submit to PyPi by:\n\n  * making a new release on Github (package version comes from the code, not Github release title)\n  * or ``./run.py upload`` locally (if release cannot be made on Github for some reason)\n\nAdd or update ``money-to-prisoners-common~=<major version>.<minor version>.0`` to the app’s requirements base.txt.\nThere is an additional variant installed as a setuptools *extra*:\nUse ``money-to-prisoners-common[testing]~=<major version>.<minor version>.0`` for environments requiring testing;\nthis is placed into the app’s requirements dev.txt.\nIncrementing the build/patch version is used to push minor fixes so these above requirements will automatically include them.\n\nWhile making changes to this library, you can install it locally in \"editable\" mode.\nSee ``python_dependencies --common-path …`` build task.\n\nTranslating\n-----------\n\nUpdate translation files with ``./run.py make_messages`` – you need to do this every time any translatable text is updated.\n\nCompile messages ``./run.py compile_messages`` – only needed during local testing or development, it happens automatically during build or upload.\n\nPull updates from Transifex with ``./run.py translations --pull``. You’ll need to update translation files afterwards and manually check that the merges occurred correctly.\n\nPush latest English to Transifex with ``./run.py translations --push``. NB: you should pull updates before pushing to merge correctly.\n\nAssets\n------\n\nAll shared assets used by Prisoner Money apps are kept in this package.\nEach app’s build scripts install this package automatically which also bring in the GOV.UK Design System.\n\nAssets that need compiling are in ``mtp_common/assets-src/mtp_common``.\nStatic assets are in ``mtp_common/static/mtp_common``.\n\nCommon templates used by the client apps are kept in ``mtp_common/templates/(govuk-frontend|mtp_common)``.\nThe ones in ``govuk-frontend`` are essentially translated from the GOV.UK Design System whereas those in ``mtp_common``\nare custom components or are heavily modified.\n\nLocal Development Environment\n-----------------------------\n\nPrisoner Money apps can be run natively (i.e. directly by python on your machine) or using docker-compose.\nUsing docker-compose is perhaps the easiest way to bring up all Prisoner Money apps in concert,\nbut it requires access to the private `money-to-prisoners-deploy`_ infrastructure.\nHowever, when editing this common library, it’s easier to run them natively\nbecause this package can be installed in \"editable\" mode.\n\nCheck out each app and helper repository side-by-side in one directory using git:\n\n* `money-to-prisoners-api`_\n* `money-to-prisoners-cashbook`_\n* `money-to-prisoners-bank-admin`_\n* `money-to-prisoners-noms-ops`_\n* `money-to-prisoners-transaction-uploader`_ – NB: this app does not expose a web interface\n* `money-to-prisoners-send-money`_\n* `money-to-prisoners-start-page`_\n* `money-to-prisoners-common`_\n* `money-to-prisoners-deploy`_ – NB: this is a private repository\n\n**Running natively (does not require access to the private deploy repository)**\n\nEach app describes its own installation in its read-me file, but here’s a quick guide:\n\n1. Setup local postgres database server. There’s no need to create a user or database if using default settings.\n\n2. Install python version 3.8.\n\n3. Install nodejs version 16.\n\n4. Setup a python virtual environment for each app. These are used to isolate python dependency libraries for each app.\n\n   1. You can either make one directly in *each* repository directory:\n\n   .. code-block:: sh\n\n     python3 -m venv venv\n\n   2. Or install and use `virtualenvwrapper`_ which allows activating a virtual environment by name from any location.\n      This option is particularly helpful for git hooks or when you normally run the apps in docker-compose.\n      In the directory containing all repos:\n\n   .. code-block:: sh\n\n     for app in api cashbook bank-admin noms-ops transaction-uploader send-money start-page deploy; do\n       cd money-to-prisoners-$app\n       mkvirtualenv -a . money-to-prisoners-$app\n       [[ -f requirements/dev.txt ]] && pip install -r requirements/dev.txt\n       [[ -f requirements.txt ]] && pip install -r requirements.txt\n       cd -\n     done\n     cd money-to-prisoners-common\n     mkvirtualenv -a . money-to-prisoners-common\n     pip install -e '.[testing]'\n\n5. Run the apps. The ``api`` always needs to be running when any of the other apps are used other than ``start-page``.\n\n   .. code-block:: sh\n\n     cd <app repository root>\n     # activate the virtual environment if one was made directly\n     . venv/bin/activate\n     # OR activate the virtual environment using virtualenvwrapper\n     workon money-to-prisoners-<app name>\n\n     # run the app\n     ./run.py serve\n     # OR if it’s the api, this automatically alternative also creates a fresh database with sample data\n     ./run.py start --test-mode\n\nAfter this has been done once, bringing up apps again only requires repeating step 5.\n\n**Running using docker-compose (requires access to the private deploy repository)**\n\n1. Get access to `money-to-prisoners-deploy`_ and see read-me inside to unlock it.\n\n2. Setup local environment:\n\n   1. Get the docker registry address of ECR used for deployed environment in Cloud Platform. In the ``deploy`` repo:\n\n   .. code-block:: sh\n\n     ./manage.py config docker-login  # log into ECR\n     ./manage.py app ci-settings [any mtp app name]  # note the $ECR_ENDPOINT value\n\n   Alternatively, this value can be derived from the ``ecr`` kubernetes secret in the production namespace in Cloud Platform.\n   Use the value of ``repo_url`` up to the first ``/``.\n\n   2. Create a ``.env`` file in this repository’s root directory adding this ``ECR_ENDPOINT`` value:\n\n   .. code-block::\n\n     ECR_ENDPOINT=?????????.amazonaws.com\n\n3. Pull images from private docker registry in Cloud Platform. In the ``deploy`` repo:\n\n.. code-block:: sh\n\n  ./manage.py config docker-login  # only necessary if not done above\n  ./manage.py image pull-ecr\n\n4. Launch all apps in concert. In this repo:\n\n.. code-block:: sh\n\n  docker-compose up\n\n   NB: The newer ``docker compose up`` form only works after the ``docker-compose up`` has already built the containers the first time!\n\n5. Create standard users and populate database with sample data. In this repo:\n\n.. code-block:: sh\n\n  docker-compose exec api ./manage.py load_test_data\n\nAfter this has been done once, bringing up the full stack in future only requires running ``docker-compose up``\nor ``docker compose up`` in this repo. Deleting docker images, containers or volumes will require repeating steps 3 to 5.\n\nIf you run into issues with the dockerised development environment, the following troubleshooting steps should reset the state:\n\n* Shutdown existing docker-compose containers, and remove volumes/networks/images with ``docker-compose down -v --rmi all`` from this repo’s root directory (note this will wipe your local database, omit the ``-v`` to prevent this)\n* Pull fresh base images (step 3 above)\n* Rebuild the app images without cache via ``docker-compose build --no-cache`` from this repo’s root directory\n* Restart the apps in the background via ``docker-compose up -d`` from this repo’s root directory\n* Tail the logs at your leisure via ``docker-compose logs <app>`` from money-to-prisoners-common root directory\n\n**Accessing the apps**\n\nIrrespective of how the apps were run, those exposing a web interface will be accessible:\n\n* api: http://localhost:8000/admin/\n* cashbook: http://localhost:3001/\n* bank-admin: http://localhost:3002/\n* noms-ops: http://localhost:3003/\n* send-money: http://localhost:3004/\n* start-page: http://localhost:8005/\n\nCaveat: You can only log into one app at a time locally because the cookies within which the session is stored are namespaced to domain only.\n\nAdditional Bespoke Packages\n---------------------------\n\nThere are several dependencies of the ``money-to-prisoners-common`` python library which are maintained by this team, so they may require code-changes when the dependencies (e.g. Django) of the ``money-to-prisoners-common`` python library, or any of the Prisoner Money apps, are incremented.\n\n* `django-form-error-reporting`_\n* `django-zendesk-tickets`_\n* `govuk-bank-holidays`_\n\nThere are additional bespoke dependencies defined as python dependencies within the Prisoner Money apps.\n\n\n\n.. Links referenced in document above:\n.. _money-to-prisoners-api: https://github.com/ministryofjustice/money-to-prisoners-api\n.. _money-to-prisoners-cashbook: https://github.com/ministryofjustice/money-to-prisoners-cashbook\n.. _money-to-prisoners-bank-admin: https://github.com/ministryofjustice/money-to-prisoners-bank-admin\n.. _money-to-prisoners-noms-ops: https://github.com/ministryofjustice/money-to-prisoners-noms-ops\n.. _money-to-prisoners-transaction-uploader: https://github.com/ministryofjustice/money-to-prisoners-transaction-uploader\n.. _money-to-prisoners-send-money: https://github.com/ministryofjustice/money-to-prisoners-send-money\n.. _money-to-prisoners-start-page: https://github.com/ministryofjustice/money-to-prisoners-start-page\n.. _money-to-prisoners-common: https://github.com/ministryofjustice/money-to-prisoners-common\n.. _money-to-prisoners-deploy: https://github.com/ministryofjustice/money-to-prisoners-deploy\n.. _django-form-error-reporting: https://github.com/ministryofjustice/django-form-error-reporting\n.. _django-zendesk-tickets: https://github.com/ministryofjustice/django-zendesk-tickets\n.. _govuk-bank-holidays: https://github.com/ministryofjustice/govuk-bank-holidays\n.. _virtualenvwrapper: https://virtualenvwrapper.readthedocs.io/\n\n\n",
    "description_content_type": "",
    "docs_url": null,
    "download_url": "",
    "downloads": {
      "last_day": -1,
      "last_month": -1,
      "last_week": -1
    },
    "home_page": "https://github.com/ministryofjustice/money-to-prisoners-common",
    "keywords": "",
    "license": "MIT",
    "maintainer": "",
    "maintainer_email": "",
    "name": "money-to-prisoners-common",
    "package_url": "https://pypi.org/project/money-to-prisoners-common/",
    "platform": "",
    "project_url": "https://pypi.org/project/money-to-prisoners-common/",
    "project_urls": {
      "Homepage": "https://github.com/ministryofjustice/money-to-prisoners-common"
    },
    "release_url": "https://pypi.org/project/money-to-prisoners-common/13.3.0/",
    "requires_dist": [
      "Django (<2.3,>=2.2)",
      "django-extended-choices (<2,>=1.3)",
      "django-widget-tweaks (<1.5,>=1.4)",
      "notifications-python-client (~=6.2)",
      "pytz (>=2021.1)",
      "requests (<3,>=2.18)",
      "requests-oauthlib (<2,>=1)",
      "slumber (<0.8,>=0.7)",
      "selenium (~=4.0)",
      "transifex-client (<0.15,>=0.14)",
      "cryptography (~=35.0)",
      "PyJWT (~=2.1.0)",
      "boto3 (<1.21.0,>=1.18.32)",
      "kubernetes (~=19.0)",
      "prometheus-client (<1,>=0.6)",
      "sentry-sdk (~=1.4)",
      "libsass (~=0.20)",
      "uWSGI (~=2.0.20)",
      "django-form-error-reporting (==0.9)",
      "django-moj-irat (==0.6)",
      "django-zendesk-tickets (==0.14)",
      "govuk-bank-holidays (==0.10)",
      "flake8 (~=4.0) ; extra == 'testing'",
      "flake8-blind-except (~=0.2.0) ; extra == 'testing'",
      "flake8-bugbear (~=21.0) ; extra == 'testing'",
      "flake8-debugger (~=4.0) ; extra == 'testing'",
      "flake8-quotes (~=3.3.0) ; extra == 'testing'",
      "pep8-naming (~=0.12.0) ; extra == 'testing'",
      "responses (~=0.13.0) ; extra == 'testing'",
      "twine (~=3.4) ; extra == 'testing'",
      "watchdog (~=2.1) ; extra == 'testing'"
    ],
    "requires_python": "",
    "summary": "Django app with common code and assets for Money to Prisoners services",
    "version": "13.3.0",
    "yanked": false,
    "yanked_reason": null
  },
  "last_serial": 17340551,
  "urls": [
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "10b712e7415149c826b18a0f96849bf04597c6811b60b78790b35ab71029f49a",
        "md5": "a2e77c29d2172132c4aeebcbfafe6178",
        "sha256": "255336629b79e3eb8614445f8de30a17094ad17182a1c6731e3fa24d6459ef8c"
      },
      "downloads": -1,
      "filename": "money_to_prisoners_common-13.3.0-py3-none-any.whl",
      "has_sig": false,
      "md5_digest": "a2e77c29d2172132c4aeebcbfafe6178",
      "packagetype": "bdist_wheel",
      "python_version": "py3",
      "requires_python": null,
      "size": 338706,
      "upload_time": "2021-11-10T12:05:35",
      "upload_time_iso_8601": "2021-11-10T12:05:35.492703Z",
      "url": "https://files.pythonhosted.org/packages/10/b7/12e7415149c826b18a0f96849bf04597c6811b60b78790b35ab71029f49a/money_to_prisoners_common-13.3.0-py3-none-any.whl",
      "yanked": false,
      "yanked_reason": null
    },
    {
      "comment_text": "",
      "digests": {
        "blake2b_256": "063e7797efda394a1c59f769c11e7ed326a7f29ce0368549492c682d022c25ae",
        "md5": "3edd46a6837d161b5abc719f255f8bb3",
        "sha256": "34c67d0a76cbaa4778a758873f287f7916c90928c4cdc1c89c0a0db6dc009905"
      },
      "downloads": -1,
      "filename": "money-to-prisoners-common-13.3.0.tar.gz",
      "has_sig": false,
      "md5_digest": "3edd46a6837d161b5abc719f255f8bb3",
      "packagetype": "sdist",
      "python_version": "source",
      "requires_python": null,
      "size": 260259,
      "upload_time": "2021-11-10T12:05:37",
      "upload_time_iso_8601": "2021-11-10T12:05:37.346407Z",
      "url": "https://files.pythonhosted.org/packages/06/3e/7797efda394a1c59f769c11e7ed326a7f29ce0368549492c682d022c25ae/money-to-prisoners-common-13.3.0.tar.gz",
      "yanked": false,
      "yanked_reason": null
    }
  ],
  "vulnerabilities": []
}